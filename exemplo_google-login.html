<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login com Google</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 400px;
      width: 100%;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
      text-align: center;
    }

    .subtitle {
      color: #666;
      text-align: center;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .welcome-section {
      display: none;
      text-align: center;
    }

    .welcome-section.active {
      display: block;
    }

    .login-section.hidden {
      display: none;
    }

    .user-info {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .user-info p {
      margin: 10px 0;
      color: #555;
    }

    .user-info strong {
      color: #333;
    }

    #googleButton {
      display: flex;
      justify-content: center;
      margin: 30px 0;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      transition: background 0.3s;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    .stored-email {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <p class="subtitle">Entre com sua conta Google</p>

    <div id="loginSection" class="login-section">
      <div id="storedEmailInfo"></div>
      <div id="googleButton"></div>
    </div>

    <div id="welcomeSection" class="welcome-section">
      <h2>✅ Bem-vindo!</h2>
      <div id="userInfo" class="user-info"></div>
      <button class="logout-btn" onclick="logout()">Sair</button>
    </div>
  </div>

  <script>
    const CLIENT_ID = '453193392660-ftlj3r3c0s9vkembqckaub69fgnau7rm.apps.googleusercontent.com';
    
    let userData = {
      email: null,
      name: null,
      picture: null,
      idToken: null
    };
    
    window.onload = function() {
      const storedEmail = localStorage.getItem('userEmail');
      if (storedEmail) {
        const infoDiv = document.getElementById('storedEmailInfo');
        infoDiv.innerHTML = `<div class="stored-email">Usuário: <strong>${storedEmail}</strong></div>`;
      }
      
      initializeGoogleSignIn();
    };
    
    function initializeGoogleSignIn() {
      google.accounts.id.initialize({
        client_id: CLIENT_ID,
        callback: handleCredentialResponse
      });

      google.accounts.id.renderButton(
        document.getElementById('googleButton'),
        { 
          theme: 'outline', 
          size: 'large',
          text: 'signin_with',
          locale: 'pt-BR'
        }
      );
    }
   
    function handleCredentialResponse(response) {
      const idToken = response.credential;
      const payload = parseJwt(idToken);
      
      userData.idToken = idToken;
      userData.email = payload.email;
      userData.name = payload.name;
      userData.picture = payload.picture;
      
      localStorage.setItem('userEmail', payload.email);
      
      displayUserInfo();
    }
    
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map((c) => { return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2); }).join(''));
      return JSON.parse(jsonPayload);
    }
    
    function displayUserInfo() {
      const userInfoDiv = document.getElementById('userInfo');
      userInfoDiv.innerHTML = `
        ${userData.picture ? `<img src="${userData.picture}" alt="Foto" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 15px;">` : ''}
        <p><strong>Nome:</strong> ${userData.name}</p>
        <p><strong>Email:</strong> ${userData.email}</p>
        <p style="font-size: 12px; color: #888; margin-top: 15px;">ID Token recebido com sucesso!</p>
      `;
      
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('welcomeSection').classList.add('active');
    }

    function logout() {
      userData.idToken = null;
      userData.name = null;
      userData.picture = null;
      
      // Volta para a tela de login
      document.getElementById('loginSection').classList.remove('hidden');
      document.getElementById('welcomeSection').classList.remove('active');
      
      // Revoga o token do Google
      google.accounts.id.disableAutoSelect();
    }
  </script>
</body>
</html>
