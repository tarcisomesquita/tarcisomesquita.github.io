(()=>{var t={467:t=>{t.exports={EXT_VERSION:"3.2.1",EXT_IS_MAJOR_RELEASE:!1}},992:(t,e,r)=>{var o,i=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function i(t,e){if(!o[t]){o[t]={};for(var r=0;r<t.length;r++)o[t][t.charAt(r)]=r}return o[t][e]}var n={compressToBase64:function(t){if(null==t)return"";var r=n._compress(t,6,(function(t){return e.charAt(t)}));switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,(function(r){return i(e,t.charAt(r))}))},compressToUTF16:function(e){return null==e?"":n._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:n._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){for(var e=n.compress(t),r=new Uint8Array(2*e.length),o=0,i=e.length;o<i;o++){var s=e.charCodeAt(o);r[2*o]=s>>>8,r[2*o+1]=s%256}return r},decompressFromUint8Array:function(e){if(null==e)return n.decompress(e);for(var r=new Array(e.length/2),o=0,i=r.length;o<i;o++)r[o]=256*e[2*o]+e[2*o+1];var s=[];return r.forEach((function(e){s.push(t(e))})),n.decompress(s.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":n._compress(t,6,(function(t){return r.charAt(t)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,(function(e){return i(r,t.charAt(e))})))},compress:function(e){return n._compress(e,16,(function(e){return t(e)}))},_compress:function(t,e,r){if(null==t)return"";var o,i,n,s={},a={},l="",d="",c="",h=2,u=3,f=2,_=[],w=0,p=0;for(n=0;n<t.length;n+=1)if(l=t.charAt(n),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=u++,a[l]=!0),d=c+l,Object.prototype.hasOwnProperty.call(s,d))c=d;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(o=0;o<f;o++)w<<=1,p==e-1?(p=0,_.push(r(w)),w=0):p++;for(i=c.charCodeAt(0),o=0;o<8;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1}else{for(i=1,o=0;o<f;o++)w=w<<1|i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i=0;for(i=c.charCodeAt(0),o=0;o<16;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1}0==--h&&(h=Math.pow(2,f),f++),delete a[c]}else for(i=s[c],o=0;o<f;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1;0==--h&&(h=Math.pow(2,f),f++),s[d]=u++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(o=0;o<f;o++)w<<=1,p==e-1?(p=0,_.push(r(w)),w=0):p++;for(i=c.charCodeAt(0),o=0;o<8;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1}else{for(i=1,o=0;o<f;o++)w=w<<1|i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i=0;for(i=c.charCodeAt(0),o=0;o<16;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1}0==--h&&(h=Math.pow(2,f),f++),delete a[c]}else for(i=s[c],o=0;o<f;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(i=2,o=0;o<f;o++)w=w<<1|1&i,p==e-1?(p=0,_.push(r(w)),w=0):p++,i>>=1;for(;;){if(w<<=1,p==e-1){_.push(r(w));break}p++}return _.join("")},decompress:function(t){return null==t?"":""==t?null:n._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(e,r,o){var i,n,s,a,l,d,c,h=[],u=4,f=4,_=3,w="",p=[],b={val:o(0),position:r,index:1};for(i=0;i<3;i+=1)h[i]=i;for(s=0,l=Math.pow(2,2),d=1;d!=l;)a=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),s|=(a>0?1:0)*d,d<<=1;switch(s){case 0:for(s=0,l=Math.pow(2,8),d=1;d!=l;)a=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),s|=(a>0?1:0)*d,d<<=1;c=t(s);break;case 1:for(s=0,l=Math.pow(2,16),d=1;d!=l;)a=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),s|=(a>0?1:0)*d,d<<=1;c=t(s);break;case 2:return""}for(h[3]=c,n=c,p.push(c);;){if(b.index>e)return"";for(s=0,l=Math.pow(2,_),d=1;d!=l;)a=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),s|=(a>0?1:0)*d,d<<=1;switch(c=s){case 0:for(s=0,l=Math.pow(2,8),d=1;d!=l;)a=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),s|=(a>0?1:0)*d,d<<=1;h[f++]=t(s),c=f-1,u--;break;case 1:for(s=0,l=Math.pow(2,16),d=1;d!=l;)a=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),s|=(a>0?1:0)*d,d<<=1;h[f++]=t(s),c=f-1,u--;break;case 2:return p.join("")}if(0==u&&(u=Math.pow(2,_),_++),h[c])w=h[c];else{if(c!==f)return null;w=n+n.charAt(0)}p.push(w),h[f++]=n+w.charAt(0),n=w,0==--u&&(u=Math.pow(2,_),_++)}}};return n}();void 0===(o=function(){return i}.call(e,r,e,t))||(t.exports=o)},532:(t,e,r)=>{"use strict";var o;(o="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)||"undefined"!=typeof navigator&&"ReactNative"===navigator.product?r.g:self).Proxy||(o.Proxy=r(780)(),o.Proxy.revocable=o.Proxy.revocable)},780:t=>{t.exports=function(){let t,e=null;function r(t){return!!t&&("object"==typeof t||"function"==typeof t)}function o(t){if(null!==t&&!r(t))throw new TypeError("Object prototype may only be an Object or null: "+t)}const i=Object,n=Boolean(i.create)||!({__proto__:null}instanceof i),s=i.create||(n?function(t){return o(t),{__proto__:t}}:function(t){if(o(t),null===t)throw new SyntaxError("Native Object.create is required to create objects with null prototype");var e=function(){};return e.prototype=t,new e}),a=function(){return null},l=i.getPrototypeOf||([].__proto__===Array.prototype?function(t){const e=t.__proto__;return r(e)?e:null}:a);return t=function(d,c){if(void 0===(this&&this instanceof t?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!r(d)||!r(c))throw new TypeError("Cannot create proxy with a non-object as target or handler");let h=function(){};e=function(){d=null,h=function(t){throw new TypeError(`Cannot perform '${t}' on a proxy that has been revoked`)}},setTimeout((function(){e=null}),0);const u=c;c={get:null,set:null,apply:null,construct:null};for(let t in u){if(!(t in c))throw new TypeError(`Proxy polyfill does not support trap '${t}'`);c[t]=u[t]}"function"==typeof u&&(c.apply=u.apply.bind(u));const f=l(d);let _,w=!1,p=!1;"function"==typeof d?(_=function(){const t=this&&this.constructor===_,e=Array.prototype.slice.call(arguments);return h(t?"construct":"apply"),t&&c.construct?c.construct.call(this,d,e):!t&&c.apply?c.apply(d,this,e):t?(e.unshift(d),new(d.bind.apply(d,e))):d.apply(this,e)},w=!0):d instanceof Array?(_=[],p=!0):_=n||null!==f?s(f):{};const b=c.get?function(t){return h("get"),c.get(this,t,_)}:function(t){return h("get"),this[t]},m=c.set?function(t,e){h("set"),c.set(this,t,e,_)}:function(t,e){h("set"),this[t]=e},y=i.getOwnPropertyNames(d),g={};y.forEach((function(t){if((w||p)&&t in _)return;const e=i.getOwnPropertyDescriptor(d,t),r={enumerable:Boolean(e.enumerable),get:b.bind(d,t),set:m.bind(d,t)};i.defineProperty(_,t,r),g[t]=!0}));let v=!0;if(w||p){const t=i.setPrototypeOf||([].__proto__===Array.prototype?function(t,e){return o(e),t.__proto__=e,t}:a);f&&t(_,f)||(v=!1)}if(c.get||!v)for(let t in d)g[t]||i.defineProperty(_,t,{get:b.bind(d,t)});return i.seal(d),i.seal(_),_},t.revocable=function(r,o){return{proxy:new t(r,o),revoke:e}},t}},196:t=>{!function(){"use strict";t.exports={polyfill:function(){var t=window,e=document;if(!("scrollBehavior"in e.documentElement.style)||!0===t.__forceSmoothScrollPolyfill__){var r,o=t.HTMLElement||t.Element,i=468,n={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:o.prototype.scroll||l,scrollIntoView:o.prototype.scrollIntoView},s=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,a=(r=t.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(r)?1:0);t.scroll=t.scrollTo=function(){void 0!==arguments[0]&&(!0!==d(arguments[0])?_.call(t,e.body,void 0!==arguments[0].left?~~arguments[0].left:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:t.scrollY||t.pageYOffset):n.scroll.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:t.scrollY||t.pageYOffset))},t.scrollBy=function(){void 0!==arguments[0]&&(d(arguments[0])?n.scrollBy.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):_.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset)))},o.prototype.scroll=o.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==d(arguments[0])){var t=arguments[0].left,e=arguments[0].top;_.call(this,this,void 0===t?this.scrollLeft:~~t,void 0===e?this.scrollTop:~~e)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},o.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==d(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},o.prototype.scrollIntoView=function(){if(!0!==d(arguments[0])){var r=function(t){for(;t!==e.body&&!1===u(t);)t=t.parentNode||t.host;return t}(this),o=r.getBoundingClientRect(),i=this.getBoundingClientRect();r!==e.body?(_.call(this,r,r.scrollLeft+i.left-o.left,r.scrollTop+i.top-o.top),"fixed"!==t.getComputedStyle(r).position&&t.scrollBy({left:o.left,top:o.top,behavior:"smooth"})):t.scrollBy({left:i.left,top:i.top,behavior:"smooth"})}else n.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function l(t,e){this.scrollLeft=t,this.scrollTop=e}function d(t){if(null===t||"object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return!0;if("object"==typeof t&&"smooth"===t.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+t.behavior+" is not a valid value for enumeration ScrollBehavior.")}function c(t,e){return"Y"===e?t.clientHeight+a<t.scrollHeight:"X"===e?t.clientWidth+a<t.scrollWidth:void 0}function h(e,r){var o=t.getComputedStyle(e,null)["overflow"+r];return"auto"===o||"scroll"===o}function u(t){var e=c(t,"Y")&&h(t,"Y"),r=c(t,"X")&&h(t,"X");return e||r}function f(e){var r,o,n,a,l=(s()-e.startTime)/i;a=l=l>1?1:l,r=.5*(1-Math.cos(Math.PI*a)),o=e.startX+(e.x-e.startX)*r,n=e.startY+(e.y-e.startY)*r,e.method.call(e.scrollable,o,n),o===e.x&&n===e.y||t.requestAnimationFrame(f.bind(t,e))}function _(r,o,i){var a,d,c,h,u=s();r===e.body?(a=t,d=t.scrollX||t.pageXOffset,c=t.scrollY||t.pageYOffset,h=n.scroll):(a=r,d=r.scrollLeft,c=r.scrollTop,h=l),f({scrollable:a,method:h,startTime:u,startX:d,startY:c,x:o,y:i})}}}}()}},e={};function r(o){var i=e[o];if(void 0!==i)return i.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,r),n.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var o in e)r.o(e,o)&&!r.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(196),e=r.n(t);r(532);try{e().polyfill()}catch(t){console.log(t)}let o;function i(t,e){var r=document.createRange(),o=window.getSelection();r.setStart(t,e),r.collapse(!0),o.removeAllRanges(),o.addRange(r)}function n(t,e){return"*"===e&&console.error("store: option id '*' is reserved! will lead to unexpected behavior"),"__"+t+"_$"+e}function s(t,e){return e.startsWith("__"+t+"_$")}function a(t,e){return e.substring(4+t.length,e.length)}o=window,Array.from||(Array.from=function(){let t=Object.prototype.toString,e=function(e){return"function"==typeof e||"[object Function]"===t.call(e)},r=Math.pow(2,53)-1;return function(t){let o=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");let i,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!e(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}let s,a=function(t){let e=function(t){let e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),r)}(o.length),l=e(this)?Object(new this(a)):new Array(a),d=0;for(;d<a;)s=o[d],l[d]=n?void 0===i?n(s,d):n.call(i,s,d):s,d+=1;return l.length=a,l}}()),o.t_delay=t=>new Promise((e=>setTimeout(e,t))),o.t_in=(t,e)=>t.hasOwnProperty(e),o.t_arrayBufferToBase64=function(t){let e="";return[].slice.call(new Uint8Array(t)).forEach((t=>e+=String.fromCharCode(t))),o.btoa(e)},o.t_getImage=function(t,e=!1){return new Promise(((r,o)=>{try{if(t.startsWith("chrome://"))r();else{let i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let t=i.getResponseHeader("Content-Type").trim();if(t.startsWith("image/")){let e="data:"+t+";charset=utf-8;base64,",o=t_arrayBufferToBase64(i.response);r(e+o)}else o('Image Request Failed: Content-Type is not an image! (Content-Type: "'+t+'")')}else o(this.status)},i.responseType="arraybuffer",i.open("GET",t,!0),e&&i.setRequestHeader("Cache-Control","no-store"),i.send()}}catch(t){o(t.message)}}))},o.t_ctrlCmdKey=function(){return navigator.platform.indexOf("Mac")>=0||"iPhone"===navigator.platform?"Meta":"Control"},o.t_getElementsBetween=function(t,e,r=t=>!0){if(!t.parentElement.isSameNode(e.parentElement))return;if(t.isSameNode(e))return[];let o=[],i=t=>t.nextElementSibling;t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING&&(i=t=>t.previousElementSibling);let n=i(t);for(;n&&!n.isSameNode(e);)r(n)&&o.push(n),n=i(n);return o},o.t_getInView=function(t,e,r){let o=e.getBoundingClientRect(),i=t.getBoundingClientRect();(o.y>i.y||o.y>i.y+i.height||i.y>=o.y+o.height||i.y+i.height>=o.y+o.height)&&t.scrollIntoView(r)},o.t_getCaretPosition=function(t){var e,r=0,o=t.ownerDocument||t.document,i=o.defaultView||o.parentWindow;if(void 0!==i.getSelection){if((e=i.getSelection()).rangeCount>0){var n=i.getSelection().getRangeAt(0),s=n.cloneRange();s.selectNodeContents(t),s.setEnd(n.endContainer,n.endOffset),r=s.toString().length}}else if((e=o.selection)&&"Control"!=e.type){var a=e.createRange(),l=o.body.createTextRange();l.moveToElementText(t),l.setEndPoint("EndToEnd",a),r=l.text.length}return r},o.t_setCaretPosition=function(t,e){let r=0,o=e;for(let n of t.childNodes)if(n.nodeType===Node.TEXT_NODE){if(r+=n.nodeValue.length,e<=r)return void i(n,o);o-=n.nodeValue.length}else if(n.nodeType===Node.ELEMENT_NODE){let t=n.innerText;if(r+=t.length,e<=r)return void t_setCaretPosition(n,o);o-=t.length}},o.t_stripHtml=function(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""},o.t_byteLen=t=>new Blob([t]).size,o.t_chunkSubstr=function(t,e){const r=Math.ceil(t.length/e),o=new Array(r);for(let i=0,n=0;i<r;++i,n+=e)o[i]=t.substr(n,e);return o},o.t_chunkBytes=function(t,e){let r=Math.ceil(t_byteLen(t)/e),o=new Array(r),i=0;o[i]="";for(const r of t){let t=o[i]+r;t_byteLen(t)>e?(i++,i>=o.length&&o.push(""),o[i]=r):o[i]=t}return o},o.t_browserDetection=function(){return browser.runtime.getURL("/").startsWith("moz")?"moz":"chromium"},o.t_getKeyboardFocusableElements=(t=document)=>[...t.querySelectorAll('a[href], button, input, textarea, select, details,[tabindex]:not([tabindex="-1"])')].filter((t=>!t.hasAttribute("disabled")&&!t.getAttribute("aria-hidden"))),o.t_resetAnimation=function(t){t.style.animation="none",t.offsetHeight,t.style.animation=null},o.t_tryParseJSONObject=function(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1},o.t_sanitizeXMLTags=function(t){return t.replace(/<\/?([a-zA-Z0-9]+)>/g,(t=>t.replace("<","&lt;").replace(">","&gt;")))},o.t_errorToString=t=>`${t.toString()}\n${t.stack||"No stack trace available."}`;const l=t=>n(t,"___DELONSTART");class d extends Error{}class c{constructor(t,e="conf",r=!1){this.type=t,this.name=e,this.tmp=r,this.__fulfillers={},this.__modifierPromises={}}async modify(t,e,r=!0){let o=this.__modifierPromises[t];return this.__modifierPromises[t]=new Promise((async(i,s)=>{try{o&&await o;let s=r?await this.getOne(t):void 0,a=e(s);a instanceof Promise&&(a=await a),void 0!==a&&await this.__set(n(this.name,t),a),i()}catch(e){console.error(`storage modification for property "${t}" failed with the following error:`),console.error(e),i()}})),this.__modifierPromises[t]}async modifyAll(t,e,...r){let o=r.map((t=>this.__modifierPromises[t])),i=new Promise((async(i,n)=>{try{for(let t of o)void 0!==t&&await t;let n=e?await this.get(...r):void 0,s=t(n);s instanceof Promise&&(s=await s),void 0!==s&&await this.__setAll(s),i()}catch(t){console.error(`storage modification for properties "${r}" failed with the following error:`),console.error(t),i()}}));for(let t of r)this.__modifierPromises[t]=i;return i}special(t){return n(this.name,t)}isSpecial(t){return s(this.name,t)}normal(t){return a(this.name,t)}__delOnStart(){return this.modify(l(this.name),(async()=>{let t=await this.__getOne(l(this.name));if(t)return console.log("[store] delOnStart exists: "),console.log(t),this.modifyAll((()=>(console.log("[store] deleting"),this.__unset(...t))),!1,...t).then((()=>this.__set(l(this.name),[])));this.__set(l(this.name),[])}),!1)}__chunkNumber(t,e,r="_part"){return parseInt(e.substring(t.length+r.length))}async storeLarge(t,e,r=8092){const o=t_chunkBytes(e,r),i=await this.getKeys();let n=[];for(let e of i)e.startsWith(t)&&this.__chunkNumber(t,e)>=o.length&&n.push(e);let s={};for(let[e,r]of o.entries())s[t+"_part"+e]=r;await this.unset(...n);try{await this.setAll(s,!0)}catch(t){throw await this.unset(...Object.keys(s)),new d("storeLarge failed! error: "+t)}}async retrieveLarge(t){const e=await this.getKeys();let r=[],o=0;for(let i of e)if(i.startsWith(t)){r.push(i);let e=this.__chunkNumber(t,i);e>o&&(o=e)}let i=await this.get(...r),n="";for(let e=0;e<=o;e++)n+=i[t+"_part"+e];return n}async hasOne(t){return t=n(this.name,t),(await browser.storage[this.type].get(t)).hasOwnProperty(t)}async has(...t){let e={};for(let r of t)e[r]=await this.hasOne(r);return e}unset(...t){return this.modifyAll((async()=>{let e=await this.__getOne(l(this.name));for(let r of t){let t=e.indexOf(r);-1!==t&&e.splice(t,1)}await this.__set(l(this.name),e),await this.__unset(...t)}),!1,l(this.name),...t)}async __unset(...t){return browser.storage[this.type].remove(t.map((t=>n(this.name,t))))}set(t,e){return this.modifyAll((async()=>{let r=await this.__getOne(l(this.name));r=r||[],r.includes(t)||r.push(t),await this.__set(l(this.name),r),await this.__set(n(this.name,t),e)}),!1,l(this.name),t)}async __set(t,e){let r={};return r[t]=e,browser.storage[this.type].set(r)}async setAll(t,e=!1){for(let r in t)t.hasOwnProperty(r)&&(!e&&await this.hasOne(r)||await this.set(r,t[r]))}async __setAll(t,e=!1){for(let r in t)t.hasOwnProperty(r)&&(!e&&await this.hasOne(r)||await this.__set(n(this.name,r),t[r]))}async getOne(t){return this.__getOne(n(this.name,t))}async __getOne(t){return(await browser.storage[this.type].get(t))[t]}async getKeys(){return this.__getOne(l(this.name))}async get(...t){let e={};for(let r of t)e[r]=await this.getOne(r);return e}__manual_fulfill(t,e,r){return Promise.resolve(r(e,t))}async __fulfill(t,e){return this.__manual_fulfill(t,await this.getOne(t),e)}async fulfillOnce(t,e,r=void 0){return void 0!==r&&(await this.hasOne(t)||await this.set(t,r)),this.__fulfill(t,e)}addFulfiller(t,e){this.__fulfillers.hasOwnProperty(t)||(this.__fulfillers[t]=[]),this.__fulfillers[t].push(e)}removeFulfiller(t,e){if(this.__fulfillers.hasOwnProperty(t)){let r=this.__fulfillers[t].indexOf(e);-1!==r&&this.__fulfillers[t].splice(r,1)}}async fulfill(t,e,r=void 0){return void 0!==r&&(await this.hasOne(t)||await this.set(t,r)),this.addFulfiller(t,e),this.fulfillOnce(t,e,void 0)}async __onChange(t){console.log(Object.keys(t));for(let e in t)if(t.hasOwnProperty(e)&&s(this.name,e)){let r=a(this.name,e);this.__fulfillers.hasOwnProperty(r)&&this.__fulfillers[r].forEach((o=>this.__manual_fulfill(r,t[e].newValue,o))),this.__fulfillers.hasOwnProperty("*")&&this.__fulfillers["*"].forEach((o=>this.__manual_fulfill(r,t[e].newValue,o)))}}}const h=new c("local"),u=new c("sync"),f=new c("local","temp",!0),_=new c("sync","temp",!0);browser.storage.onChanged.addListener((async(t,e)=>{switch(e){case"local":await h.__onChange(t),await f.__onChange(t);break;case"sync":await u.__onChange(t),await _.__onChange(t)}}));class w{constructor(){this.state=!1}requiresSetup(){return!this.state}started(){this.state=!0}}new w;const p=["favIconUrl","isArticle","mutedInfo","pinned","title","url","attention","audible","hidden","status","discarded"].concat(["isInReaderMode","lastAccessed"],["active"],[],["windowId"],["cookieStoreId","incognito","openerTabId","id"]),b=["favIconUrl","isArticle","mutedInfo","pinned","title","url","hidden","discarded","isInReaderMode","lastAccessed","active","windowId","cookieStoreId","incognito","openerTabId"];class m{constructor(){for(let t of p)this[t]=void 0}proxy(t,e){void 0===this._proxies&&(this._proxies=[]);let r={};for(let t of p)r[t]=this[t];const o={set:(e,r,o)=>(t(r,o),e[r]=o,!0)};let i=Proxy.revocable(r,o);return this._proxies.push({proxy:i,revoked:e,handler:t}),i}_proxy_helper(t,e){if(this._proxies)for(let{proxy:r}of this._proxies)r.proxy[t]=e}clearProxies(){if(this._proxies){for(let{proxy:t,revoked:e}of this._proxies)e(),t.revoke();this._proxies=void 0}}mergeChanges(t){for(let e in t)t_in(t,e)&&-1!=p.indexOf(e)&&(this[e]=t[e],this._proxy_helper(e,t[e]))}onClosed(){this.clearProxies()}onMoved(t,e){if(this._proxies)for(let{handler:r}of this._proxies)r("#position",{newWindowId:t,newPosition:e})}serialize(t){let e={};for(let r of t)e[r]=this[r];return e}get mozContextualIdentity(){return browser.contextualIdentities&&!["firefox-default","firefox-private"].includes(this.cookieStoreId)?browser.contextualIdentities.get(this.cookieStoreId):Promise.resolve(!1)}get full(){return browser.tabs.get(this.id)}get index(){return this.full.then((t=>t.index))}static toTab(t,e,r){let o={active:t.active,pinned:t.pinned,url:t.url,windowId:e};return r&&(o.cookieStoreId=r),o.discarded=t.discarded,o.openInReaderMode=t.isInReaderMode,o.title=t.discarded?t.title:void 0,o.muted=t.mutedInfo.muted,browser.tabs.create(o)}static fromTab(t){let e=new m;for(let r of p)e[r]=t[r];return e}static fromSerialized(t){let e=new m;return e.mergeChanges(t),e}}class y{constructor(){this._first=void 0,this._last=void 0,this._data=[],this._free=[],this._length=0}_allocate_space(){let t;return this._free.length>0?t=this._free.pop():(this._data.push(void 0,void 0),t=this._data.length-2),null!=this._first&&null!=this._last||(this._first=t,this._last=t),t}_recycle_space(t){this._data[t]=void 0,this._data[t+1]=void 0,this._free.push(t)}append(t){let e=this._allocate_space();this._data[e]=t,this._data[e+1]=void 0,this._last!==e&&(this._data[this._last+1]=e),this._last=e,this._length++}_indexInDataArray(t){return this._data.findIndex(((e,r)=>r%2==0&&t==e))}_pointerIndexInDataArray(t){return this._data.findIndex(((e,r)=>r%2==1&&t==e))}indexOf(t){let e=0,r=this._first;for(;;){if(null==r)return-1;if(t==this._data[r])return e;r=this._data[r+1],e++}}_translateListIndexToDataArrIndex(t){if(this._length<1)return-1;{let e=0,r=this._first;for(;;){if(null==r)return-1;if(e==t)return r;r=this._data[r+1],e++}}}_replaceMatchingNextPointerWith(t,e){let r=this._pointerIndexInDataArray(t);return this._data[r]=e,r}remove(t){let e=this._indexInDataArray(t);if(-1==e)return!1;if(e==this._first&&e==this._last)this._first=void 0,this._last=void 0;else if(e==this._first)this._first=this._data[e+1];else if(e==this._last){let t=this._replaceMatchingNextPointerWith(e,void 0);this._last=t-1}else this._replaceMatchingNextPointerWith(e,this._data[e+1]);return this._recycle_space(e),this._length--,!0}insert(t,e){let r=this._allocate_space();this._data[r]=t;let o=this._translateListIndexToDataArrIndex(e);-1==o?(this._last!==r&&(this._data[this._last+1]=r),this._last=r,o=void 0):-1==this._replaceMatchingNextPointerWith(o,r)&&(this._first=r),this._data[r+1]=o,this._length++}move(t,e){this.indexOf(t)!=e&&(this.remove(t),this.insert(t,e))}toString(){let t="[",e=this._first;for(;void 0!==e;)t+=this._data[e]+", ",e=this._data[e+1];return t}toArray(){let t=[],e=this._first;for(;void 0!==e;)t.push(this._data[e]),e=this._data[e+1];return t}static fromArray(t){let e=new y;for(let r of t)e.append(r);return e}get length(){return this._length}}class g{constructor(...t){this.ids=t}activate(){return browser.tabs.update(this.ids[0],{active:!0})}pin(t){return Promise.all(this.ids.map((e=>browser.tabs.update(e,{pinned:t}))))}mute(t){return Promise.all(this.ids.map((e=>browser.tabs.update(e,{muted:t}))))}openerTabId(t){return Promise.all(this.ids.map((e=>browser.tabs.update(e,{openerTabId:t}))))}reload(t=!1){return Promise.all(this.ids.map((e=>browser.tabs.reload(e,{bypassCache:t}))))}discard(){return browser.tabs.discard(this.ids)}remove(){return browser.tabs.remove(this.ids)}captureTab(t,e){return browser.tabs.captureTab?new Promise(((r,o)=>{browser.tabs.captureTab(this.ids[0],e).then((e=>{t.aborted||r(e)})),t.onabort=o})):Promise.resolve(void 0)}moveTo(t,e){return g.move(this.ids,t,e)}static move(t,e,r){return browser.tabs.move(t,{windowId:e,index:r})}}class v{constructor(...t){this.ids=t}activate(){return browser.windows.update(this.ids[0],{focused:!0})}remove(){return Promise.all(this.ids.map((t=>browser.windows.remove(t))))}titlePreface(t){return Promise.all(this.ids.map((e=>browser.windows.update(e,{titlePreface:t}))))}}class I{constructor(){this._worder=new y,this._order={},this._active={},this._focusedWindow=-1,this._naming={}}setFocusedWindow(t){this._focusedWindow=t}getFocusedWindow(){return this._focusedWindow}async reloadNamesFromTemporaryStore(){for(let t in this._naming)if(this._naming.hasOwnProperty(t)){let e=await f.getOne(`window${t}`);e&&(this._naming[t]=e)}}async setName(t,e){await browser.runtime.sendMessage({_:"__ping",id:"listenForUpdatesToWindowName"}),""===e.trim()?(e=void 0,f.unset(`window${t}`),new v(t).titlePreface("")):(f.set(`window${t}`,e),new v(t).titlePreface(`[${e}] `)),this._naming[t]=e}getName(t){return this._naming[t]}setActiveTab(t,e){this._active[t]=e}getActiveTab(t){return this._active[t]}hasWindow(t){return t_in(this._order,t)}registerWindow(t){this._order[t]=new y,this._active[t]=-1,this._naming[t]=void 0,this._worder.append(t)}unregisterWindow(t){delete this._order[t],delete this._active[t],delete this._naming[t],this._worder.remove(t)}appendTabToWindow(t,e,r=!0){this._order[t].insert(e.id,e.index),e.active&&r&&(this._active[t]=e.id)}removeTabFromWindow(t,e){this._order[t].remove(e)}insertTabIntoWindow(t,e,r){this._order[t].insert(e,r)}moveTabWithinWindow(t,e,r){this._order[t].move(e,r)}getWindowIds(){return this._worder.toArray()}getAllAs2DArray(){let t=this._worder.toArray(),e=[];for(let r of t)e.push(this._order[r].toArray());return e}toSerializable(){let t=this._worder.toArray(),e={};for(let t in this._order)this._order.hasOwnProperty(t)&&(e[t]=this._order[t].toArray());return{worder:t,order:e,active:this._active,focusedWindow:this._focusedWindow,naming:this._naming}}static fromSerializable(t){let e=new I;e._worder=y.fromArray(t.worder);for(let r in t.order)t.order.hasOwnProperty(r)&&(e._order[r]=y.fromArray(t.order[r]));return e._active=t.active,e._focusedWindow=t.focusedWindow,e._naming=t.naming,e}}function x(t,e,r){return browser.tabs.sendMessage(t,{target:e,data:r})}class T{constructor(){this._listeners=[],this._tabs={},this._rel=new I,this._tab_updated_hook=(t,e)=>{this._tabs[t].mergeChanges(e)},this._tab_activated_hook=t=>{console.log(t.windowId," => ",t.tabId),this._tabs[this._rel.getActiveTab(t.windowId)]&&this._tabs[this._rel.getActiveTab(t.windowId)].mergeChanges({active:!1}),this._rel.setActiveTab(t.windowId,t.tabId),this._tabs[t.tabId].mergeChanges({active:!0})},this._tab_moved_hook=(t,e)=>{this._rel.moveTabWithinWindow(e.windowId,t,e.toIndex),this._tabs[t].onMoved(e.windowId,e.toIndex)},this._tab_attached_hook=(t,e)=>{this._rel.removeTabFromWindow(this._tabs[t].windowId,t),this._rel.insertTabIntoWindow(e.newWindowId,t,e.newPosition),this._tabs[t].mergeChanges({windowId:e.newWindowId}),this._tabs[t].onMoved(e.newWindowId,e.newPosition)},this._tab_removed_hook=(t,e)=>{this._rel.removeTabFromWindow(e.windowId,t),this._tabs[t].onClosed(),setTimeout((()=>delete this._tabs[t]),1e3)},this._tab_created_hook=t=>{this._rel.hasWindow(t.windowId)||this._rel.registerWindow(t.windowId),this._rel.appendTabToWindow(t.windowId,t,!1),this._tabs[t.id]=m.fromTab(t);for(let e of this._listeners)e.onTabCreated&&e.onTabCreated(this._tabs[t.id])},this._window_removed_hook=t=>{for(let e of this._listeners)e.onWindowClosed&&e.onWindowClosed(t);this._rel.unregisterWindow(t)},this._window_created_hook=t=>{for(let e of this._listeners)e.onWindowCreated&&e.onWindowCreated(t)},this._window_focus_changed_hook=t=>{t=t===browser.windows.WINDOW_ID_NONE?-1:t,this._rel.setFocusedWindow(t);for(let e of this._listeners)e.onWindowFocusChanged&&e.onWindowFocusChanged(t)}}addListener(t){this._listeners.push(t)}hasListener(t){return-1!==this._listeners.indexOf(t)}removeListener(t){let e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}getAllTabIdsAsStrings(){let t=[];for(let e in this._tabs)this._tabs.hasOwnProperty(e)&&t.push(e);return t}getTab(t){return this._tabs[t]}getTabActions(t){return new g(t)}getWindowActions(t){return new v(t)}enableBrowserHooks(){browser.tabs.onUpdated.addListener(this._tab_updated_hook),browser.tabs.onActivated.addListener(this._tab_activated_hook),browser.tabs.onMoved.addListener(this._tab_moved_hook),browser.tabs.onAttached.addListener(this._tab_attached_hook),browser.tabs.onRemoved.addListener(this._tab_removed_hook),browser.tabs.onCreated.addListener(this._tab_created_hook),browser.windows.onRemoved.addListener(this._window_removed_hook),browser.windows.onCreated.addListener(this._window_created_hook),browser.windows.onFocusChanged.addListener(this._window_focus_changed_hook)}getAllAs2DArray(){return this._rel.getAllAs2DArray().map((t=>t.map((t=>this._tabs[t]))))}get mozContextualIdentities(){return browser.contextualIdentities?browser.contextualIdentities.query({}):Promise.resolve(void 0)}static async read_from_current(){let t=new T,e=await browser.tabs.query({});for(let r of e)t._rel.hasWindow(r.windowId)||(t._rel.registerWindow(r.windowId),(await browser.windows.get(r.windowId,{populate:!1})).focused&&t._rel.setFocusedWindow(r.windowId)),t._rel.appendTabToWindow(r.windowId,r),t._tabs[r.id]=m.fromTab(r);return await t._rel.reloadNamesFromTemporaryStore(),t}async toSerializable(){let t={};for(let e in this._tabs)if(this._tabs.hasOwnProperty(e)){let r=this._tabs[e],o=r.serialize(b);try{let t=await x(r.id,"packd",{action:"favicon"});if(0===t.length)try{let e=new URL("/favicon.ico",r.url).href;await t_getImage(e,r.incognito),t.push({href:e,sizes:""})}catch(t){}if(0!==t.length){let e=new URL(t[t.length-1].href,r.url).href;o.favIconUrl=e}}catch(t){console.error(`could not contact tab ${e}, error: ${t}`)}t[e]=o}return{tabs:t,rel:this._rel.toSerializable()}}static fromSerializable(t){let e=new T;for(let r in t.tabs)t.tabs.hasOwnProperty(r)&&(e._tabs[r]=m.fromSerialized(t.tabs[r]));return e._rel=I.fromSerializable(t.rel),e}async openAll(t=void 0){let e,r=this.getAllAs2DArray();for(let o of r){let r=await browser.windows.create({focused:this._rel._focusedWindow===o[0].windowId,incognito:o[0].incognito});this._rel._focusedWindow===o[0].windowId&&(e=r);for(let e of o)try{let o=await m.toTab(e,r.id,t?t[e.cookieStoreId]:void 0);await new g(o.id).openerTabId(e.openerTabId),await new g(o.id).mute(e.mutedInfo.muted)}catch(t){console.error("could not recreate tab",e,"due to",t)}if(r.tabs.length>0)try{await new g(r.tabs[0].id).remove()}catch(t){console.error(`could not clear away the opened-by-default tab in window ${r.id}`,t)}let i=this._rel.getName(o[0].windowId);this._rel.setName(r.id,i||"")}e&&await new v(e.id).activate()}}var A=r(992),O=r.n(A);let P="major-update";var C=r(467);browser.runtime.onInstalled.addListener((({reason:t})=>{"browser_update"!==t&&"chrome_update"!==t&&"shared_module_update"!==t&&h.fulfillOnce("option:show-whats-new-on",(t=>{("update"===t||C.EXT_IS_MAJOR_RELEASE&&"major-update"===t)&&browser.tabs.create({active:!0,url:"https://github.com/Bill13579/tabby/wiki/3.2-The-Uwa!!-So-QoL%E2%99%AB-Update"})}),P)})),browser.contextMenus.onClicked.addListener((async(t,e)=>{if(t.menuItemId.startsWith("tabby-send-tab-to-")){let r=t.menuItemId.replace("tabby-send-tab-to-",""),o=(await browser.tabs.query({highlighted:!0})).map((t=>t.id)),i=[e.id];switch(o.includes(e.id)&&(i=o),r){case"":break;case"-":case"new":await W(i,e.id);break;default:await browser.tabs.move(i,{windowId:parseInt(r),index:-1})}}}));let S=async()=>{await browser.contextMenus.removeAll();let t=["audio","editable","frame","image","link","page","selection","video"];t.push("tab"),await browser.contextMenus.create({id:"tabby-send-tab-to-",title:"Send Tab to...",contexts:t});let e=await browser.windows.getAll({populate:!1,windowTypes:["normal"]});for(let t=0;t<e.length;t++){let r=e[t].id,o=await f.getOne(`window${r}`);await browser.contextMenus.create({parentId:"tabby-send-tab-to-",id:`tabby-send-tab-to-${r}`,title:o||"Window "+(t+1)})}await browser.contextMenus.create({parentId:"tabby-send-tab-to-",id:"tabby-send-tab-to--",type:"separator"}),await browser.contextMenus.create({parentId:"tabby-send-tab-to-",id:"tabby-send-tab-to-new",title:"A New Window"})};async function W(t,e){if(t.length>0){let r=await browser.tabs.get(e),o=await browser.windows.create({incognito:r.incognito});await new g(...t).moveTo(o.id,-1),o.tabs.length>0&&await new g(o.tabs[0].id).remove()}}S(),browser.windows.onCreated.addListener((async t=>{await S()})),browser.windows.onRemoved.addListener((async t=>{await S()})),browser.runtime.onMessage.addListener((t=>{if("sflv1_openSession"!==t._)return;let{store:e,mozContextualIdentityMap:r}=t;"local"===e?e=h:"sync"===e&&(e=u),e.getOne("sflv1_rel").then((t=>{e.retrieveLarge("sflv1_tabs").then((async e=>{let o=T.fromSerializable({rel:JSON.parse(t),tabs:JSON.parse(O().decompressFromUTF16(e))});await o.openAll(r)}))}))})),browser.runtime.onMessage.addListener((t=>{if("menuMoveTabsToANewWindow"===t._)return W(t.tabIds,t.anchorId)}));let M=new w;browser.runtime.onMessage.addListener((t=>{if("__ping"===t._&&"listenForUpdatesToWindowName"===t.id)return M.requiresSetup()&&(f.addFulfiller("*",(async(t,e)=>{if(!e.startsWith("window"))return;let r=parseInt(e.replace("window",""));if(isNaN(r))return;let o=await browser.windows.getAll({populate:!1,windowTypes:["normal"]}),i=0;for(let t of o){if(t.id===r)break;i++}await browser.contextMenus.update(`tabby-send-tab-to-${r}`,{title:t||"Window "+(i+1)})})),M.started()),Promise.resolve()}))})()})();