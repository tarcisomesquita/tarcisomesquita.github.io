(()=>{var t={532:(t,e,r)=>{"use strict";var o;(o="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)||"undefined"!=typeof navigator&&"ReactNative"===navigator.product?r.g:self).Proxy||(o.Proxy=r(780)(),o.Proxy.revocable=o.Proxy.revocable)},780:t=>{t.exports=function(){let t,e=null;function r(t){return!!t&&("object"==typeof t||"function"==typeof t)}function o(t){if(null!==t&&!r(t))throw new TypeError("Object prototype may only be an Object or null: "+t)}const i=Object,n=Boolean(i.create)||!({__proto__:null}instanceof i),s=i.create||(n?function(t){return o(t),{__proto__:t}}:function(t){if(o(t),null===t)throw new SyntaxError("Native Object.create is required to create objects with null prototype");var e=function(){};return e.prototype=t,new e}),a=function(){return null},l=i.getPrototypeOf||([].__proto__===Array.prototype?function(t){const e=t.__proto__;return r(e)?e:null}:a);return t=function(c,u){if(void 0===(this&&this instanceof t?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!r(c)||!r(u))throw new TypeError("Cannot create proxy with a non-object as target or handler");let h=function(){};e=function(){c=null,h=function(t){throw new TypeError(`Cannot perform '${t}' on a proxy that has been revoked`)}},setTimeout((function(){e=null}),0);const f=u;u={get:null,set:null,apply:null,construct:null};for(let t in f){if(!(t in u))throw new TypeError(`Proxy polyfill does not support trap '${t}'`);u[t]=f[t]}"function"==typeof f&&(u.apply=f.apply.bind(f));const d=l(c);let w,p=!1,_=!1;"function"==typeof c?(w=function(){const t=this&&this.constructor===w,e=Array.prototype.slice.call(arguments);return h(t?"construct":"apply"),t&&u.construct?u.construct.call(this,c,e):!t&&u.apply?u.apply(c,this,e):t?(e.unshift(c),new(c.bind.apply(c,e))):c.apply(this,e)},p=!0):c instanceof Array?(w=[],_=!0):w=n||null!==d?s(d):{};const y=u.get?function(t){return h("get"),u.get(this,t,w)}:function(t){return h("get"),this[t]},m=u.set?function(t,e){h("set"),u.set(this,t,e,w)}:function(t,e){h("set"),this[t]=e},b=i.getOwnPropertyNames(c),g={};b.forEach((function(t){if((p||_)&&t in w)return;const e=i.getOwnPropertyDescriptor(c,t),r={enumerable:Boolean(e.enumerable),get:y.bind(c,t),set:m.bind(c,t)};i.defineProperty(w,t,r),g[t]=!0}));let v=!0;if(p||_){const t=i.setPrototypeOf||([].__proto__===Array.prototype?function(t,e){return o(e),t.__proto__=e,t}:a);d&&t(w,d)||(v=!1)}if(u.get||!v)for(let t in c)g[t]||i.defineProperty(w,t,{get:y.bind(c,t)});return i.seal(c),i.seal(w),w},t.revocable=function(r,o){return{proxy:new t(r,o),revoke:e}},t}},196:t=>{!function(){"use strict";t.exports={polyfill:function(){var t=window,e=document;if(!("scrollBehavior"in e.documentElement.style)||!0===t.__forceSmoothScrollPolyfill__){var r,o=t.HTMLElement||t.Element,i=468,n={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:o.prototype.scroll||l,scrollIntoView:o.prototype.scrollIntoView},s=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,a=(r=t.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(r)?1:0);t.scroll=t.scrollTo=function(){void 0!==arguments[0]&&(!0!==c(arguments[0])?w.call(t,e.body,void 0!==arguments[0].left?~~arguments[0].left:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:t.scrollY||t.pageYOffset):n.scroll.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:t.scrollY||t.pageYOffset))},t.scrollBy=function(){void 0!==arguments[0]&&(c(arguments[0])?n.scrollBy.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):w.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset)))},o.prototype.scroll=o.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==c(arguments[0])){var t=arguments[0].left,e=arguments[0].top;w.call(this,this,void 0===t?this.scrollLeft:~~t,void 0===e?this.scrollTop:~~e)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},o.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==c(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},o.prototype.scrollIntoView=function(){if(!0!==c(arguments[0])){var r=function(t){for(;t!==e.body&&!1===f(t);)t=t.parentNode||t.host;return t}(this),o=r.getBoundingClientRect(),i=this.getBoundingClientRect();r!==e.body?(w.call(this,r,r.scrollLeft+i.left-o.left,r.scrollTop+i.top-o.top),"fixed"!==t.getComputedStyle(r).position&&t.scrollBy({left:o.left,top:o.top,behavior:"smooth"})):t.scrollBy({left:i.left,top:i.top,behavior:"smooth"})}else n.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function l(t,e){this.scrollLeft=t,this.scrollTop=e}function c(t){if(null===t||"object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return!0;if("object"==typeof t&&"smooth"===t.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+t.behavior+" is not a valid value for enumeration ScrollBehavior.")}function u(t,e){return"Y"===e?t.clientHeight+a<t.scrollHeight:"X"===e?t.clientWidth+a<t.scrollWidth:void 0}function h(e,r){var o=t.getComputedStyle(e,null)["overflow"+r];return"auto"===o||"scroll"===o}function f(t){var e=u(t,"Y")&&h(t,"Y"),r=u(t,"X")&&h(t,"X");return e||r}function d(e){var r,o,n,a,l=(s()-e.startTime)/i;a=l=l>1?1:l,r=.5*(1-Math.cos(Math.PI*a)),o=e.startX+(e.x-e.startX)*r,n=e.startY+(e.y-e.startY)*r,e.method.call(e.scrollable,o,n),o===e.x&&n===e.y||t.requestAnimationFrame(d.bind(t,e))}function w(r,o,i){var a,c,u,h,f=s();r===e.body?(a=t,c=t.scrollX||t.pageXOffset,u=t.scrollY||t.pageYOffset,h=n.scroll):(a=r,c=r.scrollLeft,u=r.scrollTop,h=l),d({scrollable:a,method:h,startTime:f,startX:c,startY:u,x:o,y:i})}}}}()}},e={};function r(o){var i=e[o];if(void 0!==i)return i.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,r),n.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var o in e)r.o(e,o)&&!r.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(196),e=r.n(t);r(532);try{e().polyfill()}catch(t){console.log(t)}let o;function i(t,e){var r=document.createRange(),o=window.getSelection();r.setStart(t,e),r.collapse(!0),o.removeAllRanges(),o.addRange(r)}function n(t,e){return"*"===e&&console.error("store: option id '*' is reserved! will lead to unexpected behavior"),"__"+t+"_$"+e}function s(t,e){return e.startsWith("__"+t+"_$")}function a(t,e){return e.substring(4+t.length,e.length)}o=window,Array.from||(Array.from=function(){let t=Object.prototype.toString,e=function(e){return"function"==typeof e||"[object Function]"===t.call(e)},r=Math.pow(2,53)-1;return function(t){let o=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");let i,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!e(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}let s,a=function(t){let e=function(t){let e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),r)}(o.length),l=e(this)?Object(new this(a)):new Array(a),c=0;for(;c<a;)s=o[c],l[c]=n?void 0===i?n(s,c):n.call(i,s,c):s,c+=1;return l.length=a,l}}()),o.t_delay=t=>new Promise((e=>setTimeout(e,t))),o.t_in=(t,e)=>t.hasOwnProperty(e),o.t_arrayBufferToBase64=function(t){let e="";return[].slice.call(new Uint8Array(t)).forEach((t=>e+=String.fromCharCode(t))),o.btoa(e)},o.t_getImage=function(t,e=!1){return new Promise(((r,o)=>{try{if(t.startsWith("chrome://"))r();else{let i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let t=i.getResponseHeader("Content-Type").trim();if(t.startsWith("image/")){let e="data:"+t+";charset=utf-8;base64,",o=t_arrayBufferToBase64(i.response);r(e+o)}else o('Image Request Failed: Content-Type is not an image! (Content-Type: "'+t+'")')}else o(this.status)},i.responseType="arraybuffer",i.open("GET",t,!0),e&&i.setRequestHeader("Cache-Control","no-store"),i.send()}}catch(t){o(t.message)}}))},o.t_ctrlCmdKey=function(){return navigator.platform.indexOf("Mac")>=0||"iPhone"===navigator.platform?"Meta":"Control"},o.t_getElementsBetween=function(t,e,r=t=>!0){if(!t.parentElement.isSameNode(e.parentElement))return;if(t.isSameNode(e))return[];let o=[],i=t=>t.nextElementSibling;t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING&&(i=t=>t.previousElementSibling);let n=i(t);for(;n&&!n.isSameNode(e);)r(n)&&o.push(n),n=i(n);return o},o.t_getInView=function(t,e,r){let o=e.getBoundingClientRect(),i=t.getBoundingClientRect();(o.y>i.y||o.y>i.y+i.height||i.y>=o.y+o.height||i.y+i.height>=o.y+o.height)&&t.scrollIntoView(r)},o.t_getCaretPosition=function(t){var e,r=0,o=t.ownerDocument||t.document,i=o.defaultView||o.parentWindow;if(void 0!==i.getSelection){if((e=i.getSelection()).rangeCount>0){var n=i.getSelection().getRangeAt(0),s=n.cloneRange();s.selectNodeContents(t),s.setEnd(n.endContainer,n.endOffset),r=s.toString().length}}else if((e=o.selection)&&"Control"!=e.type){var a=e.createRange(),l=o.body.createTextRange();l.moveToElementText(t),l.setEndPoint("EndToEnd",a),r=l.text.length}return r},o.t_setCaretPosition=function(t,e){let r=0,o=e;for(let n of t.childNodes)if(n.nodeType===Node.TEXT_NODE){if(r+=n.nodeValue.length,e<=r)return void i(n,o);o-=n.nodeValue.length}else if(n.nodeType===Node.ELEMENT_NODE){let t=n.innerText;if(r+=t.length,e<=r)return void t_setCaretPosition(n,o);o-=t.length}},o.t_stripHtml=function(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""},o.t_byteLen=t=>new Blob([t]).size,o.t_chunkSubstr=function(t,e){const r=Math.ceil(t.length/e),o=new Array(r);for(let i=0,n=0;i<r;++i,n+=e)o[i]=t.substr(n,e);return o},o.t_chunkBytes=function(t,e){let r=Math.ceil(t_byteLen(t)/e),o=new Array(r),i=0;o[i]="";for(const r of t){let t=o[i]+r;t_byteLen(t)>e?(i++,i>=o.length&&o.push(""),o[i]=r):o[i]=t}return o},o.t_browserDetection=function(){return browser.runtime.getURL("/").startsWith("moz")?"moz":"chromium"},o.t_getKeyboardFocusableElements=(t=document)=>[...t.querySelectorAll('a[href], button, input, textarea, select, details,[tabindex]:not([tabindex="-1"])')].filter((t=>!t.hasAttribute("disabled")&&!t.getAttribute("aria-hidden"))),o.t_resetAnimation=function(t){t.style.animation="none",t.offsetHeight,t.style.animation=null},o.t_tryParseJSONObject=function(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1},o.t_sanitizeXMLTags=function(t){return t.replace(/<\/?([a-zA-Z0-9]+)>/g,(t=>t.replace("<","&lt;").replace(">","&gt;")))},o.t_errorToString=t=>`${t.toString()}\n${t.stack||"No stack trace available."}`;const l=t=>n(t,"___DELONSTART");class c extends Error{}class u{constructor(t,e="conf",r=!1){this.type=t,this.name=e,this.tmp=r,this.__fulfillers={},this.__modifierPromises={}}async modify(t,e,r=!0){let o=this.__modifierPromises[t];return this.__modifierPromises[t]=new Promise((async(i,s)=>{try{o&&await o;let s=r?await this.getOne(t):void 0,a=e(s);a instanceof Promise&&(a=await a),void 0!==a&&await this.__set(n(this.name,t),a),i()}catch(e){console.error(`storage modification for property "${t}" failed with the following error:`),console.error(e),i()}})),this.__modifierPromises[t]}async modifyAll(t,e,...r){let o=r.map((t=>this.__modifierPromises[t])),i=new Promise((async(i,n)=>{try{for(let t of o)void 0!==t&&await t;let n=e?await this.get(...r):void 0,s=t(n);s instanceof Promise&&(s=await s),void 0!==s&&await this.__setAll(s),i()}catch(t){console.error(`storage modification for properties "${r}" failed with the following error:`),console.error(t),i()}}));for(let t of r)this.__modifierPromises[t]=i;return i}special(t){return n(this.name,t)}isSpecial(t){return s(this.name,t)}normal(t){return a(this.name,t)}__delOnStart(){return this.modify(l(this.name),(async()=>{let t=await this.__getOne(l(this.name));if(t)return console.log("[store] delOnStart exists: "),console.log(t),this.modifyAll((()=>(console.log("[store] deleting"),this.__unset(...t))),!1,...t).then((()=>this.__set(l(this.name),[])));this.__set(l(this.name),[])}),!1)}__chunkNumber(t,e,r="_part"){return parseInt(e.substring(t.length+r.length))}async storeLarge(t,e,r=8092){const o=t_chunkBytes(e,r),i=await this.getKeys();let n=[];for(let e of i)e.startsWith(t)&&this.__chunkNumber(t,e)>=o.length&&n.push(e);let s={};for(let[e,r]of o.entries())s[t+"_part"+e]=r;await this.unset(...n);try{await this.setAll(s,!0)}catch(t){throw await this.unset(...Object.keys(s)),new c("storeLarge failed! error: "+t)}}async retrieveLarge(t){const e=await this.getKeys();let r=[],o=0;for(let i of e)if(i.startsWith(t)){r.push(i);let e=this.__chunkNumber(t,i);e>o&&(o=e)}let i=await this.get(...r),n="";for(let e=0;e<=o;e++)n+=i[t+"_part"+e];return n}async hasOne(t){return t=n(this.name,t),(await browser.storage[this.type].get(t)).hasOwnProperty(t)}async has(...t){let e={};for(let r of t)e[r]=await this.hasOne(r);return e}unset(...t){return this.modifyAll((async()=>{let e=await this.__getOne(l(this.name));for(let r of t){let t=e.indexOf(r);-1!==t&&e.splice(t,1)}await this.__set(l(this.name),e),await this.__unset(...t)}),!1,l(this.name),...t)}async __unset(...t){return browser.storage[this.type].remove(t.map((t=>n(this.name,t))))}set(t,e){return this.modifyAll((async()=>{let r=await this.__getOne(l(this.name));r=r||[],r.includes(t)||r.push(t),await this.__set(l(this.name),r),await this.__set(n(this.name,t),e)}),!1,l(this.name),t)}async __set(t,e){let r={};return r[t]=e,browser.storage[this.type].set(r)}async setAll(t,e=!1){for(let r in t)t.hasOwnProperty(r)&&(!e&&await this.hasOne(r)||await this.set(r,t[r]))}async __setAll(t,e=!1){for(let r in t)t.hasOwnProperty(r)&&(!e&&await this.hasOne(r)||await this.__set(n(this.name,r),t[r]))}async getOne(t){return this.__getOne(n(this.name,t))}async __getOne(t){return(await browser.storage[this.type].get(t))[t]}async getKeys(){return this.__getOne(l(this.name))}async get(...t){let e={};for(let r of t)e[r]=await this.getOne(r);return e}__manual_fulfill(t,e,r){return Promise.resolve(r(e,t))}async __fulfill(t,e){return this.__manual_fulfill(t,await this.getOne(t),e)}async fulfillOnce(t,e,r=void 0){return void 0!==r&&(await this.hasOne(t)||await this.set(t,r)),this.__fulfill(t,e)}addFulfiller(t,e){this.__fulfillers.hasOwnProperty(t)||(this.__fulfillers[t]=[]),this.__fulfillers[t].push(e)}removeFulfiller(t,e){if(this.__fulfillers.hasOwnProperty(t)){let r=this.__fulfillers[t].indexOf(e);-1!==r&&this.__fulfillers[t].splice(r,1)}}async fulfill(t,e,r=void 0){return void 0!==r&&(await this.hasOne(t)||await this.set(t,r)),this.addFulfiller(t,e),this.fulfillOnce(t,e,void 0)}async __onChange(t){console.log(Object.keys(t));for(let e in t)if(t.hasOwnProperty(e)&&s(this.name,e)){let r=a(this.name,e);this.__fulfillers.hasOwnProperty(r)&&this.__fulfillers[r].forEach((o=>this.__manual_fulfill(r,t[e].newValue,o))),this.__fulfillers.hasOwnProperty("*")&&this.__fulfillers["*"].forEach((o=>this.__manual_fulfill(r,t[e].newValue,o)))}}}const h=new u("local"),f=new u("sync"),d=new u("local","temp",!0),w=new u("sync","temp",!0);browser.storage.onChanged.addListener((async(t,e)=>{switch(e){case"local":await h.__onChange(t),await d.__onChange(t);break;case"sync":await f.__onChange(t),await w.__onChange(t)}}));class p{constructor(t,e){this.storage_space=t,this.name=e,this.__cache=void 0}async initialize(t=void 0){return await this.storage_space.hasOne(this.name)||await this.storage_space.set(this.name,t),await this.get(),this}async set(t){await this.storage_space.set(this.name,t)}async get(){return this.__cache=await this.storage_space.getOne(this.name),this.__cache}cache(){return this.__cache}}class _{constructor(...t){this.ids=t}activate(){return browser.tabs.update(this.ids[0],{active:!0})}pin(t){return Promise.all(this.ids.map((e=>browser.tabs.update(e,{pinned:t}))))}mute(t){return Promise.all(this.ids.map((e=>browser.tabs.update(e,{muted:t}))))}openerTabId(t){return Promise.all(this.ids.map((e=>browser.tabs.update(e,{openerTabId:t}))))}reload(t=!1){return Promise.all(this.ids.map((e=>browser.tabs.reload(e,{bypassCache:t}))))}discard(){return browser.tabs.discard(this.ids)}remove(){return browser.tabs.remove(this.ids)}captureTab(t,e){return browser.tabs.captureTab?new Promise(((r,o)=>{browser.tabs.captureTab(this.ids[0],e).then((e=>{t.aborted||r(e)})),t.onabort=o})):Promise.resolve(void 0)}moveTo(t,e){return _.move(this.ids,t,e)}static move(t,e,r){return browser.tabs.move(t,{windowId:e,index:r})}}class y{constructor(...t){this.ids=t}activate(){return browser.windows.update(this.ids[0],{focused:!0})}remove(){return Promise.all(this.ids.map((t=>browser.windows.remove(t))))}titlePreface(t){return Promise.all(this.ids.map((e=>browser.windows.update(e,{titlePreface:t}))))}}let m=[760,465];const b="popup",g="standalone",v="tab",O="sidebar";function P(t){switch(t){case void 0:case b:return g;case g:return v;case v:return O;case O:return b}}function T(t,e=!1){switch(t){case void 0:case b:return browser.browserAction&&browser.browserAction.openPopup?browser.browserAction.openPopup():browser.action.openPopup();case g:case v:let r=browser.runtime.getURL("popup/tab.html");return browser.tabs.query({url:[`${r}*`,`${r}?*`]}).then((async o=>{if(!(o.length>0)||e){let e=e=>{let o={url:r};return t===g?(o.type="popup",o.width=e[0],o.height=e[1],browser.windows.create(o)):t===v?(o.active=!0,browser.tabs.create(o)):void 0};return h.fulfillOnce("option:popup-size",(t=>e(t)),m)}await new _(o[0].id).activate(),await new y(o[0].windowId).activate()}));case O:return browser.sidebarAction&&browser.sidebarAction.toggle?browser.sidebarAction.toggle():Promise.resolve()}}let E,x,A,S,C,j,L,N;async function I(){E=await new p(h,"cmd-last-used__current-tab-id").initialize(),x=await new p(h,"cmd-last-used__last-tab-id").initialize(),A=await new p(h,"cmd-last-used__current-window-id").initialize(),S=await new p(h,"cmd-last-used__last-window-id").initialize(),C=await new p(h,"cmd-last-used__drop-current-tab-id").initialize(!1),j=await new p(h,"cmd-last-used__drop-current-window-id").initialize(!1),L=await new p(h,"focus__search").initialize(),N=await new p(h,"focus__justOpened").initialize(!1)}I(),browser.runtime.onMessage.addListener((t=>{if("justOpened"===t._)return(async()=>{await I();let t={_:"justOpened",justOpened:await N.get()};return N.cache()&&await N.set(!1),t})()})),browser.runtime.onMessage.addListener((t=>{if("initialFocus"===t._)return(async()=>{await I();let t={_:"initialFocus",search:await L.get()};return void 0!==L.cache()&&await L.set(void 0),t})()})),browser.tabs.onActivated.addListener((async t=>{await I(),await C.get()?await x.set(await E.get()):await C.set(!0),await E.set(t.tabId)})),browser.tabs.onRemoved.addListener((async(t,e)=>{await I(),await x.get()===t&&await x.set(void 0),await E.get()===t&&(await E.set(void 0),await C.set(!1))})),browser.windows.onFocusChanged.addListener((async t=>{await I(),t!==browser.windows.WINDOW_ID_NONE&&(await j.get()?await S.set(await A.get()):await j.set(!0),await A.set(t),await browser.tabs.query({active:!0,windowId:t}).then((async t=>{t[0].id!==await E.get()&&(await C.get()?await x.set(E.cache()):await C.set(!0),await E.set(t[0].id))})))})),browser.windows.onRemoved.addListener((async t=>{await I(),await S.get()===t&&await S.set(void 0),await A.get()===t&&(await A.set(void 0),await j.set(!1))})),browser.commands.onCommand.addListener((t=>{switch(E||(E=new p(h,"cmd-last-used__current-tab-id")),x||(x=new p(h,"cmd-last-used__last-tab-id")),A||(A=new p(h,"cmd-last-used__current-window-id")),S||(S=new p(h,"cmd-last-used__last-window-id")),C||(C=new p(h,"cmd-last-used__drop-current-tab-id")),j||(j=new p(h,"cmd-last-used__drop-current-window-id")),L||(L=new p(h,"focus__search")),N||(N=new p(h,"focus__justOpened")),t){case"open-tabby-focus-current":L.set(!1),N.set(!0),T(R);break;case"open-tabby-focus-search":L.set(!0),N.set(!0),T(R);break;case"open-tabby-switch-view":L.set(!1),N.set(!0),function(){browser.runtime.sendMessage({_:"batonPass"}),browser.sidebarAction&&browser.sidebarAction.close&&browser.sidebarAction.close();let t=browser.runtime.getURL("popup/tab.html");browser.tabs.query({url:[`${t}*`,`${t}?*`]}).then((t=>{t.length>0&&new _(t[0].id).remove()}))}(),T(P(R),!0),h.modify("memory:layout",(t=>P(t)),!0)}})),browser.commands.onCommand.addListener((async t=>{switch(await I(),t){case"last-used-tab":if(void 0!==await x.get()){await new _(x.cache()).activate();let t=await browser.windows.getLastFocused({populate:!1}),e=await browser.tabs.get(x.cache());t.id!==e.windowId&&(await new y(e.windowId).activate(),await x.set(await E.get()))}break;case"last-used-window":void 0!==await S.get()&&await new y(S.cache()).activate()}}));let R=b;h.fulfill("memory:layout",(t=>{R=t}))})()})();