"use strict";(()=>{let e,t=browser,n=t.runtime,o=()=>{parent.focus(),window.closed||window.close(),e=null},a=t=>{let n=t=>{d=!0,e?e.postMessage({H:92,r:t}):s(t),setTimeout(o,0)},{t:a,s:i,d:r}=t,s=t.r,c=()=>{switch(a){case 1:case 9:let e=(a===9?new Promise((e,t)=>{let n=document.createElement("img");n.onload=()=>{let o=document.createElement("canvas"),a=o.width=n.naturalWidth,i=o.height=n.naturalHeight,r=o.getContext("2d");if(r)try{r.drawImage(n,0,0,a,i),o.toBlob(n=>n?e(n):t("Can not export from canvas"))}catch(e){t("Can not export tainted canvas")}else t("Can not create canvas")},n.onerror=()=>{t(0)},n.src=i.u}).catch(e=>r||(e!==0?window.fetch(i.u):Promise.reject("Can not load image"))):r?Promise.resolve(r):window.fetch(i.u)).then(e=>(i.u="",e instanceof Response?e.blob():e)).then(e=>new Promise(t=>{let n=new FileReader;n.onload=()=>{d=n.result,t()},n.readAsDataURL(e)}));return a!==9&&(i.u=""),e}},w=()=>{let e;try{e=c()}catch(e){}e?e.then(()=>{n(d)},e=>{console.log("Vimium C: can not run task=%o:",a,e),n(!1)}):n(!1)},d=!0;document.hasFocus()?w():(window.onfocus=w,window.focus())},i=!1;{let e=t.extension.getBackgroundPage,n=e&&e();if(n&&n.onPagesReq){let e=n.onPagesReq({i:-3,q:[]});return void(e&&a(e))}}try{e=n.connect({name:"2176"}),e.onDisconnect.addListener(o)}catch(e){return void o()}e.onMessage.addListener(e=>{let t=e;t.N!==49||i?o():(i=!0,a(t))})})();