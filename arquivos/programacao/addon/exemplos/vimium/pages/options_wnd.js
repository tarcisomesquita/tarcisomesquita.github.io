import{CurCVer_ as e,CurFFVer_ as t,OnFirefox as n,OnChrome as o,OnEdge as i,$ as l,$$ as a,post_ as r,disconnect_ as s,isVApiReady_ as c,simulateClick_ as u,PageOs_ as d,toggleDark_ as p,browser_ as m,selfTabId_ as f,enableNextTick_ as h,nextTick_ as w,IsEdg_ as b,import2_ as v,BrowserName_ as k,pageTrans_ as A,isRepeated_ as V,prevent_ as g,pageLangs_ as y}from"./async_bg.js";import{bgSettings_ as _,showI18n_ as x,setupBorderWidth_ as T,Option_ as S,debounce_ as C,oTrans_ as M,delayBinding_ as $,didBindEvent_ as H,getSettingsCache_ as I}from"./options_base.js";import{saveBtn_ as j,exportBtn_ as O,savedStatus_ as E,onKeyMappingsError_ as L}from"./options_defs.js";import{manifest_ as P}from"./options_permissions.js";export let delayed_task;export const clear_delayed_task=()=>{delayed_task=null};h(8),w(x),T&&w(T),w(e=>{e.textContent=P.version_name||P.version,parseInt(P.version)>=2!=(P.manifest_version===3)&&(e.parentElement.nextElementSibling.textContent="-mv"+P.manifest_version)},l("#version")),$(j,"click",e=>{if(e!==!1)return void S.at().then(e=>{e&&j.onclick(!1)});let t=S.U;S.U=[],j.blur(),j.disabled=!0,j.firstChild.data=M("115_3"),O.disabled=!1,E(!1),window.onbeforeunload=null,window.addEventListener("beforeunload",z,!0),t.length!==0&&setTimeout(e=>{r(4,e.map(e=>_.B[e]))},100,t)},"on");let z=()=>{r(30)},D=e=>{g(e),VApi?VApi.h(1,0,M("haveToOpenManually")):alert(M("haveToOpenManually"))},N=function(){var e;S.V=!1;for(let e in S.X)S.X[e].j();S.X.exclusionRules.z.length>0&&w(e=>{e.style.visibility=""},l("#exclusionToolbar"));let n=(e=I().vomnibarOptions)===null||e===void 0?void 0:e.styles;n&&/ inputmode=(no|false|0) /.test(` ${n instanceof Array?n.join(" "):n} `)&&w(e=>{for(let t of e)t.removeAttribute("inputmode")},a("[inputmode]")),document.addEventListener("keyup",B),$("[data-check]","input",function e(){for(let t of a("[data-check]"))t.removeEventListener("input",e);v("./options_checker.js")}),$("[data-auto-resize]","click",e=>{let t=l("#"+e.target.dataset.autoResize),n=t.scrollHeight,o=t.scrollWidth,i=o-t.clientWidth;if(n<=t.clientHeight&&i<=0)return;let a=Math.max(Math.min(innerWidth,1024)-120,550);t.style.maxWidth=o>a?a+"px":"",t.style.height=t.style.width="",i=o-t.clientWidth;let r=t.offsetHeight-t.clientHeight;r=i>0?Math.max(26,r):r+18,n+=r,i>0&&(t.style.width=t.offsetWidth+i+4+"px"),t.style.height=n+"px"}),$("[data-delay]","click",function(e){let t=this.dataset.delay,n=null;t==="event"&&(n=e||null),t!=="continue"&&e&&g(e),delayed_task=["#"+this.id,n],document.readyState!=="complete"?window.addEventListener("load",function e(t){t.target===document&&(window.removeEventListener("load",e),v("./options_ext.js"))}):v("./options_ext.js")},"on");let i=a("[data-permission]");i.length>0&&(e=>{function n(){let e=this.querySelector("[data-permission]");if(this.onclick=null,!e)return;let t=e.dataset.permission;e.placeholder=M("lackPermission",[t?`: "${t}"`:""])}let o=P.permissions||[];for(let i=e.length;0<=--i;){let l,a=e[i],r=a.dataset.permission;if(r[0]==="C"){if(r.includes("nonC"))continue;let e=r.split(",",2)[1]||",";if(e[0]==="."?window[e.slice(1)]!=null:e[0]==="F"?t>=parseInt(e.slice(1)):e[0]==="("&&matchMedia(e).matches)continue;if(e[0]==="."){w(e=>{e.style.display="none"},a.parentElement);continue}l=e===","?["beforeChromium",[r.slice(1).split(",",1)[0]]]:["lackPermission",[e]]}else{if(r==="action"&&(r="browser_action"),r in P||o.includes(r))continue;l=["lackPermission",[r?":\n* "+r:""]]}w(e=>{e.disabled=!0;let t=M("invalidOption",[M(l[0],l[1])]);e instanceof HTMLInputElement&&e.type==="checkbox"?(e.nextElementSibling.tabIndex=-1,(e=e.parentElement).title=t,e.querySelector("span").style.textDecoration="line-through"):(e.value="",e.title=t,$(e.parentElement,"click",n,"on"),e instanceof HTMLSpanElement&&(e.style.textDecoration="line-through"))},a)}})(i),$("[data-vim-url]","mousedown",()=>{document.onmouseover=null,document.removeEventListener("vimiumData",s);for(let e of a("[data-vim-url]"))e.onmousedown=null,r(10,[e.dataset.vimUrl,-1]).then(([t])=>{e.removeAttribute("data-vim-url"),e.href=t,e.target="_blank",e.rel="noopener noreferrer"})},"on");let s=()=>{H("mousedown"),l("[data-vim-url]").onmousedown()};document.onmouseover=s,document.addEventListener("vimiumData",s);let c=["#openExtensionsPage","#browserSettingsSearch"].map(l);w(([e,t,n,o])=>{e.textContent=e.href="about:addons";let i="https://addons.mozilla.org/firefox/addon/",l="manageShortcut",a=`${l}_2`;e.before(M(l)),e.after(M(a)),t.href=i+"shortcut-forwarding-tool/?src=external-vc-options",n.href=i+"newtab-adapter/?src=external-vc-options",o.textContent=o.href="about:preferences#search"},[c[0],l("#shortcutHelper"),l("#newTabAdapter"),c[1]]),w(e=>{for(let t of e)$(t,"click",D)},c),w(e=>{let t=e.children,n=t[1],o=M("NewTabAdapter");t[0].textContent="moz",n.textContent=o,n.href="https://addons.mozilla.org/firefox/addon/newtab-adapter/?src=external-vc-options_omni",n.title=o+" - "+M("addons")},l("#chromeExtVomnibar"));let u=e=>{g(e);let t=e.currentTarget.dataset.for.split(":").slice(-1)[0],n=a(t),i=(n.find(e=>e.checked)||n[0]).nextElementSibling;K(i,o,e=>{VApi&&VApi.x(e.parentElement.parentElement)})};for(let e of a(".ref-text")){let t=e.dataset.for,n=t.slice(t.indexOf(":")+1),o=t.split(":")[0],i=S.X[o.replace("#","")],l=i.C,r=e.parentElement,s=()=>{w(([e,t,n])=>{let o=n.find(e=>e.checked)||n[0];if(e.textContent=M(o.checked?"145_2":"144"),t){let e=o.nextElementSibling,n=e.getAttribute("data-i2");t.textContent=n?A(n):e.textContent}},[r.querySelector(".status-of-related"),r.querySelector(".name-of-related"),n!==t?a(n):[i.P]])};i.C=()=>(s(),l.call(i)),$(e,"click",u,"on"),$(i.P,"change",s,!0)}},F=()=>{N(),N=F=null,d||w(e=>{e.textContent="Cmd"},l("#Ctrl"));for(let e in S.X)S.X[e].C();w(()=>{document.documentElement.classList.remove("loading")}),c.then(s),location.hash&&w(window.onhashchange),h(0,8),S.X.keyMappings.C=()=>r(7).then(L);let e=matchMedia("(prefers-color-scheme: dark)"),t=()=>{setTimeout(o,34)},n=S.X.autoDarkMode,o=()=>{let t=n.R(),o=t===2?!!e&&e.matches:t===1;if(VApi&&VApi.z){let e=VApi.y().r;if(e){let t=(e.firstElementChild&&e.firstElementChild.localName==="span"?e.firstElementChild:e).children;for(let e of t)if(e.localName!=="style"&&(e.classList.toggle("D",o),e=e.firstElementChild||e,e.localName==="iframe")){let t=e.classList.contains("Find"),n=e.contentDocument,i=n.querySelector("style#dark");if(i&&i.sheet&&(i.sheet.disabled=!o),n.body.classList.toggle(t?"D":"has-dark",o),t){let e=VApi.y().f;e&&e.parentElement.classList.toggle("D",o)}}}r(3,{key:"d",val:o}).then(e=>{VApi.z.d=e})}p(o?t===2?2:1:0)};n.C=t,w(()=>{n.z===2&&c.then(t),e.onchange=t}),setTimeout(()=>{let e,t="isHC_f",n=matchMedia("(forced-colors)").matches,o=n?null:document.createElement("div");o&&(o.style.display="none",o.style.color="#543",document.body.append(o)),r(27,t).then(i=>{e=i[t],(o||e!=null)&&requestIdleCallback(()=>{let t=o&&(getComputedStyle(o).color||"").replace(/ /g,"").toLowerCase(),i=!n&&!!t&&t!=="rgb(85,68,51)";o&&o.remove(),i!==(e==="1")&&r(9,{hc:i})},{timeout:1e3})})},34),w(()=>{setTimeout(()=>{let e=document.createElement("script");e.src="loader.js",e.async=!0,document.head.append(e),document.documentElement.classList.add("smooth")},120)})},B=e=>{let t=e.target,n=e.keyCode;if(n===13)t instanceof HTMLAnchorElement?t.hasAttribute("href")||(setTimeout(e=>{u(e),e.blur()},0,t),g(e)):(e.ctrlKey||e.metaKey)&&(g(e),t.blur&&t.blur(),E()&&(H("click"),j.onclick()));else{if(n!==32)return;if(t instanceof HTMLSpanElement&&t.parentElement instanceof HTMLLabelElement){g(e);let n=t.parentElement.control;n.disabled||u(n)}}};$(S.X.userDefinedCss.P,"input",C(()=>{let e=S.X.userDefinedCss,t=e.P.classList.contains("debugging");if(e.L&&!t||!VApi||!VApi.z)return;let n=e.R(),o=n===e.z,i=r(8,[n,f]),l=VApi.y().r;i.then(t=>{e.P.classList.toggle("debugging",!o),VApi.t({k:l||o?0:1,t:M("livePreview")||"Live preview CSS\u2026",H:t.ui,f:t.find});let n=l&&l.querySelector("iframe.Omnibar"),i=n&&n.contentDocument;if(i){let e=i.querySelector("style.debugged")||i.querySelector("style#custom");e||(e=i.createElement("style"),e.id="custom"),e.parentNode||i.head.append(e),e.classList.add("debugged"),e.textContent=(o?"\n":"\n.inactive { opacity: 1; }\n")+(t.omni&&t.omni+"\n"||"")}})},1200,null,0));export const noBlobSupport_cr_mv2_=()=>!1;$("#importButton","click",()=>{let e=l("#importOptions");e.onchange?e.onchange(null):u(l("#settingsFile"))},"on"),w(e=>{let n=_.S,o=k,i=t;if(!o){let e=navigator.userAgentData,n=(e&&e.brands||[]).filter(e=>parseInt(e.version)===t&&!` ${e.brand} `.includes(" Not "))[0],l="Firefox";o=n?n.brand:e?l||"Chromium":l||"Chrome",n&&(i=parseInt(n.version))}e.textContent=o+" "+i+M("comma")+M("NS")+(M(n)||n[0].toUpperCase()+n.slice(1))},l("#browserName")),document.addEventListener("keydown",e=>{if(!d&&e.metaKey)return void B(e);if(e.keyCode!==32){if(!VApi||!VApi.z||"input textarea".includes(document.activeElement.localName))return;let t=VApi.r[3]({c:" ",e,i:e.keyCode,v:""},11);if(t==="a-f12"){let e=l("#importOptions"),t=e.selectedIndex,n=()=>{e.onchange&&e.onchange(null),e.selectedIndex=t};l("#recommendedSettings").selected=!0,e.onchange!=null?n():setTimeout(n,100)&&e.click()}else t==="?"&&l("#showCommands").click();return}let t=e.target;t.localName==="span"&&t.parentElement.localName==="label"&&e.preventDefault()});export const onHash_=e=>{let t;if((e=e.slice(e[1]==="!"?2:1))&&/^[a-z][\w-]*$/i.test(e))if(t=l(`[data-hash="${e}"]`))H("click"),t.onclick&&t.onclick(null,"hash");else if(t=l(`[id="${e.replace(/-/g,"")}" i]`)){if(t.dataset.model!=null){if(t.localName==="input"&&t.type==="checkbox"){let e=t.parentElement,n=e.parentElement;t=n.localName==="td"?n:e}t.classList.add("highlight")}let e=e=>{if(e&&e.target!==window)return;window.onload&&(window.onload=null,scrollTo({behavior:"instant",top:0,left:0})),K(t);let n=t.localName;n!=="button"&&n!=="a"||u(t)};if(document.readyState==="complete")return e();window.scrollTo(0,0),window.onload=e}};window.onhashchange=()=>{onHash_(location.hash)};let K=(e,t,n)=>{let o=-1;e.scrollIntoView({block:t?"nearest":"center",behavior:"smooth"});let i=setInterval(()=>{let t=scrollY;t===o&&(clearInterval(i),n&&n(e),e.focus()),o=t},72)};_.E().then(F),r(7).then(e=>{w(L,e)}),r(12).then(e=>{e!=="?"&&w(([e,t])=>{e.textContent=t},[l("#questionShortcut"),e])}),$(document,"click",function e(){let t=VApi,n=t&&t.y();n&&n.r&&(document.removeEventListener("click",e,!0),n.r.addEventListener("click",e=>{let t,n=e.target;VApi&&n.classList.contains("HelpCommandName")&&(t=n.textContent.slice(1,-1),VApi.p({H:18,s:t}))},!0))},!0),$("#testKeyInputBox","focus",function e(t){let n,o,i=t.currentTarget,a=l("#testKeyInput"),r=(e,t)=>{let n=e!==void 0?a.textContent=e:a.textContent;if(e&&t!==0&&document.activeElement===a){let t=getSelection(),n=a.firstChild;t.setBaseAndExtent(n,e.length,n,e.length)}return n},s=a.previousElementSibling.textContent,c=0,u=!1,d=0;a.onkeydown=e=>{if(u&&(u=!1,a.classList.remove("outline")),e.keyCode!==229&&e.key!=="Process"){if(VApi&&!V(e)){let t={c:" ",e,i:e.keyCode,v:""},i=VApi.r[3](t,11),l=i==="esc"||i==="c-[",c=VApi.z.l&4?VApi.r[3](t,10):i;if(!i&&(t.i===16||e.key==="Shift"))return;let u=i.length>1?`<${i}>`:i||"(empty)",p=c===i?"":c.length>1?`<${c}>`:c||"(empty)";if(n=e,o=VApi.z.l,r(p?`${u} / ${p}`:u),VApi.f(7,Object.setPrototypeOf({i:!0,r:0,k:"v-esc:test",p:!0,h:s+` (${++d})`},null),1,0),i==="enter"||i==="tab"||i==="s-tab"||l||i==="f12")return void((i==="enter"||l)&&a.blur())}c=e.keyCode,g(e)}else r("")},a.onkeyup=e=>{e.keyCode===c&&g(e)},a.onfocus=()=>{VApi&&(a.classList.add("outline"),u=!0,d=0,VApi.f(7,Object.setPrototypeOf({i:!0,r:0,k:"v-esc:test",p:!0,h:s},null),1,0))},a.onblur=()=>{VApi&&(VApi.f(16,Object.setPrototypeOf({type:"keydown",key:"Esc",esc:!0},null),1,0),VApi.h(1,0,s+(d?` (${d})`:""))),d=0},a.addEventListener("compositionend",()=>{r("")}),a.onpaste=g,a.onclick=()=>{a.focus()};let p=l("#testKeyInInput");p.onchange=()=>{p.checked?a.contentEditable="true":a.removeAttribute("contenteditable"),a.focus()},i.removeEventListener("focus",e,!0),i.addEventListener("blur",e=>{let t=u?e.relatedTarget:null;(t?!i.contains(t):u)&&(u=!1,a.classList.remove("outline"))},!0),S.Y=()=>{n&&o!==VApi.z.l&&a.onkeydown(n)}},!0);