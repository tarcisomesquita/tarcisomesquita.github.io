let e=2;export const OnChrome=!1;export const OnFirefox=!0;export const OnEdge=!1;export const OnSafari=!1;let t,o,n=navigator.userAgentData,r=n&&n.brands;export const IsEdg_=!1;export const CurCVer_=998;export let CurFFVer_=r&&(t=r.find(e=>e.brand.includes("Firefox")))&&parseInt(t.version)>115?parseInt(t.version):parseInt(navigator.userAgent.split("Firefox/")[1]||"0")||999;export let BrowserName_;export let PageOs_=9;export const setupPageOs_=e=>{PageOs_=e};export const browser_=browser;window.chrome&&(window.chrome=null);export const isVApiReady_=new Promise(e=>{let t;o=new Promise(e=>{t=e}),addEventListener("VimiumC",()=>{k(t),nextTick_(e)},{once:!0,capture:!0})});let l=0,s={},i=new Map,a=null,c=null,p=null,u=Object.create(null),_=1,d=null;export let selfTabId_=-1;let x=e=>{if(d&&(c=0),e===!1)return void alert("Can not send info to the background: not trusted");let t=u[e.i];delete u[e.i];for(let o=e.a,n=0;n<t.length;n++)t[n](o[n]);VApi&&d&&Object.keys(u).length===0&&w()},g=e=>{e=structuredClone(e),x(e)},b=()=>{d=0,console.log("[WARNING] the temp port is disconnected unexpectedly; need to replay messages using VApi"),c&&o.then(()=>{let e=c,t=e?Object.keys(u):[];c=0;for(let o of t){let t=u[o],n=e[o];n&&t&&(a=n,p=t,m(n.length))}})},m=e=>{if(!a)return;let t=VApi,o=a.length;if(o>(e||1))return void k(m.bind(null,o));if(t&&d&&Object.keys(u).length===0&&w(),e===0)return void(a=p=null);let n=_++;u[n]=p,p=null;let r=browser_.extension.getBackgroundPage,l=r&&r();l&&l.onPagesReq?l.onPagesReq({i:n,q:a}).then(g):t?t.r[0](40,{i:n,q:a},x):(d==null&&(d=browser_.runtime.connect({name:"128"}),d.onMessage.addListener(x),d.onDisconnect.addListener(b)),d&&d.postMessage({H:40,i:n,q:a}),c!==0&&((c||(c=Object.create(null)))[n]=a)),a=null};export const post_=(e,t)=>new Promise(o=>{a||f(),a.push({n:e,q:t!==void 0?t:null}),p.push(o)});let f=()=>{a||(a=[],p=[],k(m))};export{f as disconnect_};let w=()=>{let e=d;d=null,e&&(e.onDisconnect.removeListener(b),e.onMessage.removeListener(x),e.disconnect())},k=queueMicrotask;export const $=e=>document.querySelector(e);export const $$=(e,t)=>{let o=(t||document).querySelectorAll(e);return[].slice.call(o)};export const toggleDark_=e=>{let t=document.head.querySelector("meta[name=color-scheme]"),o=e===2?"light dark":e===1?"dark":"light";if(t.content!==o){t.content=o;let n=document.documentElement.classList;n.toggle("no-dark",!e),n.toggle("dark",e===1)}};export const toggleReduceMotion_=e=>{document.documentElement.classList.toggle("less-motion",e)};export let enableNextTick_;let V=null;export const nextTick_=(()=>{let e=()=>{let n=t.length;for(let e=0;e<n;e++)(0,t[e])();t.length>n?(t.splice(0,n),k(e)):(t.length=0,o=0)},t=[],o=0;return enableNextTick_=(t,o)=>{l=(l|t)&~(o||0),l===7&&k(e)},(o,n)=>{if(t.length<=0&&l===7&&k(e),n===9)t.unshift(o);else{let e=n?o.bind(null,n):o;t.push(e)}}})();export const import2_=e=>import(e);export const pageTrans_=(e,t)=>{let o=i.get(e);return t!=null&&o&&(o=o.replace(/\$\d/g,e=>t[+e[1]-1])),o};let h=(e,t)=>e&&e.split(" ").reduce((e,o)=>e||(o.includes("=")?o.startsWith(t)?o.slice(t.length+1):e:o),"");export const bTrans_=browser_.i18n.getMessage;let O=location.pathname.replace("/pages/","").split(".")[0],T=bTrans_("lang1");export const pageLangs_=h(bTrans_("i18n"),O)||T||"en";let y=!1,A=e=>{let t=i;for(let o of e.reverse()){if(!o)continue;let e=y?o.default:JSON.parse(o.slice(14));for(let o in e)t.set(o,e[o])}enableNextTick_(2)};export const onDicts_=y?A:0;export const curPagePath_=y?O:0;if(Promise.all(pageLangs_.split(",").map(e=>{let t=`/i18n/${e}/${O==="show"?"action":O}.js`;return fetch(t).then(e=>e.text()).catch(e=>(console.log("Can not load the language file:",t,":",e),null))})).then(A),browser_.storage.local.get("autoDarkMode",e=>{let t=e&&e.autoDarkMode;return(t===!1||t===1||t===0)&&toggleDark_(t?1:0),browser_.runtime.lastError}),browser_.runtime.getBrowserInfo().then(e=>{CurFFVer_=parseInt(e&&e.version)||CurFFVer_,BrowserName_=e&&e.name||"",enableNextTick_(4)}),T&&O!=="action"){let e=bTrans_("v"+O);e&&(document.title="Vimium C "+e)}O==="options"&&isVApiReady_.then(()=>{VApi.r[0](40,{i:1,q:[{n:26,q:null}]},e=>{e!==!1&&(selfTabId_=e.a[0])})});export const simulateClick_=(e,t)=>{let o;return t=t||{ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},o=new MouseEvent("click",{bubbles:!0,cancelable:!0,composed:!0,view:window,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:0,buttons:1,relatedTarget:null}),e.dispatchEvent(o)};export const hasShift_=e=>{let t=e.key,o=t.length===1?t.toUpperCase():"";return o&&t.toLowerCase()!==o&&e.getModifierState("CapsLock")?t!==o:e.shiftKey};export const isRepeated_=e=>e.repeat||PageOs_===1&&!!(VApi&&VApi.a()[e.keyCode]&&e.keyCode);export const prevent_=e=>{e.preventDefault();let t=e.type==="keydown"?e.keyCode:0;!t||!PageOs_&&e.metaKey||VApi&&(VApi.a()[t]=1)};export const escapeAllForRe_=e=>e.replace(/[$()*+.?\[\\\]\^{|}]/g,"\\$&");typeof VApi=="undefined"&&(globalThis.VApi=void 0);