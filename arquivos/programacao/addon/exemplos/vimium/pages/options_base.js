import{CurCVer_ as t,OnChrome as e,$ as i,$$ as s,nextTick_ as n,pageLangs_ as l,pageTrans_ as o,post_ as r,enableNextTick_ as h,onDicts_ as a,curPagePath_ as u,setupPageOs_ as _}from"./async_bg.js";let c={};export const showI18n_=()=>{if(l==="en")return;let t=l.split(",")[0],e=navigator.language||t,n=i("#keyMappings"),r=n&&oTrans_("keyMappingsP");if(r&&(n.placeholder=r),e&&(!t.startsWith("zh")||e!=="zh-CN"))for(n of s("input[type=text], textarea"))n.lang=e;for(n of s("[data-i]")){let t=n.dataset.i,e=t.endsWith("-t");r=o(e?t.slice(0,-2):t),r!=null&&(e?n.title=r:n.textContent=r)}document.documentElement.lang=t==="zh"?"zh-CN":t.replace("_","-")};window.__extends=function(t,e){let i=function(){this.constructor=t};i.prototype=e.prototype,t.prototype=new i};export const debounce_=(t,e,i,s)=>{let n,l=0,o=()=>{let r=Date.now()-n;r<e-4&&r>=0?l=setTimeout(o,e-r):(l=0,n!==s&&t.call(i))};return s=s?1:0,()=>{n=Date.now(),l?s&&(s=n-1):(l=setTimeout(o,e),s&&(s=n,t.call(i)))}};export const didBindEvent_=t=>{let e=typeof t!="string"?t.type:t;for(let t of c[e]||[])for(let i of typeof t.t=="string"?s(t.t):[t.t])t.s!=="on"?i.addEventListener(e,t.u,t.s):i["on"+e]=t.u;c[e]=null,removeEventListener(e,didBindEvent_,!0)};export const delayBinding_=(t,e,i,s)=>{let n=c[e];n||(addEventListener(e,didBindEvent_,!0),n=c[e]=[]),n.push({t,u:i,s:s||!1})};let p="__locking",d=null;export const setupSettingsCache_=t=>{d=t};export const getSettingsCache_=()=>d;export const bgSettings_={S:"",O:null,v(){d=null},E:()=>d?d instanceof Promise?d:Promise.resolve():(bgSettings_.O||r(0).then(t=>{bgSettings_.O=t[0],_(t[1]),bgSettings_.S=t[2],h(1)}),d=r(1).then(t=>{d=t})),$(t){if(d==null&&this.E(),d instanceof Promise)return d.then(()=>this.$(t));let e=d[t];return e!==void 0?e:this.O[t]},N(t,e){let i=bgSettings_.O[t],s=e;return i!==void 0&&(typeof i=="object"?JSON.stringify(e)===JSON.stringify(i):e===i)&&(s=null),r(2,{key:t,val:s}).then(i=>{d[t]=i!==null?i:e})},B:{__proto__:null,filterLinkHints:"f",hideHud:"h",ignoreReadonly:"y",keyLayout:"l",mouseReachable:"e",keyboard:"k",keyupTime:"u",linkHintCharacters:"c",linkHintNumbers:"n",passEsc:"p",regexFindMode:"r",smoothScroll:"s",scrollStepSize:"t",waitForEnter:"w"},T:{__proto__:null,c:1,n:1,l:1,d:1,p:1,y:1}};bgSettings_.E();export class Option_{C(){}constructor(t,e){let i=t.id;this.K=i,this.P=t,this.z=this.J=null,this.L=!1,this.M=!1,i in bgSettings_.B?e=this.F.bind(this,e):i!=="autoDarkMode"&&i!=="autoReduceMotion"||(e=this.D.bind(this,e)),this.J=debounce_(e,330,this,1),this.e(t)}j(){this.L=!0;let t=this.H();if(t instanceof Promise)return t.then(Option_.prototype.j.bind(this));this.z=t,Option_.V||n(()=>{this.c(this.z)})}H(){return bgSettings_.$(this.K)}A(t){let e=this.q;return e?e.Z(t):t}I(){return!0}async x(){let t=this.R(),e=typeof t=="object",i=e?JSON.stringify(this.z):this.z,s=e?JSON.stringify(t):t;if(s===i)return;i=s;let l=this.A(t);return t=l instanceof Promise?await l:l,t=await this.f(t),this.z=t,this.L=!0,(i!==(e?JSON.stringify(t):t)||this.W(t))&&n(()=>{this.c(this.z,!0)}),this.C()}G(){let t=this.H(),e=!this.Q(this.z,t);return e&&this.Q(t,this.R())?(this.z=t,this.L=!0,!1):e}async f(t){return await bgSettings_.N(this.K,t),this.K in bgSettings_.B&&Option_.U.push(this.K),this.H()}W(t){return!1}Q(t,e){return t===e}}Option_.X={},Option_.U=null,Option_.Y=null,Option_.V=!1;export class ExclusionRulesOption_ extends Option_{e(t){this.tt=t.querySelector("#exclusionTemplate").content.querySelector(".exclusionRule"),this.l=t.querySelector("tbody"),this.h=[],delayBinding_(this.l,"input",ExclusionRulesOption_.et),delayBinding_(this.l,"input",this.J),delayBinding_(this.l,"click",t=>{this.it(t)}),this.st=!1,delayBinding_("#exclusionAddButton","click",()=>this.n(""),"on")}nt(t){}static et(t){let e=t.target,i=e.vnode;i&&(i.y|=e.classList.contains("pattern")?1:2)}n(t,e){let i=e!==!1,s=i&&this.l.childElementCount,l=this.lt(this.l,{passKeys:"",pattern:t});t&&(l.k={passKeys:"",pattern:""});let o=this.h[this.h.length-1];i&&(s>=4&&this.P.scrollBy(0,40),n(()=>o.b.focus())),t&&this.J(),this.nt(1)}c(t){if(!this.st){this.st=!0;for(let t of l!=="en"?s("[title]",this.tt):[]){let e=o(t.title);e&&(t.title=e)}}if(this.l.innerText="",this.h=[],t.length<=0);else if(t.length===1)this.lt(this.l,t[0]);else{let e=document.createDocumentFragment();t.forEach(this.lt.bind(this,e)),this.l.append(e)}return this.nt(t.length)}i(t){return!0}lt(t,e){let{passKeys:i,pattern:s}=e,n={a:e,r:null,y:0,d:!1,b:null,m:null,k:e};if(n.d=this.i(n),!n.d)return this.h.push(n),n;let l=document.importNode(this.tt,!0),o=l.querySelector(".pattern"),r=l.querySelector(".passKeys"),h=i.trimRight();return o.value=s,s&&(o.placeholder=""),r.value=h,h&&(r.placeholder=""),n.b=o,n.m=r,o.vnode=n,r.vnode=n,this.w(n,s,i),this.h.push(n),t.append(l),n}static ot(t){t.a.pattern&&t.m.placeholder&&(t.m.placeholder="")}it(t){let e=t.target;if(e.localName==="path"&&(e=e.parentElement),e.localName==="svg"&&(e=e.parentElement),e.classList.contains("remove")&&(e=e.parentNode.parentNode,e.classList.contains("exclusionRule"))){let i=e.querySelector(".pattern").vnode;return e.remove(),t.preventDefault(),i.y&4&&i.k.pattern?Object.assign(i,{a:{passKeys:"",pattern:""},r:!1,y:12,b:null,m:null}):this.h.splice(this.h.indexOf(i),1),this.J(),this.nt(0)}}static rt(t,e,i){let s=i.toLowerCase();return e||i.length!==1?i!==s?`<${e}s-${s}>`:t:i}static ht(t){return t&&t.replace(/<(?!<)((?:[acm]-){0,3})(\S|[A-Za-z]\w+)>/g,ExclusionRulesOption_.rt)}R(t){let e=[];t=t===!0;for(let i of this.h){if(t&&!i.d)continue;let s=i.y;if(!(s&&s&3)){i.a.pattern&&e.push(i.a);continue}let n=s&1?i.b.value.trim():i.a.pattern,l=!1,o=s&2?i.m.value:i.a.passKeys;if(n){if(s&1){let t=/^(about|vimium):/i.test(n),e=n.startsWith(":")?0:n.indexOf("://");if(e)if(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(n))if(n.startsWith("`"));else if(n.startsWith("^")){let t=".*$".includes(n.slice(-2))?n.endsWith(".*$")?3:n.endsWith(".*")?2:0:0;n=t!==0&&n[n.length-t]!=="\\"?n.slice(0,-t):n}else{l=!n.includes("/",e+3),n.endsWith("*")&&(n=n.slice(0,/^[^\\]\.\*$/.test(n.slice(-3))?-2:-1),l=!1),n=n.startsWith(".*")&&!/[(\\[]/.test(n)?"*."+n.slice(2):n;let i=n;i=(e<0&&!t?"^https?://":"^")+(i.startsWith("*")&&i[1]!=="."?"[^/]"+i:(i=i.replace(/\./g,"\\."),i.startsWith("*")?i.replace("*\\.","(?:[^./]+\\.)*?"):i.replace("://*\\.","://(?:[^./]+\\.)*?"))),n=f(i,"")?i:n.includes("*")||n.includes("/")||t?":"+n:":https://"+(n.startsWith(".")?n.slice(1):n)}else l=!n.includes("/",e+3)&&!t,n=n.replace(/\\(.)/g,"$1"),n=(e<0&&!t?":http://":":")+n;l&&(n+="/")}if(s&2&&o){o=ExclusionRulesOption_.ht(o);let t=o.match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z]\w+|[^\sA-Z])>|\S/g);if(t){let e=t[0]==="^"&&t.length>1;e&&t.shift(),t.sort(),e?t.unshift("^"):t[0]==="^"&&(t.shift(),t.push("^"))}o=t?t.join(" ")+" ":"",o=o.replace(/<escape>/gi,"<esc>")}this.w(i,n,o),e.push(i.a)}else this.w(i,"",o)}return e}w(t,e,i){let s=!t.a.passKeys&&!!i;t.a={passKeys:i,pattern:e},t.r=null,t.y&=-4,s&&ExclusionRulesOption_.ot(t)}C(){for(let t=0,e=this.h;t<e.length;t++){let i=e[t];if(!i.d)continue;if(i.y&8){e.splice(t--,1);continue}i.k=i.a,i.b.value!==i.a.pattern&&(i.b.value=i.a.pattern);let s=i.a.passKeys.trim();i.m.value!==s&&(i.m.value=s)}}Q(t,e){return JSON.stringify(t)===JSON.stringify(e)}}let f=(t,e)=>{try{return new RegExp(t,e)}catch(t){return null}};export let setupBorderWidth_=devicePixelRatio<2?()=>{let t=document.createElement("style"),e=devicePixelRatio,i=e>=1,s=1/e;s+=999e-8,s=(""+s).slice(0,7).replace(/\.?0+$/,""),t.textContent=i?`html { --vc-tiny: ${s}px; }`:`* { border-width: ${s}px !important; }`,document.head.append(t)}:null;export const oTrans_=(t,e)=>o(t,e)||"";