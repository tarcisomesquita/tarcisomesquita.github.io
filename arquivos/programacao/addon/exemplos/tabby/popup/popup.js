(()=>{var e,t,i,s,o={992:(e,t,i)=>{var s,o=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(e,t){if(!s[e]){s[e]={};for(var i=0;i<e.length;i++)s[e][e.charAt(i)]=i}return s[e][t]}var n={compressToBase64:function(e){if(null==e)return"";var i=n._compress(e,6,(function(e){return t.charAt(e)}));switch(i.length%4){default:case 0:return i;case 1:return i+"===";case 2:return i+"==";case 3:return i+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:n._decompress(e.length,32,(function(i){return o(t,e.charAt(i))}))},compressToUTF16:function(t){return null==t?"":n._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=n.compress(e),i=new Uint8Array(2*t.length),s=0,o=t.length;s<o;s++){var r=t.charCodeAt(s);i[2*s]=r>>>8,i[2*s+1]=r%256}return i},decompressFromUint8Array:function(t){if(null==t)return n.decompress(t);for(var i=new Array(t.length/2),s=0,o=i.length;s<o;s++)i[s]=256*t[2*s]+t[2*s+1];var r=[];return i.forEach((function(t){r.push(e(t))})),n.decompress(r.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,(function(e){return i.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),n._decompress(e.length,32,(function(t){return o(i,e.charAt(t))})))},compress:function(t){return n._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,i){if(null==e)return"";var s,o,n,r={},a={},l="",d="",c="",h=2,u=3,p=2,m=[],f=0,w=0;for(n=0;n<e.length;n+=1)if(l=e.charAt(n),Object.prototype.hasOwnProperty.call(r,l)||(r[l]=u++,a[l]=!0),d=c+l,Object.prototype.hasOwnProperty.call(r,d))c=d;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(s=0;s<p;s++)f<<=1,w==t-1?(w=0,m.push(i(f)),f=0):w++;for(o=c.charCodeAt(0),s=0;s<8;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1}else{for(o=1,s=0;s<p;s++)f=f<<1|o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o=0;for(o=c.charCodeAt(0),s=0;s<16;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[c]}else for(o=r[c],s=0;s<p;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1;0==--h&&(h=Math.pow(2,p),p++),r[d]=u++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(c.charCodeAt(0)<256){for(s=0;s<p;s++)f<<=1,w==t-1?(w=0,m.push(i(f)),f=0):w++;for(o=c.charCodeAt(0),s=0;s<8;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1}else{for(o=1,s=0;s<p;s++)f=f<<1|o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o=0;for(o=c.charCodeAt(0),s=0;s<16;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1}0==--h&&(h=Math.pow(2,p),p++),delete a[c]}else for(o=r[c],s=0;s<p;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(o=2,s=0;s<p;s++)f=f<<1|1&o,w==t-1?(w=0,m.push(i(f)),f=0):w++,o>>=1;for(;;){if(f<<=1,w==t-1){m.push(i(f));break}w++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,i,s){var o,n,r,a,l,d,c,h=[],u=4,p=4,m=3,f="",w=[],_={val:s(0),position:i,index:1};for(o=0;o<3;o+=1)h[o]=o;for(r=0,l=Math.pow(2,2),d=1;d!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=i,_.val=s(_.index++)),r|=(a>0?1:0)*d,d<<=1;switch(r){case 0:for(r=0,l=Math.pow(2,8),d=1;d!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=i,_.val=s(_.index++)),r|=(a>0?1:0)*d,d<<=1;c=e(r);break;case 1:for(r=0,l=Math.pow(2,16),d=1;d!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=i,_.val=s(_.index++)),r|=(a>0?1:0)*d,d<<=1;c=e(r);break;case 2:return""}for(h[3]=c,n=c,w.push(c);;){if(_.index>t)return"";for(r=0,l=Math.pow(2,m),d=1;d!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=i,_.val=s(_.index++)),r|=(a>0?1:0)*d,d<<=1;switch(c=r){case 0:for(r=0,l=Math.pow(2,8),d=1;d!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=i,_.val=s(_.index++)),r|=(a>0?1:0)*d,d<<=1;h[p++]=e(r),c=p-1,u--;break;case 1:for(r=0,l=Math.pow(2,16),d=1;d!=l;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=i,_.val=s(_.index++)),r|=(a>0?1:0)*d,d<<=1;h[p++]=e(r),c=p-1,u--;break;case 2:return w.join("")}if(0==u&&(u=Math.pow(2,m),m++),h[c])f=h[c];else{if(c!==p)return null;f=n+n.charAt(0)}w.push(f),h[p++]=n+f.charAt(0),n=f,0==--u&&(u=Math.pow(2,m),m++)}}};return n}();void 0===(s=function(){return o}.call(t,i,t,e))||(e.exports=s)},532:(e,t,i)=>{"use strict";var s;(s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)||"undefined"!=typeof navigator&&"ReactNative"===navigator.product?i.g:self).Proxy||(s.Proxy=i(780)(),s.Proxy.revocable=s.Proxy.revocable)},780:e=>{e.exports=function(){let e,t=null;function i(e){return!!e&&("object"==typeof e||"function"==typeof e)}function s(e){if(null!==e&&!i(e))throw new TypeError("Object prototype may only be an Object or null: "+e)}const o=Object,n=Boolean(o.create)||!({__proto__:null}instanceof o),r=o.create||(n?function(e){return s(e),{__proto__:e}}:function(e){if(s(e),null===e)throw new SyntaxError("Native Object.create is required to create objects with null prototype");var t=function(){};return t.prototype=e,new t}),a=function(){return null},l=o.getPrototypeOf||([].__proto__===Array.prototype?function(e){const t=e.__proto__;return i(t)?t:null}:a);return e=function(d,c){if(void 0===(this&&this instanceof e?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!i(d)||!i(c))throw new TypeError("Cannot create proxy with a non-object as target or handler");let h=function(){};t=function(){d=null,h=function(e){throw new TypeError(`Cannot perform '${e}' on a proxy that has been revoked`)}},setTimeout((function(){t=null}),0);const u=c;c={get:null,set:null,apply:null,construct:null};for(let e in u){if(!(e in c))throw new TypeError(`Proxy polyfill does not support trap '${e}'`);c[e]=u[e]}"function"==typeof u&&(c.apply=u.apply.bind(u));const p=l(d);let m,f=!1,w=!1;"function"==typeof d?(m=function(){const e=this&&this.constructor===m,t=Array.prototype.slice.call(arguments);return h(e?"construct":"apply"),e&&c.construct?c.construct.call(this,d,t):!e&&c.apply?c.apply(d,this,t):e?(t.unshift(d),new(d.bind.apply(d,t))):d.apply(this,t)},f=!0):d instanceof Array?(m=[],w=!0):m=n||null!==p?r(p):{};const _=c.get?function(e){return h("get"),c.get(this,e,m)}:function(e){return h("get"),this[e]},g=c.set?function(e,t){h("set"),c.set(this,e,t,m)}:function(e,t){h("set"),this[e]=t},b=o.getOwnPropertyNames(d),v={};b.forEach((function(e){if((f||w)&&e in m)return;const t=o.getOwnPropertyDescriptor(d,e),i={enumerable:Boolean(t.enumerable),get:_.bind(d,e),set:g.bind(d,e)};o.defineProperty(m,e,i),v[e]=!0}));let y=!0;if(f||w){const e=o.setPrototypeOf||([].__proto__===Array.prototype?function(e,t){return s(t),e.__proto__=t,e}:a);p&&e(m,p)||(y=!1)}if(c.get||!y)for(let e in d)v[e]||o.defineProperty(m,e,{get:_.bind(d,e)});return o.seal(d),o.seal(m),m},e.revocable=function(i,s){return{proxy:new e(i,s),revoke:t}},e}},196:e=>{!function(){"use strict";e.exports={polyfill:function(){var e=window,t=document;if(!("scrollBehavior"in t.documentElement.style)||!0===e.__forceSmoothScrollPolyfill__){var i,s=e.HTMLElement||e.Element,o=468,n={scroll:e.scroll||e.scrollTo,scrollBy:e.scrollBy,elementScroll:s.prototype.scroll||l,scrollIntoView:s.prototype.scrollIntoView},r=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now,a=(i=e.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(i)?1:0);e.scroll=e.scrollTo=function(){void 0!==arguments[0]&&(!0!==d(arguments[0])?m.call(e,t.body,void 0!==arguments[0].left?~~arguments[0].left:e.scrollX||e.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:e.scrollY||e.pageYOffset):n.scroll.call(e,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:e.scrollX||e.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:e.scrollY||e.pageYOffset))},e.scrollBy=function(){void 0!==arguments[0]&&(d(arguments[0])?n.scrollBy.call(e,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):m.call(e,t.body,~~arguments[0].left+(e.scrollX||e.pageXOffset),~~arguments[0].top+(e.scrollY||e.pageYOffset)))},s.prototype.scroll=s.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==d(arguments[0])){var e=arguments[0].left,t=arguments[0].top;m.call(this,this,void 0===e?this.scrollLeft:~~e,void 0===t?this.scrollTop:~~t)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},s.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==d(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},s.prototype.scrollIntoView=function(){if(!0!==d(arguments[0])){var i=function(e){for(;e!==t.body&&!1===u(e);)e=e.parentNode||e.host;return e}(this),s=i.getBoundingClientRect(),o=this.getBoundingClientRect();i!==t.body?(m.call(this,i,i.scrollLeft+o.left-s.left,i.scrollTop+o.top-s.top),"fixed"!==e.getComputedStyle(i).position&&e.scrollBy({left:s.left,top:s.top,behavior:"smooth"})):e.scrollBy({left:o.left,top:o.top,behavior:"smooth"})}else n.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function l(e,t){this.scrollLeft=e,this.scrollTop=t}function d(e){if(null===e||"object"!=typeof e||void 0===e.behavior||"auto"===e.behavior||"instant"===e.behavior)return!0;if("object"==typeof e&&"smooth"===e.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+e.behavior+" is not a valid value for enumeration ScrollBehavior.")}function c(e,t){return"Y"===t?e.clientHeight+a<e.scrollHeight:"X"===t?e.clientWidth+a<e.scrollWidth:void 0}function h(t,i){var s=e.getComputedStyle(t,null)["overflow"+i];return"auto"===s||"scroll"===s}function u(e){var t=c(e,"Y")&&h(e,"Y"),i=c(e,"X")&&h(e,"X");return t||i}function p(t){var i,s,n,a,l=(r()-t.startTime)/o;a=l=l>1?1:l,i=.5*(1-Math.cos(Math.PI*a)),s=t.startX+(t.x-t.startX)*i,n=t.startY+(t.y-t.startY)*i,t.method.call(t.scrollable,s,n),s===t.x&&n===t.y||e.requestAnimationFrame(p.bind(e,t))}function m(i,s,o){var a,d,c,h,u=r();i===t.body?(a=e,d=e.scrollX||e.pageXOffset,c=e.scrollY||e.pageYOffset,h=n.scroll):(a=i,d=i.scrollLeft,c=i.scrollTop,h=l),p({scrollable:a,method:h,startTime:u,startX:d,startY:c,x:s,y:o})}}}}()}},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return o[e].call(i.exports,i,i.exports,r),i.exports}r.m=o,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var o=Object.create(null);r.r(o);var n={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>n[e]=()=>i[e]));return n.default=()=>i,r.d(o,n),o},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>e+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},s="tabby:",r.l=(e,t,o,n)=>{if(i[e])i[e].push(t);else{var a,l;if(void 0!==o)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var h=d[c];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==s+o){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",s+o),a.src=e),i[e]=[t];var u=(t,s)=>{a.onerror=a.onload=null,clearTimeout(p);var o=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(s))),t)return t(s)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=i[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e+"../"})(),(()=>{var e={160:0};r.f.j=(t,i)=>{var s=r.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var o=new Promise(((i,o)=>s=e[t]=[i,o]));i.push(s[2]=o);var n=r.p+r.u(t),a=new Error;r.l(n,(i=>{if(r.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var o=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+n+")",a.name="ChunkLoadError",a.type=o,a.request=n,s[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var s,o,[n,a,l]=i,d=0;if(n.some((t=>0!==e[t]))){for(s in a)r.o(a,s)&&(r.m[s]=a[s]);l&&l(r)}for(t&&t(i);d<n.length;d++)o=n[d],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunktabby=self.webpackChunktabby||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=r(196),t=r.n(e);r(532);try{t().polyfill()}catch(e){console.log(e)}let i;function s(e,t){var i=document.createRange(),s=window.getSelection();i.setStart(e,t),i.collapse(!0),s.removeAllRanges(),s.addRange(i)}i=window,Array.from||(Array.from=function(){let e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},i=Math.pow(2,53)-1;return function(e){let s=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");let o,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!t(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}let r,a=function(e){let t=function(e){let t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),i)}(s.length),l=t(this)?Object(new this(a)):new Array(a),d=0;for(;d<a;)r=s[d],l[d]=n?void 0===o?n(r,d):n.call(o,r,d):r,d+=1;return l.length=a,l}}()),i.t_delay=e=>new Promise((t=>setTimeout(t,e))),i.t_in=(e,t)=>e.hasOwnProperty(t),i.t_arrayBufferToBase64=function(e){let t="";return[].slice.call(new Uint8Array(e)).forEach((e=>t+=String.fromCharCode(e))),i.btoa(t)},i.t_getImage=function(e,t=!1){return new Promise(((i,s)=>{try{if(e.startsWith("chrome://"))i();else{let o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let e=o.getResponseHeader("Content-Type").trim();if(e.startsWith("image/")){let t="data:"+e+";charset=utf-8;base64,",s=t_arrayBufferToBase64(o.response);i(t+s)}else s('Image Request Failed: Content-Type is not an image! (Content-Type: "'+e+'")')}else s(this.status)},o.responseType="arraybuffer",o.open("GET",e,!0),t&&o.setRequestHeader("Cache-Control","no-store"),o.send()}}catch(e){s(e.message)}}))},i.t_ctrlCmdKey=function(){return navigator.platform.indexOf("Mac")>=0||"iPhone"===navigator.platform?"Meta":"Control"},i.t_getElementsBetween=function(e,t,i=e=>!0){if(!e.parentElement.isSameNode(t.parentElement))return;if(e.isSameNode(t))return[];let s=[],o=e=>e.nextElementSibling;e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING&&(o=e=>e.previousElementSibling);let n=o(e);for(;n&&!n.isSameNode(t);)i(n)&&s.push(n),n=o(n);return s},i.t_getInView=function(e,t,i){let s=t.getBoundingClientRect(),o=e.getBoundingClientRect();(s.y>o.y||s.y>o.y+o.height||o.y>=s.y+s.height||o.y+o.height>=s.y+s.height)&&e.scrollIntoView(i)},i.t_getCaretPosition=function(e){var t,i=0,s=e.ownerDocument||e.document,o=s.defaultView||s.parentWindow;if(void 0!==o.getSelection){if((t=o.getSelection()).rangeCount>0){var n=o.getSelection().getRangeAt(0),r=n.cloneRange();r.selectNodeContents(e),r.setEnd(n.endContainer,n.endOffset),i=r.toString().length}}else if((t=s.selection)&&"Control"!=t.type){var a=t.createRange(),l=s.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",a),i=l.text.length}return i},i.t_setCaretPosition=function(e,t){let i=0,o=t;for(let n of e.childNodes)if(n.nodeType===Node.TEXT_NODE){if(i+=n.nodeValue.length,t<=i)return void s(n,o);o-=n.nodeValue.length}else if(n.nodeType===Node.ELEMENT_NODE){let e=n.innerText;if(i+=e.length,t<=i)return void t_setCaretPosition(n,o);o-=e.length}},i.t_stripHtml=function(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""},i.t_byteLen=e=>new Blob([e]).size,i.t_chunkSubstr=function(e,t){const i=Math.ceil(e.length/t),s=new Array(i);for(let o=0,n=0;o<i;++o,n+=t)s[o]=e.substr(n,t);return s},i.t_chunkBytes=function(e,t){let i=Math.ceil(t_byteLen(e)/t),s=new Array(i),o=0;s[o]="";for(const i of e){let e=s[o]+i;t_byteLen(e)>t?(o++,o>=s.length&&s.push(""),s[o]=i):s[o]=e}return s},i.t_browserDetection=function(){return browser.runtime.getURL("/").startsWith("moz")?"moz":"chromium"},i.t_getKeyboardFocusableElements=(e=document)=>[...e.querySelectorAll('a[href], button, input, textarea, select, details,[tabindex]:not([tabindex="-1"])')].filter((e=>!e.hasAttribute("disabled")&&!e.getAttribute("aria-hidden"))),i.t_resetAnimation=function(e){e.style.animation="none",e.offsetHeight,e.style.animation=null},i.t_tryParseJSONObject=function(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t)return t}catch(e){}return!1},i.t_sanitizeXMLTags=function(e){return e.replace(/<\/?([a-zA-Z0-9]+)>/g,(e=>e.replace("<","&lt;").replace(">","&gt;")))},i.t_errorToString=e=>`${e.toString()}\n${e.stack||"No stack trace available."}`;const o=["favIconUrl","isArticle","mutedInfo","pinned","title","url","attention","audible","hidden","status","discarded"].concat(["isInReaderMode","lastAccessed"],["active"],[],["windowId"],["cookieStoreId","incognito","openerTabId","id"]),n=["favIconUrl","isArticle","mutedInfo","pinned","title","url","hidden","discarded","isInReaderMode","lastAccessed","active","windowId","cookieStoreId","incognito","openerTabId"];class a{constructor(){for(let e of o)this[e]=void 0}proxy(e,t){void 0===this._proxies&&(this._proxies=[]);let i={};for(let e of o)i[e]=this[e];const s={set:(t,i,s)=>(e(i,s),t[i]=s,!0)};let n=Proxy.revocable(i,s);return this._proxies.push({proxy:n,revoked:t,handler:e}),n}_proxy_helper(e,t){if(this._proxies)for(let{proxy:i}of this._proxies)i.proxy[e]=t}clearProxies(){if(this._proxies){for(let{proxy:e,revoked:t}of this._proxies)t(),e.revoke();this._proxies=void 0}}mergeChanges(e){for(let t in e)t_in(e,t)&&-1!=o.indexOf(t)&&(this[t]=e[t],this._proxy_helper(t,e[t]))}onClosed(){this.clearProxies()}onMoved(e,t){if(this._proxies)for(let{handler:i}of this._proxies)i("#position",{newWindowId:e,newPosition:t})}serialize(e){let t={};for(let i of e)t[i]=this[i];return t}get mozContextualIdentity(){return browser.contextualIdentities&&!["firefox-default","firefox-private"].includes(this.cookieStoreId)?browser.contextualIdentities.get(this.cookieStoreId):Promise.resolve(!1)}get full(){return browser.tabs.get(this.id)}get index(){return this.full.then((e=>e.index))}static toTab(e,t,i){let s={active:e.active,pinned:e.pinned,url:e.url,windowId:t};return i&&(s.cookieStoreId=i),s.discarded=e.discarded,s.openInReaderMode=e.isInReaderMode,s.title=e.discarded?e.title:void 0,s.muted=e.mutedInfo.muted,browser.tabs.create(s)}static fromTab(e){let t=new a;for(let i of o)t[i]=e[i];return t}static fromSerialized(e){let t=new a;return t.mergeChanges(e),t}}function l(e,t){return"*"===t&&console.error("store: option id '*' is reserved! will lead to unexpected behavior"),"__"+e+"_$"+t}function d(e,t){return t.startsWith("__"+e+"_$")}function c(e,t){return t.substring(4+e.length,t.length)}const h=e=>l(e,"___DELONSTART");class u extends Error{}class p{constructor(e,t="conf",i=!1){this.type=e,this.name=t,this.tmp=i,this.__fulfillers={},this.__modifierPromises={}}async modify(e,t,i=!0){let s=this.__modifierPromises[e];return this.__modifierPromises[e]=new Promise((async(o,n)=>{try{s&&await s;let n=i?await this.getOne(e):void 0,r=t(n);r instanceof Promise&&(r=await r),void 0!==r&&await this.__set(l(this.name,e),r),o()}catch(t){console.error(`storage modification for property "${e}" failed with the following error:`),console.error(t),o()}})),this.__modifierPromises[e]}async modifyAll(e,t,...i){let s=i.map((e=>this.__modifierPromises[e])),o=new Promise((async(o,n)=>{try{for(let e of s)void 0!==e&&await e;let n=t?await this.get(...i):void 0,r=e(n);r instanceof Promise&&(r=await r),void 0!==r&&await this.__setAll(r),o()}catch(e){console.error(`storage modification for properties "${i}" failed with the following error:`),console.error(e),o()}}));for(let e of i)this.__modifierPromises[e]=o;return o}special(e){return l(this.name,e)}isSpecial(e){return d(this.name,e)}normal(e){return c(this.name,e)}__delOnStart(){return this.modify(h(this.name),(async()=>{let e=await this.__getOne(h(this.name));if(e)return console.log("[store] delOnStart exists: "),console.log(e),this.modifyAll((()=>(console.log("[store] deleting"),this.__unset(...e))),!1,...e).then((()=>this.__set(h(this.name),[])));this.__set(h(this.name),[])}),!1)}__chunkNumber(e,t,i="_part"){return parseInt(t.substring(e.length+i.length))}async storeLarge(e,t,i=8092){const s=t_chunkBytes(t,i),o=await this.getKeys();let n=[];for(let t of o)t.startsWith(e)&&this.__chunkNumber(e,t)>=s.length&&n.push(t);let r={};for(let[t,i]of s.entries())r[e+"_part"+t]=i;await this.unset(...n);try{await this.setAll(r,!0)}catch(e){throw await this.unset(...Object.keys(r)),new u("storeLarge failed! error: "+e)}}async retrieveLarge(e){const t=await this.getKeys();let i=[],s=0;for(let o of t)if(o.startsWith(e)){i.push(o);let t=this.__chunkNumber(e,o);t>s&&(s=t)}let o=await this.get(...i),n="";for(let t=0;t<=s;t++)n+=o[e+"_part"+t];return n}async hasOne(e){return e=l(this.name,e),(await browser.storage[this.type].get(e)).hasOwnProperty(e)}async has(...e){let t={};for(let i of e)t[i]=await this.hasOne(i);return t}unset(...e){return this.modifyAll((async()=>{let t=await this.__getOne(h(this.name));for(let i of e){let e=t.indexOf(i);-1!==e&&t.splice(e,1)}await this.__set(h(this.name),t),await this.__unset(...e)}),!1,h(this.name),...e)}async __unset(...e){return browser.storage[this.type].remove(e.map((e=>l(this.name,e))))}set(e,t){return this.modifyAll((async()=>{let i=await this.__getOne(h(this.name));i=i||[],i.includes(e)||i.push(e),await this.__set(h(this.name),i),await this.__set(l(this.name,e),t)}),!1,h(this.name),e)}async __set(e,t){let i={};return i[e]=t,browser.storage[this.type].set(i)}async setAll(e,t=!1){for(let i in e)e.hasOwnProperty(i)&&(!t&&await this.hasOne(i)||await this.set(i,e[i]))}async __setAll(e,t=!1){for(let i in e)e.hasOwnProperty(i)&&(!t&&await this.hasOne(i)||await this.__set(l(this.name,i),e[i]))}async getOne(e){return this.__getOne(l(this.name,e))}async __getOne(e){return(await browser.storage[this.type].get(e))[e]}async getKeys(){return this.__getOne(h(this.name))}async get(...e){let t={};for(let i of e)t[i]=await this.getOne(i);return t}__manual_fulfill(e,t,i){return Promise.resolve(i(t,e))}async __fulfill(e,t){return this.__manual_fulfill(e,await this.getOne(e),t)}async fulfillOnce(e,t,i=void 0){return void 0!==i&&(await this.hasOne(e)||await this.set(e,i)),this.__fulfill(e,t)}addFulfiller(e,t){this.__fulfillers.hasOwnProperty(e)||(this.__fulfillers[e]=[]),this.__fulfillers[e].push(t)}removeFulfiller(e,t){if(this.__fulfillers.hasOwnProperty(e)){let i=this.__fulfillers[e].indexOf(t);-1!==i&&this.__fulfillers[e].splice(i,1)}}async fulfill(e,t,i=void 0){return void 0!==i&&(await this.hasOne(e)||await this.set(e,i)),this.addFulfiller(e,t),this.fulfillOnce(e,t,void 0)}async __onChange(e){console.log(Object.keys(e));for(let t in e)if(e.hasOwnProperty(t)&&d(this.name,t)){let i=c(this.name,t);this.__fulfillers.hasOwnProperty(i)&&this.__fulfillers[i].forEach((s=>this.__manual_fulfill(i,e[t].newValue,s))),this.__fulfillers.hasOwnProperty("*")&&this.__fulfillers["*"].forEach((s=>this.__manual_fulfill(i,e[t].newValue,s)))}}}const m=new p("local"),f=new p("sync"),w=new p("local","temp",!0),_=new p("sync","temp",!0);browser.storage.onChanged.addListener((async(e,t)=>{switch(t){case"local":await m.__onChange(e),await w.__onChange(e);break;case"sync":await f.__onChange(e),await _.__onChange(e)}}));class g{constructor(){this._first=void 0,this._last=void 0,this._data=[],this._free=[],this._length=0}_allocate_space(){let e;return this._free.length>0?e=this._free.pop():(this._data.push(void 0,void 0),e=this._data.length-2),null!=this._first&&null!=this._last||(this._first=e,this._last=e),e}_recycle_space(e){this._data[e]=void 0,this._data[e+1]=void 0,this._free.push(e)}append(e){let t=this._allocate_space();this._data[t]=e,this._data[t+1]=void 0,this._last!==t&&(this._data[this._last+1]=t),this._last=t,this._length++}_indexInDataArray(e){return this._data.findIndex(((t,i)=>i%2==0&&e==t))}_pointerIndexInDataArray(e){return this._data.findIndex(((t,i)=>i%2==1&&e==t))}indexOf(e){let t=0,i=this._first;for(;;){if(null==i)return-1;if(e==this._data[i])return t;i=this._data[i+1],t++}}_translateListIndexToDataArrIndex(e){if(this._length<1)return-1;{let t=0,i=this._first;for(;;){if(null==i)return-1;if(t==e)return i;i=this._data[i+1],t++}}}_replaceMatchingNextPointerWith(e,t){let i=this._pointerIndexInDataArray(e);return this._data[i]=t,i}remove(e){let t=this._indexInDataArray(e);if(-1==t)return!1;if(t==this._first&&t==this._last)this._first=void 0,this._last=void 0;else if(t==this._first)this._first=this._data[t+1];else if(t==this._last){let e=this._replaceMatchingNextPointerWith(t,void 0);this._last=e-1}else this._replaceMatchingNextPointerWith(t,this._data[t+1]);return this._recycle_space(t),this._length--,!0}insert(e,t){let i=this._allocate_space();this._data[i]=e;let s=this._translateListIndexToDataArrIndex(t);-1==s?(this._last!==i&&(this._data[this._last+1]=i),this._last=i,s=void 0):-1==this._replaceMatchingNextPointerWith(s,i)&&(this._first=i),this._data[i+1]=s,this._length++}move(e,t){this.indexOf(e)!=t&&(this.remove(e),this.insert(e,t))}toString(){let e="[",t=this._first;for(;void 0!==t;)e+=this._data[t]+", ",t=this._data[t+1];return e}toArray(){let e=[],t=this._first;for(;void 0!==t;)e.push(this._data[t]),t=this._data[t+1];return e}static fromArray(e){let t=new g;for(let i of e)t.append(i);return t}get length(){return this._length}}class b{constructor(...e){this.ids=e}activate(){return browser.tabs.update(this.ids[0],{active:!0})}pin(e){return Promise.all(this.ids.map((t=>browser.tabs.update(t,{pinned:e}))))}mute(e){return Promise.all(this.ids.map((t=>browser.tabs.update(t,{muted:e}))))}openerTabId(e){return Promise.all(this.ids.map((t=>browser.tabs.update(t,{openerTabId:e}))))}reload(e=!1){return Promise.all(this.ids.map((t=>browser.tabs.reload(t,{bypassCache:e}))))}discard(){return browser.tabs.discard(this.ids)}remove(){return browser.tabs.remove(this.ids)}captureTab(e,t){return browser.tabs.captureTab?new Promise(((i,s)=>{browser.tabs.captureTab(this.ids[0],t).then((t=>{e.aborted||i(t)})),e.onabort=s})):Promise.resolve(void 0)}moveTo(e,t){return b.move(this.ids,e,t)}static move(e,t,i){return browser.tabs.move(e,{windowId:t,index:i})}}class v{constructor(...e){this.ids=e}activate(){return browser.windows.update(this.ids[0],{focused:!0})}remove(){return Promise.all(this.ids.map((e=>browser.windows.remove(e))))}titlePreface(e){return Promise.all(this.ids.map((t=>browser.windows.update(t,{titlePreface:e}))))}}new class{constructor(){this.state=!1}requiresSetup(){return!this.state}started(){this.state=!0}};class y{constructor(){this._worder=new g,this._order={},this._active={},this._focusedWindow=-1,this._naming={}}setFocusedWindow(e){this._focusedWindow=e}getFocusedWindow(){return this._focusedWindow}async reloadNamesFromTemporaryStore(){for(let e in this._naming)if(this._naming.hasOwnProperty(e)){let t=await w.getOne(`window${e}`);t&&(this._naming[e]=t)}}async setName(e,t){await browser.runtime.sendMessage({_:"__ping",id:"listenForUpdatesToWindowName"}),""===t.trim()?(t=void 0,w.unset(`window${e}`),new v(e).titlePreface("")):(w.set(`window${e}`,t),new v(e).titlePreface(`[${t}] `)),this._naming[e]=t}getName(e){return this._naming[e]}setActiveTab(e,t){this._active[e]=t}getActiveTab(e){return this._active[e]}hasWindow(e){return t_in(this._order,e)}registerWindow(e){this._order[e]=new g,this._active[e]=-1,this._naming[e]=void 0,this._worder.append(e)}unregisterWindow(e){delete this._order[e],delete this._active[e],delete this._naming[e],this._worder.remove(e)}appendTabToWindow(e,t,i=!0){this._order[e].insert(t.id,t.index),t.active&&i&&(this._active[e]=t.id)}removeTabFromWindow(e,t){this._order[e].remove(t)}insertTabIntoWindow(e,t,i){this._order[e].insert(t,i)}moveTabWithinWindow(e,t,i){this._order[e].move(t,i)}getWindowIds(){return this._worder.toArray()}getAllAs2DArray(){let e=this._worder.toArray(),t=[];for(let i of e)t.push(this._order[i].toArray());return t}toSerializable(){let e=this._worder.toArray(),t={};for(let e in this._order)this._order.hasOwnProperty(e)&&(t[e]=this._order[e].toArray());return{worder:e,order:t,active:this._active,focusedWindow:this._focusedWindow,naming:this._naming}}static fromSerializable(e){let t=new y;t._worder=g.fromArray(e.worder);for(let i in e.order)e.order.hasOwnProperty(i)&&(t._order[i]=g.fromArray(e.order[i]));return t._active=e.active,t._focusedWindow=e.focusedWindow,t._naming=e.naming,t}}function E(e,t,i){return browser.tabs.sendMessage(e,{target:t,data:i})}class k{constructor(){this._listeners=[],this._tabs={},this._rel=new y,this._tab_updated_hook=(e,t)=>{this._tabs[e].mergeChanges(t)},this._tab_activated_hook=e=>{console.log(e.windowId," => ",e.tabId),this._tabs[this._rel.getActiveTab(e.windowId)]&&this._tabs[this._rel.getActiveTab(e.windowId)].mergeChanges({active:!1}),this._rel.setActiveTab(e.windowId,e.tabId),this._tabs[e.tabId].mergeChanges({active:!0})},this._tab_moved_hook=(e,t)=>{this._rel.moveTabWithinWindow(t.windowId,e,t.toIndex),this._tabs[e].onMoved(t.windowId,t.toIndex)},this._tab_attached_hook=(e,t)=>{this._rel.removeTabFromWindow(this._tabs[e].windowId,e),this._rel.insertTabIntoWindow(t.newWindowId,e,t.newPosition),this._tabs[e].mergeChanges({windowId:t.newWindowId}),this._tabs[e].onMoved(t.newWindowId,t.newPosition)},this._tab_removed_hook=(e,t)=>{this._rel.removeTabFromWindow(t.windowId,e),this._tabs[e].onClosed(),setTimeout((()=>delete this._tabs[e]),1e3)},this._tab_created_hook=e=>{this._rel.hasWindow(e.windowId)||this._rel.registerWindow(e.windowId),this._rel.appendTabToWindow(e.windowId,e,!1),this._tabs[e.id]=a.fromTab(e);for(let t of this._listeners)t.onTabCreated&&t.onTabCreated(this._tabs[e.id])},this._window_removed_hook=e=>{for(let t of this._listeners)t.onWindowClosed&&t.onWindowClosed(e);this._rel.unregisterWindow(e)},this._window_created_hook=e=>{for(let t of this._listeners)t.onWindowCreated&&t.onWindowCreated(e)},this._window_focus_changed_hook=e=>{e=e===browser.windows.WINDOW_ID_NONE?-1:e,this._rel.setFocusedWindow(e);for(let t of this._listeners)t.onWindowFocusChanged&&t.onWindowFocusChanged(e)}}addListener(e){this._listeners.push(e)}hasListener(e){return-1!==this._listeners.indexOf(e)}removeListener(e){let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}getAllTabIdsAsStrings(){let e=[];for(let t in this._tabs)this._tabs.hasOwnProperty(t)&&e.push(t);return e}getTab(e){return this._tabs[e]}getTabActions(e){return new b(e)}getWindowActions(e){return new v(e)}enableBrowserHooks(){browser.tabs.onUpdated.addListener(this._tab_updated_hook),browser.tabs.onActivated.addListener(this._tab_activated_hook),browser.tabs.onMoved.addListener(this._tab_moved_hook),browser.tabs.onAttached.addListener(this._tab_attached_hook),browser.tabs.onRemoved.addListener(this._tab_removed_hook),browser.tabs.onCreated.addListener(this._tab_created_hook),browser.windows.onRemoved.addListener(this._window_removed_hook),browser.windows.onCreated.addListener(this._window_created_hook),browser.windows.onFocusChanged.addListener(this._window_focus_changed_hook)}getAllAs2DArray(){return this._rel.getAllAs2DArray().map((e=>e.map((e=>this._tabs[e]))))}get mozContextualIdentities(){return browser.contextualIdentities?browser.contextualIdentities.query({}):Promise.resolve(void 0)}static async read_from_current(){let e=new k,t=await browser.tabs.query({});for(let i of t)e._rel.hasWindow(i.windowId)||(e._rel.registerWindow(i.windowId),(await browser.windows.get(i.windowId,{populate:!1})).focused&&e._rel.setFocusedWindow(i.windowId)),e._rel.appendTabToWindow(i.windowId,i),e._tabs[i.id]=a.fromTab(i);return await e._rel.reloadNamesFromTemporaryStore(),e}async toSerializable(){let e={};for(let t in this._tabs)if(this._tabs.hasOwnProperty(t)){let i=this._tabs[t],s=i.serialize(n);try{let e=await E(i.id,"packd",{action:"favicon"});if(0===e.length)try{let t=new URL("/favicon.ico",i.url).href;await t_getImage(t,i.incognito),e.push({href:t,sizes:""})}catch(e){}if(0!==e.length){let t=new URL(e[e.length-1].href,i.url).href;s.favIconUrl=t}}catch(e){console.error(`could not contact tab ${t}, error: ${e}`)}e[t]=s}return{tabs:e,rel:this._rel.toSerializable()}}static fromSerializable(e){let t=new k;for(let i in e.tabs)e.tabs.hasOwnProperty(i)&&(t._tabs[i]=a.fromSerialized(e.tabs[i]));return t._rel=y.fromSerializable(e.rel),t}async openAll(e=void 0){let t,i=this.getAllAs2DArray();for(let s of i){let i=await browser.windows.create({focused:this._rel._focusedWindow===s[0].windowId,incognito:s[0].incognito});this._rel._focusedWindow===s[0].windowId&&(t=i);for(let t of s)try{let s=await a.toTab(t,i.id,e?e[t.cookieStoreId]:void 0);await new b(s.id).openerTabId(t.openerTabId),await new b(s.id).mute(t.mutedInfo.muted)}catch(e){console.error("could not recreate tab",t,"due to",e)}if(i.tabs.length>0)try{await new b(i.tabs[0].id).remove()}catch(e){console.error(`could not clear away the opened-by-default tab in window ${i.id}`,e)}let o=this._rel.getName(s[0].windowId);this._rel.setName(i.id,o||"")}t&&await new v(t.id).activate()}}class I{constructor(){this.tabId=void 0,this._lastCaptureTabId=void 0,this._hookPlaceholder()}setCurrent(e){document.getElementById("details-pane").setAttribute("data-tab-id",e),document.getElementById("details-placeholder").style.display="none",this.tabId=e}setTitle(e){document.getElementById("_title_txt").innerText=e}setURL(e){document.getElementById("_url_txt").innerText=e}_setImage(e){document.getElementById("_details_pane_image_holder").style.display="",document.getElementById("_details_pane_image_holder").src=e}_hideImage(){document.getElementById("_details_pane_image_holder").style.display="none"}_showPlaceholder(){document.getElementById("unloaded-tab-preview-placeholder").style.display="flex"}_hidePlaceholder(){document.getElementById("unloaded-tab-preview-placeholder").style.display="",document.getElementById("unloaded-tab-preview-placeholder-text").removeAttribute("data-loading")}_hookPlaceholder(){let e=document.getElementById("unloaded-tab-preview-placeholder-text");e.addEventListener("click",(()=>{e.setAttribute("data-loading",""),browser.tabs.reload(this.tabId)}))}async captureTab(e=!1){if(this.tabId&&(this._lastCaptureTabId!==this.tabId||e)){let e,t;try{e=await browser.runtime.sendMessage({_:"captureTab",tabId:this.tabId,quality:{format:"jpeg",quality:80,scale:window.devicePixelRatio/2}})}catch(e){t=await browser.tabs.get(this.tabId),t.discarded&&this._showPlaceholder()}e?(this._setImage(e),this._hidePlaceholder()):t&&t.discarded&&this._hideImage(),this._lastCaptureTabId=this.tabId}}}class L{constructor(e=!0){this.root=document.createElement("pre"),this.root.setAttribute("contenteditable","true"),this.root.addEventListener("paste",(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");if(this.singleLine)document.execCommand("insertText",!1,t);else{let e=t.split("\n");e.forEach(((t,i)=>{document.execCommand("insertText",!1,t),i<e.length-1&&document.execCommand("insertParagraph",!1)}))}})),this.singleLine=e,this._placeholderTemplate=document.createElement("span"),this._placeholderTemplate.classList.add("-tui-editable-div-placeholder"),this.root.classList.add("-tui-editable-div"),this.root.addEventListener("keypress",(e=>{if(e.stopPropagation(),"Enter"===e.key)return!this.singleLine&&e.shiftKey||e.preventDefault(),!1})),this.root.addEventListener("keydown",(e=>{e.stopPropagation()})),this.root.addEventListener("keyup",(e=>{if(e.stopPropagation(),this.editing&&"Enter"===e.key)if(this.singleLine||!e.shiftKey)this.onEnter(this.value,e);else{e.preventDefault();let t=window.getSelection(),i=t.getRangeAt(0),s=document.createElement("br");i.insertNode(s),i.setStartAfter(s),i.setEndAfter(s),t.removeAllRanges(),t.addRange(i)}})),this.root.addEventListener("blur",(e=>{this.onEnter(this.value,e)})),this.root.addEventListener("input",(e=>{if(this.onInput(this.value),""===this.value){let e=this.root.querySelectorAll("br");for(let t of e)this.root.removeChild(t)}this.autoPlaceholder()})),this.autoPlaceholder()}get value(){return this.root.innerText}set value(e){this.rememberCaretPosition(),this.root.textContent=e,this.recoverCaretPosition(),this.autoPlaceholder()}rememberCaretPosition(){this._caretPosition=t_getCaretPosition(this.root)}recoverCaretPosition(){void 0!==this._caretPosition&&(t_setCaretPosition(this.root,this._caretPosition),this._caretPosition=void 0)}clear(){this.root.innerText=""}autoPlaceholder(){""===this.value?this.addPlaceholder():this.removePlaceholder()}addPlaceholder(){this.root.appendChild(this._placeholderTemplate.cloneNode(!0)),L.focus(this.root)}removePlaceholder(){for(let e of this.root.querySelectorAll(".-tui-editable-div-placeholder"))this.root.removeChild(e)}get singleLine(){return this._singleLine}set singleLine(e){this._singleLine=e,e?(this.root.classList.add("-tui-editable-singleline-div"),this.root.classList.remove("-tui-editable-multiline-div")):(this.root.classList.remove("-tui-editable-singleline-div"),this.root.classList.add("-tui-editable-multiline-div"))}get editing(){return"none"!==this.root.style.pointerEvents}set editing(e){e?(this.root.style.pointerEvents="",L.focus(this.root),this.root.classList.add("-tui-editable-div-editing")):(this.root.style.pointerEvents="none",this.root.blur(),this.root.classList.remove("-tui-editable-div-editing"))}onEnter(e,t){}onInput(e){}static focus(e){let t=window.getSelection(),i=document.createRange();i.setStart(e,0);let s=e.querySelector(".-tui-editable-div-placeholder");s?i.setEndBefore(s):i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i),e.focus()}}class x{constructor(){this.root=document.createElement("input"),this.editing=!1,this.root.value="Editable Label",this.root.classList.add("-tui-editable-span"),this.root.addEventListener("keyup",(e=>{this.editing&&"Enter"===e.key&&this.onEnter(this.root.value)})),this.root.addEventListener("blur",(e=>{this.onEnter(this.root.value)})),this.root.addEventListener("input",(e=>{A(this.root)})),this.stopPropagation=e=>e.stopPropagation()}get editing(){return"none"!==this.root.style.pointerEvents}set editing(e){e?(this.root.style.pointerEvents="",this.root.focus(),this.root.select(),this.root.classList.add("-tui-editable-span-editing"),this.root.addEventListener("keydown",this.stopPropagation),this.root.addEventListener("keyup",this.stopPropagation)):(this.root.style.pointerEvents="none",this.root.blur(),this.root.classList.remove("-tui-editable-span-editing"),this.root.removeEventListener("keydown",this.stopPropagation),this.root.removeEventListener("keyup",this.stopPropagation))}get value(){return this.root.value}set value(e){this.root.value=e,A(this.root)}onEnter(e){}}function A(e){let t=document.createElement("span");if(e.hasAttributes())for(let i of e.attributes)t.setAttribute(i.name,i.value);for(let i of e.children)t.appendChild(i.cloneNode(!0));t.style.whiteSpace="nowrap",t.innerText=e.value+"​",e.parentElement.appendChild(t);let i=t.getBoundingClientRect();e.parentElement.removeChild(t),e.style.width=`${i.width}px`}class C{constructor(...e){this.children=e}get root(){return this.__root}pushInto(e){return e.push(this),this}make(e=void 0){let t=document.createElement("div");t.classList.add("-tui-menu-list-layout");for(let i of this.children)t.appendChild(i.make(e));return this.__root=t,t}}class S extends C{make(e=void 0){let t=super.make(e);return t.classList.add("-tui-menu-flex-layout"),t}}class O extends C{callback(e,t){return this.__init=e,this.__cb=t,this}init(e={}){return this.make(void 0,e)}make(e=void 0,t={}){this.__cb&&((e=function(t=void 0){if(!0!==e.__removed)if(t){let i=t.make(e);e.__currentRoot.parentElement.replaceChild(e.__currentRoot,i),e.__currentRoot=i}else e.__removed=!0,e.__cb(e.state),e.__currentRoot.parentElement.removeChild(e.__currentRoot),e.__currentRoot=void 0}).__cb=this.__cb,e.state=t);let i=super.make(e);return i.classList.add("-tui-menu"),this.__cb&&(e.__currentRoot=i),this.__documentMouseDown=()=>{e(),document.removeEventListener("mousedown",this.__documentMouseDown)},document.addEventListener("mousedown",this.__documentMouseDown),i.addEventListener("contextmenu",(e=>e.stopPropagation())),this.__cb&&this.__init(i,this),i}}class T{constructor(e="Label",t="",i="scale(80%) translateY(-4.5%)",s=!1,o=void 0){this.__labelText=e,this.__iconSrc=t,this.iconTransform=i,this.__markdown=s,this.data=o}get root(){return this.__root}get label(){return this.__label}get labelText(){return this.__labelText}get markdown(){return this.__markdown}__setLabelContent(e,t,i){i?(async()=>{let i=(await r.e(838).then(r.t.bind(r,838,23))).default,{marked:s}=await r.e(23).then(r.bind(r,23));e.innerHTML=i.sanitize(s.parse(t))})():e.innerText=t}set labelText(e){this.__labelText=e,this.__setLabelContent(this.__label,this.__labelText,this.__markdown)}set markdown(e){this.__markdown=e,this.__setLabelContent(this.__label,this.__labelText,this.__markdown)}get icon(){return this.__icon}get iconSrc(){return this.__iconSrc}set iconSrc(e){this.__iconSrc=e,this.__icon.style.backgroundColor="black",this.__icon.style.webkitMaskImage=`url(${this.__iconSrc})`,this.__icon.style.maskImage=`url(${this.__iconSrc})`}set enabled(e){e?(this.root.style.pointerEvents="",this.root.classList.remove("-tui-menu-item-disabled")):(this.root.style.pointerEvents="none",this.root.classList.add("-tui-menu-item-disabled"))}make(e){let t=document.createElement("div");t.classList.add("-tui-menu-item");let i=document.createElement("span");i.className="-tui-menu-item-icon inline-button inline-icon-button -force-filter-svg-to-match-theme";let s=document.createElement("span");return s.classList.add("-tui-menu-item-label"),this.__setLabelContent(s,this.__labelText,this.__markdown),i.style.backgroundColor="black",i.style.webkitMaskImage=`url(${this.__iconSrc})`,i.style.maskImage=`url(${this.__iconSrc})`,i.style.transform=this.iconTransform,t.appendChild(i),t.appendChild(s),this.__mousedown=e=>{e.stopPropagation(),0===e.button&&t.setAttribute("data-pressed","")},t.addEventListener("mousedown",this.__mousedown),this.__click=i=>{i.stopPropagation(),0===i.button&&(t.removeAttribute("data-pressed"),e.state.target=this,e())},t.addEventListener("click",this.__click),this.__root=t,this.__label=s,this.__icon=i,t}pushInto(e){return e.push(this),this}static colorIcon(e,t){e.style.backgroundColor=t,e.classList.remove("-force-filter-svg-to-match-theme")}static matchThemeIcon(e){e.style.backgroundColor="",e.classList.add("-force-filter-svg-to-match-theme")}}class P extends T{constructor(e="Label",t="",i="scale(80%) translateY(-4.5%)",s=!1,o=void 0){super(e,t,i,s,o)}make(e){let t=super.make(e);return t.classList.add("-tui-menu-label"),t.addEventListener("mouseup",(e=>{t.removeAttribute("data-pressed")})),t.removeEventListener("click",this.__click),t}}class N{get root(){return this.__root}make(e){let t=document.createElement("hr");return t.classList.add("-tui-menu-hr"),this.__root=t,t}}class M extends T{constructor(e,t,i,s=!1,o="Label",n="",r="scale(80%) translateY(-4.5%)",a=!1,l=void 0){super(o,n,r,a,l),this.__onMake=e,this.__onSelect=t,this.options=i,this.__dropdown=s}set selection(e){this.__selection=e,this.__dropdown&&(this.labelText=e.labelText,this.iconSrc=e.iconSrc),this.__onSelect(this.selection,this)}get selection(){return this.__selection}make(e){let t=super.make(e);t.addEventListener("mouseup",(e=>{t.removeAttribute("data-pressed")})),t.removeEventListener("click",this.__click);let i=document.createElement("span");return i.className="-tui-menu-dropdown-indicator inline-button inline-icon-button -opacity-indication -force-filter-svg-to-match-theme",t.appendChild(i),this.__positioner=()=>{let e=t.getBoundingClientRect();return{clientX:e.left+e.width*(11/12),clientY:e.top-e.height/8}},this.__dropdownClick=t=>{if(!this.__menuOpen){let i=new O(...this.options).callback((e=>{for(let e of this.options)if(e===this.selection){e.root.setAttribute("data-pressed","");break}this.__onMake(e,this.options)}),(t=>{this.__menuOpen=!1,t.target&&(this.selection=t.target,this.__dropdown||(e.state.target=t.target,e()))})).make();i.classList.add("-tui-list-dropdown-menu"),this.__menuOpen=!0,function(e,t,i){e.preventDefault&&(e.preventDefault(),e.stopPropagation()),document.body.appendChild(t);let s=t.getBoundingClientRect();i instanceof Function&&(i=i(e));let o=i.clientX,n=i.clientY;o-=Math.max(-1*(window.innerWidth-i.clientX-s.width),0),n-=Math.max(-1*(window.innerHeight-i.clientY-s.height),0),t.style.top=n+"px",t.style.left=o+"px"}(t,i,this.__positioner)}},t.addEventListener("click",this.__dropdownClick),t}}function D(e,t){e.preventDefault&&e.preventDefault();let i=e.clientX,s=e.clientY;document.body.appendChild(t);let o=t.getBoundingClientRect();i-=Math.max(-1*(window.innerWidth-e.clientX-o.width),0),s-=Math.max(-1*(window.innerHeight-e.clientY-o.height),0),t.style.top=s+"px",t.style.left=i+"px"}let B={"option:popup-size":[760,465],"option:popup-scale":.9,"option:show-tab-info":3,"option:hide-popup-after-tab-selection":!0,"option:search-in-urls":!0,"option:popup-custom-theme":"","option:popup-theme":"classic","option:dont-clear-search":!0,"option:show-whats-new-on":"major-update","option:separate-save":!1};function W(e){return B[e]}function R(){browser.runtime.sendMessage({_:"batonPass"}),browser.sidebarAction&&browser.sidebarAction.close&&browser.sidebarAction.close();let e=browser.runtime.getURL("popup/tab.html");browser.tabs.query({url:[`${e}*`,`${e}?*`]}).then((e=>{e.length>0&&new b(e[0].id).remove()}))}var U=r(992),$=r.n(U);class j{constructor(){this.allowMove=!0,this.allowMultiselect=!0,this.allowKBOnly=!0,this.kbNavigation_skipLevels=[],this.changeListeners={}}on(e,t){this.changeListeners.hasOwnProperty(e)||(this.changeListeners[e]=[]),this.changeListeners[e].push(t)}off(e,t){this.changeListeners.hasOwnProperty(e)||(this.changeListeners[e]=[]);let i=this.changeListeners[e].indexOf(t);-1!==i&&this.changeListeners[e].splice(i,1)}__trigger(e,...t){this.changeListeners.hasOwnProperty(e)||(this.changeListeners[e]=[]);for(let i of this.changeListeners[e])i(...t)}move(e){return e!==this.allowMove&&this.__trigger("change",{allowMove:e}),this.allowMove=e,this}multiselect(e){return e!==this.allowMultiselect&&this.__trigger("change",{allowMultiselect:e}),this.allowMultiselect=e,this}kbonly(e,t=[]){return e!==this.allowKBOnly&&this.__trigger("change",{allowKBOnly:e,kbNavigation_skipLevels:t}),this.allowKBOnly=e,e&&(this.kbNavigation_skipLevels=t),this}get _draggableAttributeValue(){return this.allowMove?"true":"false"}static default(){return new j}}class q{static makeRoot(e,t){let i=e.createRoot(t);return i.classList.add("-tui-list-container"),i}set kb(e){this.__kb,this.__kb=e}get kb(){return this.__kb}static clearRoot(e){e.innerHTML=""}static isElementSelected(e){return e.classList.contains("-tui-list-selected")||e.classList.contains("-tui-list-all-children-selected")}static isElementHidden(e){return"none"===window.getComputedStyle(e).getPropertyValue("display")}static isElementVisible(e){return!q.isElementHidden(e)}isElementKeyboardNavigable(e){return-1===this.listOptions.kbNavigation_skipLevels.indexOf(q.levelOf(e))}static and(...e){return t=>{let i=!0;for(let s of e)i=i&&s(t);return i}}children(e,t=!1,i=e=>!0){if(e.isSameNode(this.root)){let e=[];for(let s of this.root.children)(0===q.levelOf(s)||t)&&i(s)&&e.push(s);return e}let s=e.nextElementSibling,o=q.levelOf(e),n=[];for(;null!==s&&o<q.levelOf(s);)(q.levelOf(s)===o+1||t)&&i(s)&&n.push(s),s=s.nextElementSibling;return n}parent(e){if(e.isSameNode(this.root))return null;let t=e.previousElementSibling,i=q.levelOf(e);for(;null!==t&&i<=q.levelOf(t);)t=t.previousElementSibling;return t}previous(e,t=e=>!0){if(e.isSameNode(this.root))return null;let i,s=e.previousElementSibling;for(null!==s&&(i=t(s));null!==s&&!1===i;)s=s.previousElementSibling,null!==s&&(i=t(s));return i&&i.ret?i.ret:s}next(e,t=e=>!0){if(e.isSameNode(this.root))return null;let i,s=e.nextElementSibling;for(null!==s&&(i=t(s));null!==s&&!1===i;)s=s.nextElementSibling,null!==s&&(i=t(s));return i&&i.ret?i.ret:s}first(e=e=>!0){return this.next(this.root.children[0],e)}last(e=e=>!0){return this.previous(this.root.children[this.root.children.length-1],e)}areSiblings(e,t,i=e=>!0){let s=this.next(e,i),o=this.previous(e,i);return s&&s.isSameNode(t)||o&&o.isSameNode(t)}static levelOf(e){return parseInt(e.getAttribute("data-level"))}isElementHiddenBy(e,t){return e.classList.contains("-tui-list-hidden--"+t)}hideElement(e,t,i=!0){for(let s of[e,...this.children(e,i)]){const e=new Event("-tui-list-hidden");s.dispatchEvent(e),s.classList.add("-tui-list-hidden--"+t)}}showElement(e,t,i=!0){for(let s of[e,...this.children(e,i)]){const e=new Event("-tui-list-shown");s.dispatchEvent(e),s.classList.remove("-tui-list-hidden--"+t)}}getSelected(){return Array.from(this.root.getElementsByClassName("-tui-list-selected"))}modifySelected(e){let t=this.multiselectDragging,i=this.multiselect;this.multiselectDragging={action:""},this.multiselect=!0,e(((e,t,i,s=!1)=>{this.multiselectDragging.action=i;const o=new CustomEvent("-tui-list-internal--process-select",{detail:{originalEvent:t,action:i,automatic:s}});e.dispatchEvent(o)})),this.multiselectDragging=t,this.multiselect=i}constructor(e,t,i=j.default()){this.dataInterpret=t,t.__setList(this),this.root=e,this.multiselect=!1,this.multiselectDragging=!1,this.__kb=!1,this.lastSelected=void 0,this.documentHookInPlace_mouseUp=!1,this.endMultiselect=void 0,this.draggedElements=[],this.listOptions=i,this.kbMap={},this.documentHook_keyDown=e=>{this.kbMap[e.key]=!0,e.repeat||!this.kbMap.Meta&&!this.kbMap.Control||(this.enableMultiselect(),this.root.parentElement.style.overflowY="hidden")},this.documentHook_keyUp=e=>{delete this.kbMap[e.key],this.kbMap.Meta||this.kbMap.Control||(this.disableMultiselect(),this.root.parentElement.style.overflowY="")},i.allowMultiselect&&document.addEventListener("keydown",this.documentHook_keyDown),document.addEventListener("keyup",this.documentHook_keyUp),this.documentHook_keyDownKBOnly=e=>{e.repeat||(this.kb=!0);let t,i=this.root.querySelector(".-tui-list-hover");if("ArrowUp"===e.key)if(e.preventDefault(),i){let e=this.previous(i,q.and(q.isElementVisible,this.isElementKeyboardNavigable.bind(this)));e&&(i.classList.remove("-tui-list-hover"),t=e)}else t=this.last(q.and(q.isElementVisible,this.isElementKeyboardNavigable.bind(this)));else if("ArrowDown"===e.key)if(e.preventDefault(),i){let e=this.next(i,q.and(q.isElementVisible,this.isElementKeyboardNavigable.bind(this)));e&&(i.classList.remove("-tui-list-hover"),t=e)}else t=this.first(q.and(q.isElementVisible,this.isElementKeyboardNavigable.bind(this)));t?(t.classList.add("-tui-list-hover"),t.dispatchEvent(new KeyboardEvent("keydown",{key:e.key}))):i&&i.dispatchEvent(new KeyboardEvent("keydown",{key:e.key}))},this.documentHook_keyUpKBOnly=e=>{let t=this.root.querySelector(".-tui-list-hover");t&&t.dispatchEvent(new KeyboardEvent("keyup",{key:e.key}))},i.allowKBOnly&&(document.addEventListener("keydown",this.documentHook_keyDownKBOnly),document.addEventListener("keyup",this.documentHook_keyUpKBOnly)),this.listOptionsHook_change=e=>{void 0!==e.allowMultiselect?e.allowMultiselect?document.addEventListener("keydown",this.documentHook_keyDown):document.removeEventListener("keydown",this.documentHook_keyDown):void 0!==e.allowKBOnly&&(e.allowKBOnly?(document.addEventListener("keydown",this.documentHook_keyDownKBOnly),document.addEventListener("keyup",this.documentHook_keyUpKBOnly)):(document.removeEventListener("keydown",this.documentHook_keyDownKBOnly),document.removeEventListener("keyup",this.documentHook_keyUpKBOnly)))},i.on("change",this.listOptionsHook_change)}create(e,t){let i=this.dataInterpret.createElement(e,t);i.setAttribute("draggable",this.listOptions._draggableAttributeValue),i.setAttribute("tabindex","0"),i.setAttribute("data-level",e),i.addEventListener("mouseenter",(()=>{if(!this.kb){let e=this.root.querySelector(".-tui-list-hover");e&&e.classList.remove("-tui-list-hover"),i.classList.add("-tui-list-hover")}}));let s=(e,t,i=void 0,o=!1)=>{if(q.isElementHidden(e))return"hidden";if(!this.multiselect&&!this.kbMap.Shift)return this.dataInterpret.handleClick(e,this.root.getElementsByClassName("-tui-list-selected"),t),"click";{let n=!1,r=(t,i)=>{let s;s=i?0:"unselecting"===t?-1:"selecting"===t?1:0;let o=this.parent(e);for(;null!==o;){o.hasAttribute("data-selected-children-count")||o.setAttribute("data-selected-children-count",0);let e=parseInt(o.getAttribute("data-selected-children-count"))+s;o.setAttribute("data-selected-children-count",e.toString()),this.children(o,!0).length===parseInt(o.getAttribute("data-selected-children-count"))?o.classList.add("-tui-list-all-children-selected"):o.classList.remove("-tui-list-all-children-selected"),o=this.parent(o)}};if(this.multiselectDragging){if(void 0===i&&e.classList.contains("-tui-list-selected")&&(i="unselecting"),this.multiselectDragging.hasOwnProperty("start")){let o,n=this.multiselectDragging.start.compareDocumentPosition(e);o=n&Node.DOCUMENT_POSITION_FOLLOWING?e=>this.previous(e,q.isElementVisible):n&Node.DOCUMENT_POSITION_PRECEDING?e=>this.next(e,q.isElementVisible):e=>e;let r=e=>{if(!e.isSameNode(this.multiselectDragging.start))return o(e)?o(e).isSameNode(this.multiselectDragging.start)?void 0:o(e):void 0},a=r(e);a&&s(a,t,i)}return"unselecting"===i?(e.classList.contains("-tui-list-selected")||(n=!0),e.classList.remove("-tui-list-selected"),o||(void 0!==this.lastSelected&&this.lastSelected.classList.remove("-tui-list-last-selected"),this.lastSelected=e,e.classList.add("-tui-list-last-selected")),r("unselecting",n),"unselecting"):(e.classList.contains("-tui-list-selected")&&(n=!0),e.classList.add("-tui-list-selected"),o||(void 0!==this.lastSelected&&this.lastSelected.classList.remove("-tui-list-last-selected"),this.lastSelected=e,e.classList.add("-tui-list-last-selected")),r("selecting",n),"selecting")}}};i.addEventListener("click",(e=>{this.multiselect||s(i,e)})),i.addEventListener("auxclick",(e=>{if(!this.multiselect&&1===e.button)return e.preventDefault(),s(i,e),!1})),i.addEventListener("contextmenu",(e=>{this.dataInterpret.handleClick(i,this.root.getElementsByClassName("-tui-list-selected"),e)}));let o=()=>{for(let e of document.querySelectorAll(".-tui-list-container li[data-drag-relation]"))e.removeAttribute("data-drag-relation")};i.addEventListener("dragstart",(e=>{if(!this.multiselect&&this.listOptions.allowMove){let t=document.getElementsByClassName("-tui-drag-ghost");if(t.length>0)for(let e of t)e.parentElement.removeChild(e);let s=Array.from(this.root.getElementsByClassName("-tui-list-selected"));0==s.length&&(s=[i]),this.draggedElements=s;let o=document.createElement("div");this.dataInterpret.ghostSetup(o),o.classList.add("-tui-drag-ghost"),o.style.position="fixed";for(let e=0;e<s.length;e++){let t=s[e].cloneNode(!0);o.appendChild(t),e!==s.length-1&&(this.areSiblings(s[e],s[e+1])||(o.lastElementChild.style.marginBottom="10px"))}document.body.appendChild(o),e.dataTransfer.setDragImage(o,0,4*o.getBoundingClientRect().height)}})),i.addEventListener("dragend",(()=>{o()})),i.addEventListener("dragover",(e=>{e.preventDefault(),o(),e.offsetY<=i.getBoundingClientRect().height/2?i.setAttribute("data-drag-relation","above"):i.setAttribute("data-drag-relation","below")})),i.addEventListener("dragleave",(e=>{})),i.addEventListener("drop",(e=>{this.dataInterpret.handleDrop(this.draggedElements,i,i.getAttribute("data-drag-relation")),i.removeAttribute("data-drag-relation")}));let n=(e,t)=>{this.multiselectDragging=!0,this.multiselectDragging={start:e,action:s(e,t)},this.multiselectDragging.start.classList.add("-tui-list-drag-starter")},r=(e,t)=>{this.dataInterpret.handleHover(e,t),this.multiselect&&this.multiselectDragging&&s(e,t,this.multiselectDragging.action)};this.endMultiselect=()=>{this.multiselectDragging&&(this.multiselectDragging.start.classList.remove("-tui-list-drag-starter"),this.multiselectDragging.start.setAttribute("draggable",this.listOptions._draggableAttributeValue)),this.multiselectDragging=!1},i.addEventListener("mousedown",(e=>{if(this.kbMap.Shift&&this.listOptions.allowMultiselect){if(!this.lastSelected){let t=i.classList.contains("-tui-list-selected")?"unselecting":"selecting";return void this.modifySelected((s=>s(i,e,t)))}{let t=!0;i.isSameNode(this.lastSelected)&&(t=!1);let s=this.lastSelected.classList.contains("-tui-list-selected")?"selecting":"unselecting";if(this.modifySelected((t=>{for(let o of t_getElementsBetween(this.lastSelected,i,q.isElementVisible))t(o,e,s);t(i,e,s)})),void 0!==this.lastSelected&&(this.lastSelected.classList.remove("-tui-list-last-selected"),this.lastSelected=void 0),t)return}}if(this.multiselect){if(i.nextElementSibling){let t=this.next(i,q.isElementVisible).classList.contains("-tui-list-selected")?"unselecting":"selecting";this.modifySelected((s=>{for(let o of this.children(i,!0,q.isElementVisible))s(o,e,t)}))}i.setAttribute("draggable","false"),n(i,e)}})),this.documentHookInPlace_mouseUp||(this.documentHookInPlace_mouseUp=!0,document.addEventListener("mouseup",this.endMultiselect)),i.addEventListener("mousemove",(e=>{this.kb=!1,r(i,e)})),i.addEventListener("keydown",(e=>{let t=this.root.querySelector(".-tui-list-hover");e.target.isSameNode(t)&&(r(i,e),this.dataInterpret.handleClick(i,this.root.getElementsByClassName("-tui-list-selected"),e))}));let a=e=>{if(i.classList.contains("-tui-list-hover")){let t=q.levelOf(i),s=!1,o=this.next(i,(e=>(q.levelOf(e)<t&&(s=!0),q.isElementVisible(e)&&this.isElementKeyboardNavigable(e))));if(o&&!s)o.classList.add("-tui-list-hover"),setTimeout((()=>this.dataInterpret.handleHover(o,e)),1);else{let t=this.previous(i,(e=>q.isElementVisible(e)&&this.isElementKeyboardNavigable(e)));t?(t.classList.add("-tui-list-hover"),setTimeout((()=>this.dataInterpret.handleHover(t,e)),1)):o&&s&&(o.classList.add("-tui-list-hover"),setTimeout((()=>this.dataInterpret.handleHover(o,e)),1))}i.classList.remove("-tui-list-hover")}};return i.addEventListener("-tui-list-hidden",(e=>{a("-tui-list-hidden"),this.modifySelected((e=>e(i,"hidden","unselecting",!0)))})),i.addEventListener("-tui-list-removed",(e=>{a("-tui-list-removed")})),i.addEventListener("-tui-list-internal--process-select",(e=>{s(i,e.detail.originalEvent,e.detail.action,e.detail.automatic)})),i}enableMultiselect(){this.multiselect=!0}disableMultiselect(){this.multiselect=!1}}class V extends q{}class F extends V{constructor(e,t,i,s=j.default(),o=!0){s.kbonly(!0,[0]),super(e,i,s),this.sess=t;let n=t.getAllAs2DArray(),r=t=>{e.appendChild(this.create(0,{id:t[0].windowId,incognito:t[0].incognito}));for(let i of t)e.appendChild(this.createTab(i,this,!0,o))};for(let e of n)r(e);this.sessionListener={onTabCreated:e=>{this.put(e,this.createTab(e,this,!0,o))},onWindowClosed:t=>{let i=e.querySelector(`.window-entry[data-window-id="${t}"]`);i&&i.parentElement.removeChild(i)},onWindowFocusChanged:t=>{let i=e.querySelector(".window-entry[data-current]");i&&i.removeAttribute("data-current"),i=e.querySelector(`.window-entry[data-window-id="${t}"]`),i&&i.setAttribute("data-current","true")}},t.addListener(this.sessionListener)}static keywordSearch(e,t){let i=t.trim().split(" "),s=0,o=0;for(let t=0;t<i.length;t++){let n=i[t];""!==n.trim()&&n.match(/^[a-zA-Z0-9]+$/)&&(o++,e.toUpperCase().includes(n.toUpperCase())&&s++)}return s>=Math.max(2,o/2)}static search(e,t){return t=t.replace("\n"," ").trim(),e.toUpperCase().includes(t.toUpperCase())||F.keywordSearch(e,t)}filter(e,t=void 0){if(console.log(t),void 0===t)for(let e of this.root.children)this.showElement(e,"filter");else{let i={};for(let e of this.root.children)e.hasAttribute("data-tab-id")&&(i[e.getAttribute("data-tab-id")]=e);let s=0,o=0;for(let e of Object.values(t))e.score<s&&(s=e.score),e.score>o&&(o=e.score);let n=2*(s+o)/3;for(let s in t)if(t.hasOwnProperty(s)){let o=this.sess.getTab(parseInt(s));0!==n&&t[s].score>=n||F.search(o.url,e)||F.search(o.title,e)?this.showElement(i[s],"filter"):this.hideElement(i[s],"filter"),delete i[s]}for(let t in i)if(i.hasOwnProperty(t)){let s=this.sess.getTab(parseInt(t));F.search(s.url,e)||F.search(s.title,e)?this.showElement(i[t],"filter"):this.hideElement(i[t],"filter")}}}manualFilter(e,t){if("recall"===e)return w.fulfillOnce(`memory:filter-recall--${t}`,(e=>{if(void 0!==e){let i=new Set(JSON.parse(e));return this.manualFilter((e=>!e.hasAttribute("data-tab-id")||i.has(parseInt(e.getAttribute("data-tab-id")))),t)}}));let i=[];if(this.children(this.root,!0,(s=>(void 0===e?this.showElement(s,t):e(s)?s.hasAttribute("data-tab-id")&&i.push(parseInt(s.getAttribute("data-tab-id"))):this.hideElement(s,t),!1))),void 0===e){let e=this.root.parentElement.querySelector(`.-tui-list-manual-filter-indicator--${t}`);return e&&e.setAttribute("data-inactive",""),w.unset(`memory:filter-recall--${t}`)}{let e=this.root.parentElement.querySelector(`.-tui-list-manual-filter-indicator--${t}`);if(!e){e=document.createElement("div"),e.classList.add("-tui-list-manual-filter-indicator"),e.classList.add(`-tui-list-manual-filter-indicator--${t}`);let i=this.root.getBoundingClientRect(),s=this.root.parentElement.getBoundingClientRect();e.style.width=`${i.width}px`,e.style.height=`${Math.min(i.height,s.height)}px`,e.style.left=`${i.left}px`,e.style.top=`${Math.max(i.top,s.top)}px`;let o=new ResizeObserver((t=>{let i=this.root.getBoundingClientRect(),s=this.root.parentElement.getBoundingClientRect();e.style.width=`${i.width}px`,e.style.height=`${Math.min(i.height,s.height)}px`,e.style.left=`${i.left}px`,e.style.top=`${Math.max(i.top,s.top)}px`}));o.observe(this.root),o.observe(this.root.parentElement),this.root.parentElement.appendChild(e)}for(let e of this.root.parentElement.getElementsByClassName("-tui-list-manual-filter-indicator"))e.classList.contains(`-tui-list-manual-filter-indicator--${t}`)?e.style.zIndex="999999":e.style.zIndex="";return e.removeAttribute("data-inactive"),t_resetAnimation(e),w.set(`memory:filter-recall--${t}`,JSON.stringify(i))}}resort(){}async put(e,t){let i=e.windowId,s=this.root.querySelector(`.window-entry[data-window-id="${i}"]`);if(null===s)this.root.appendChild(this.create(0,{id:i,incognito:e.incognito})),this.root.appendChild(t);else{let i=s,o=await e.index+1;for(let e=0;e<o;e++)i=i.nextElementSibling;this.root.insertBefore(t,i)}}cleanUp(){let e=this.sess.getAllAs2DArray();for(let t of e)for(let e of t)e.clearProxies();return F.clearRoot(this.root),this.sess.removeListener(this.sessionListener),document.removeEventListener("keydown",this.documentHook_keyDown),document.removeEventListener("keyup",this.documentHook_keyUp),document.removeEventListener("keydown",this.documentHook_keyDownKBOnly),document.removeEventListener("keyup",this.documentHook_keyUpKBOnly),this.endMultiselect&&document.removeEventListener("mouseup",this.endMultiselect),this.listOptions.off("change",this.listOptionsHook_change),this.root}createTab(e,t,i=!0,s=!0){let o=t.create(1,e);return i&&e.proxy(((i,n)=>{if(console.log("Tab "+e.id+"'s property "+i+" has been set to '"+n+"'"),"#position"===i&&s){let e=t.root.querySelector(`.window-entry[data-window-id="${n.newWindowId}"]`),i=n.newPosition;for(;i>0;)e=e.nextElementSibling,e&&e.isEqualNode(o)&&(e=e.nextElementSibling),i--;e.parentElement.insertBefore(o,e.nextElementSibling),o.hasAttribute("data-current")&&this.scrollCurrentIntoView(void 0,!1,{behavior:"smooth",block:"nearest"})}else if("active"===i)n?o.setAttribute("data-current",""):o.removeAttribute("data-current"),this.scrollCurrentIntoView(void 0,!1,{behavior:"smooth",block:"nearest"});else if("title"===i){let e=o.querySelector(".title");e&&(e.innerText=n)}else if("url"===i);else if("favIconUrl"===i){let t,i=o.querySelector(".favicon");t=n.startsWith("chrome://")?Promise.resolve(n):e.incognito?t_getImage(n,!0):t_getImage(n),t.then((e=>{i.src=e}))}else if("discarded"===i)n?o.setAttribute("data-discarded",""):o.removeAttribute("data-discarded");else if("mutedInfo"===i){let t=o.querySelector(".speaker");t&&(n.muted?t.setAttribute("data-state","off"):e.audible?t.setAttribute("data-state","on"):t.setAttribute("data-state",""))}else if("audible"===i){let t=o.querySelector(".speaker");t&&(e.mutedInfo.muted?t.setAttribute("data-state","off"):n?t.setAttribute("data-state","on"):t.setAttribute("data-state",""))}else if("pinned"===i){let e=o.querySelector(".pin");e&&e.setAttribute("data-state",n?"pinned":"")}else"status"===i&&this.dataInterpret.details.tabId===e.id&&"complete"===n&&this.dataInterpret.details.captureTab(!0)}),(()=>{const e=new Event("-tui-list-removed");o.dispatchEvent(e),o.parentElement.removeChild(o)})),this.root.getElementsByClassName("-tui-list-hidden--manual-filter").length>0&&o.classList.add("-tui-list-hidden--manual-filter"),this.root.getElementsByClassName("-tui-list-hidden--llm-filter").length>0&&o.classList.add("-tui-list-hidden--llm-filter"),o}scrollCurrentIntoView(e,t=!0,i={behavior:"smooth",block:"center"}){let s=this.root.querySelector(".tab-list .window-entry[data-current] ~ .tab-entry[data-current]");if(s){if(t&&q.isElementVisible(s)){let t=this.root.querySelector(".-tui-list-hover");t&&t.classList.remove("-tui-list-hover"),s.classList.add("-tui-list-hover"),this.dataInterpret.handleHover(s,e)}s.scrollIntoView(i)}}}class H{createRoot(e){return document.createElement("div")}createElement(e,t){return document.createElement("div")}handleClick(e,t,i){}handleHover(e,t){}ghostSetup(e){}handleDrop(e,t,i){}}class z extends L{constructor(e,t){super(!1),this.sess=e,this.tabsList=t,this.root.id="_search",this.root.classList.add("search"),this.root.setAttribute("type","text"),this.root.addEventListener("keydown",(e=>{this.tabsList.documentHook_keyDown(e),"ArrowDown"===e.key&&(this.value.includes("\n")||this.onEnter(this.value,e)),"Escape"===e.key&&R()})),this.root.addEventListener("keyup",(e=>{this.tabsList.documentHook_keyUp(e)})),this.editing=!0,m.fulfillOnce("option:dont-clear-search",(e=>{e&&w.fulfillOnce("memory:search-value",(e=>{e&&this.value!==e&&(this.value=e,this.onInput(e),setTimeout((()=>L.focus(this.root)),100))}),"")}),W("option:dont-clear-search"))}reconstructQuery(e,t=!1){switch(e.t){case"ALL":let i="";for(let t=0;t<e.children.length;t++)i+=this.reconstructQuery(e.children[t],t==e.children.length-1);return i;case"SENTENCE":return t?e.originalString:(this._offset+=e.adjustedString.length-e.originalString.length,e.adjustedString);case"REGEX":case"NOOP":return e.originalString}}async onInput(e){if(await w.set("memory:search-value",e),""===e.trim())this.tabsList.filter(e,void 0);else{let t=this.tabsList.children(this.tabsList.root,!0,(e=>!this.tabsList.isElementHiddenBy(e,"manual-filter")&&e.hasAttribute("data-tab-id"))).map((e=>e.getAttribute("data-tab-id")));await browser.runtime.sendMessage({_:"search",queryString:e,ids:t})}}onEnter(e,t){if(t.key){this.root.blur();let e=this.tabsList.first(q.and(q.isElementVisible,this.tabsList.isElementKeyboardNavigable.bind(this.tabsList))),t=this.tabsList.root.querySelector(".-tui-list-hover");t&&t.classList.remove("-tui-list-hover"),e&&(e.classList.add("-tui-list-hover"),e.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"})),e.dispatchEvent(new KeyboardEvent("keyup",{key:"ArrowDown"})))}}}class K extends x{static __instances=new Map;static sessionListener={onTabCreated:e=>{},onWindowClosed:e=>{K.__instances.has(e)&&(K.__instances.get(e).cleanUp(),K.__instances.delete(e)),K.recalculateOrder()},onWindowFocusChanged:e=>{}};static recalculateOrder(){let e=1;for(let[,t]of K.__instances)t.initialWindowName=`Window ${e}`,t.windowOrder=e,e++}static getInstance(e){return K.__instances.get(e)}constructor(e,t,i){super(),this.windowId=e,this.windowOrder=-1,this.sess=t,K.__instances.set(e,this),t.hasListener(K.sessionListener)||t.addListener(K.sessionListener),this.__initialWindowName=i,this.__currentValue="",this.wrapper=document.createElement("span"),this.wrapper.classList.add("title"),this.wrapper.appendChild(this.root),this.currentWindowIndicator=document.createElement("span"),this.currentWindowIndicator.innerText=" - Current",this.currentWindowIndicator.classList.add("current-window-indicator"),this.wrapper.appendChild(this.currentWindowIndicator),K.recalculateOrder()}initializeFromStore(){this.__storeListener=e=>{this.value=e||"",e!==this.sess._rel.getName(this.windowId)&&this.sess._rel.setName(this.windowId,e)},w.fulfill(`window${this.windowId}`,this.__storeListener)}cleanUp(){w.removeFulfiller(`window${this.windowId}`,this.__storeListener)}set initialWindowName(e){this.__initialWindowName=e,this.value=this.__currentValue}set value(e){this.__currentValue=e,""===e.trim()?super.value=this.__initialWindowName:super.value=`${e} (${this.windowOrder})`}get displayedValue(){return""===this.__currentValue.trim()?this.__initialWindowName:`${this.__currentValue} (${this.windowOrder})`}get verboseValue(){return""===this.__currentValue.trim()?this.__initialWindowName:`${this.__currentValue} (Window ${this.windowOrder})`}get value(){return this.__currentValue}get editing(){return super.editing}set editing(e){super.editing=e,""===this.__currentValue&&e?super.value="":this.__currentValue&&(super.value=this.__currentValue),this.wrapper&&this.wrapper.parentElement&&(e?this.wrapper.parentElement.querySelector(".rename-window").classList.add("hold-while-editing"):this.wrapper.parentElement.querySelector(".rename-window").classList.remove("hold-while-editing"))}onEnter(e){this.sess._rel.setName(this.windowId,e),this.editing=!1,t_altReleasedEarly()}}class Y extends H{constructor(e,t){super(),this.sess=e,this.details=t,this.list=void 0}__setList(e){this.list=e}createRoot(e){let t=document.createElement("ul");return t.id="tab-list",t.classList.add("tab-list"),document.querySelector("#session-display-pane > #where-to-put-the-tab-list").appendChild(t),t}createElement(e,t){if(0==e){let e=document.createElement("li");e.className="window-entry",t.incognito&&e.classList.add("incognito"),e.setAttribute("data-window-id",t.id),this.sess._rel.getFocusedWindow()===t.id&&e.setAttribute("data-current","true");let i=document.createElement("span");i.className="single-controls";let s=document.createElement("span");s.className="inline-button inline-icon-button -opacity-indication -force-filter-svg-to-match-theme hide-window-tabs",i.appendChild(s),e.appendChild(i);let o=new K(t.id,this.sess,"Window #");e.appendChild(o.wrapper),setTimeout((()=>o.value=""),1),setTimeout((()=>o.initializeFromStore()),2),i=document.createElement("span"),i.className="single-controls",s=document.createElement("span"),s.className="inline-button inline-icon-button -opacity-indication -force-filter-svg-to-match-theme rename-window";let n=document.createElement("span");return n.className="inline-button inline-icon-button -opacity-indication -force-filter-svg-to-match-theme close-window",i.appendChild(s),i.appendChild(n),e.appendChild(i),e}if(1==e){let e,i=document.createElement("li");i.className="tab-entry",t.incognito&&i.classList.add("incognito"),i.setAttribute("data-tab-id",t.id),t.active&&i.setAttribute("data-current",""),e=document.createElement("div"),e.className="last-selected-indicator",i.appendChild(e),e=document.createElement("div"),e.className="selected-indicator",i.appendChild(e),e=document.createElement("div"),e.className="contextual-identity-indicator";let s=e;t.mozContextualIdentity.then((e=>{e&&(s.style="--contextual-identity-color: "+e.colorCode+";")})),i.appendChild(e),e=document.createElement("img"),e.className="favicon";let o=e;if(t.favIconUrl){let e;e=t.favIconUrl.startsWith("chrome://")?Promise.resolve(t.favIconUrl):t.incognito?t_getImage(t.favIconUrl,!0):t_getImage(t.favIconUrl),e.then((e=>{o.src=e}))}i.appendChild(e),e=document.createElement("div"),e.className="title-wrapper";let n=document.createElement("span");n.className="title",n.innerText=t.title,e.appendChild(n),i.appendChild(e),t.discarded&&i.setAttribute("data-discarded",""),e=document.createElement("div"),e.className="single-controls";let r=document.createElement("span");r.className="inline-button inline-icon-button -opacity-indication -force-filter-svg-to-match-theme show-when-on hide-when-not-selected pin",r.setAttribute("data-state",t.pinned?"pinned":"");let a=document.createElement("span");a.className="inline-button inline-icon-button -opacity-indication -force-filter-svg-to-match-theme show-when-on speaker",a.setAttribute("data-state",t.mutedInfo.muted?"off":t.audible?"on":"");let l=document.createElement("span");return l.className="inline-button inline-icon-button close-tab",e.appendChild(r),e.appendChild(a),e.appendChild(l),i.appendChild(e),i}}async handleClick(e,t,i){let s,o=(t=Array.from(t)).some((t=>t.isSameNode(e)));if(e.classList.contains("tab-entry")){s=parseInt(e.getAttribute("data-tab-id"));let n,r=this.sess.getTab(s);if(o){let e=t.filter((e=>e.hasAttribute("data-tab-id"))).map((e=>parseInt(e.getAttribute("data-tab-id"))));n=new b(...e)}else n=new b(s);if(i.type&&"contextmenu"===i.type){let e,t,o;D(i,new O(e=new M((()=>{}),(e=>{void 0!==e.data.windowId?n.moveTo(e.data.windowId,-1):browser.runtime.sendMessage({_:"menuMoveTabsToANewWindow",tabIds:n.ids,anchorId:s})}),[...this.sess._rel.getWindowIds().map(((e,t)=>new T(K.getInstance(e).displayedValue,"",void 0,void 0,{windowId:e}))),new N,new T("A New Window","",void 0,void 0,{})],!1,"Move Tab(s) to...",""),t=new T("Unload",""),o=new T("Reload","../icons/refresh.svg")).callback((()=>{}),(e=>{e.target===t?n.discard():e.target===o&&n.reload()})).make())}else if(i.target.classList.contains("pin")||"p"===i.key||"P"===i.key)await n.pin(!r.pinned);else if(i.target.classList.contains("speaker")||"m"===i.key||"M"===i.key)await n.mute(!r.mutedInfo.muted);else if(i.target.classList.contains("close-tab")||1===i.button||"Delete"===i.key)await n.remove();else{if(i.key&&"Enter"!==i.key)return;await new b(s).activate(),this.sess.getWindowActions(r.windowId).activate(),m.fulfillOnce("option:hide-popup-after-tab-selection",(e=>{e&&window.close()}),W("option:hide-popup-after-tab-selection"))}}else if(e.classList.contains("window-entry")){let t=parseInt(e.getAttribute("data-window-id"));s=this.sess._rel.getActiveTab(t);let o=new v(t);if(i.type&&"contextmenu"===i.type){let e;D(i,new O(e=new T("Rename","../icons/rename.svg")).callback((()=>{}),(i=>{if(i.target===e){let e=K.getInstance(t);e&&(e.editing=!0)}})).make())}else if(i.target.classList.contains("rename-window")){let e=K.getInstance(t);e&&(e.editing=!0)}else if(i.target.classList.contains("close-window"))await o.remove();else{if(i.key&&"Enter"!==i.key)return;await o.activate(),m.fulfillOnce("option:hide-popup-after-tab-selection",(e=>{e&&window.close()}),W("option:hide-popup-after-tab-selection"))}}if(void 0!==s){await E(s,"focusd",{action:"checkPrevious"});let e=(t,i)=>{"initialKeyEventsPassthrough"===t._&&(console.log(`event passthrough from tab ${i.tab.id} on listener for tab ${s}`,t),i.tab.id===s&&("keydown"===t.type||"keyup"===t.type?document.dispatchEvent(new KeyboardEvent(t.type,{key:t.key})):"passthroughover"===t.type&&browser.runtime.onMessage.removeListener(e)))};browser.runtime.onMessage.addListener(e);try{await E(s,"focusd",void 0)}catch(t){console.error(`failed to passthrough keyboard commands from tab with id ${s}`,t),browser.runtime.onMessage.removeListener(e)}}}handleHover(e,t){t&&t.key&&("ArrowUp"===t.key?t_getInView(e,this.list.root.parentElement,!0):"ArrowDown"===t.key&&t_getInView(e,this.list.root.parentElement,!1));let i=parseInt(e.getAttribute("data-tab-id")),s=this.sess.getTab(i);e.classList.contains("tab-entry")&&s&&(this.details.setCurrent(i),this.details.setTitle(s.title),this.details.setURL(s.url),this.details.captureTab())}ghostSetup(e){e.classList.add("tab-list"),e.style.width="calc(var(--width) * 0.45)"}handleDrop(e,t,i){let s=e.filter((e=>e.classList.contains("tab-entry"))).map((e=>parseInt(e.getAttribute("data-tab-id"))));if(t.classList.contains("window-entry")){let e=parseInt(t.getAttribute("data-window-id"));b.move(s,e,-1)}else{let o=this.sess.getTab(parseInt(t.getAttribute("data-tab-id"))).windowId,n=()=>{let i;for(const t of e)if(this.sess.getTab(parseInt(t.getAttribute("data-tab-id"))).windowId===o){i=t;break}return!!i&&i.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING},r=Array.from(t.parentElement.children),a=t.parentElement.querySelector(`.window-entry[data-window-id="${o}"]`),l=r.indexOf(t);if(l=l-r.indexOf(a)-1,n()&&l--,"below"===i&&l++,this.list&&"below"===i){let e=this.list.children(a,!1);t.isSameNode(e[e.length-1])&&(l=-1)}b.move(s,o,l)}}}(async()=>{await m.fulfill("option:popup-theme",(async e=>{document.querySelector(":root").setAttribute("data-theme",e),""===e&&await m.fulfillOnce("option:popup-custom-theme",(e=>{document.getElementById("theming").appendChild(document.createTextNode(e))}),W("option:popup-custom-theme"))}),W("option:popup-theme")),await m.fulfill("option:popup-size",(e=>{document.documentElement.style.setProperty("--width",`${Math.min(e[0],800)}px`),document.documentElement.style.setProperty("--height",`${Math.min(e[1],600)}px`)}),W("option:popup-size")),await m.fulfill("option:popup-scale",(e=>{document.documentElement.style.setProperty("--scale",`${e}`)}),W("option:popup-scale")),await m.fulfill("option:show-tab-info",(e=>{window.__TUI_SIDEBAR&&(e=1),1===e?(document.querySelector("#main").setAttribute("data-no-details-pane",""),document.querySelector("#main #details-placeholder").setAttribute("data-no-details-pane","")):2===e?(document.querySelector("#main").removeAttribute("data-no-details-pane"),document.querySelector("#main #details-placeholder").removeAttribute("data-no-details-pane"),document.querySelector("#main #details-pane").setAttribute("data-no-preview","")):3===e&&(document.querySelector("#main").removeAttribute("data-no-details-pane"),document.querySelector("#main #details-placeholder").removeAttribute("data-no-details-pane"),document.querySelector("#main #details-pane").removeAttribute("data-no-preview"))}),W("option:show-tab-info"));let e=!1,t=()=>{e||(e=!0,document.body.classList.add("alt-pressed"))},i=()=>{e&&(e=!1,document.body.classList.remove("alt-pressed"))},s="popup";await m.fulfill("memory:layout",(e=>{s=e})),document.addEventListener("keydown",(e=>{"Alt"===e.key&&t(),(e=>{if("s"===e.key)setTimeout((()=>d.editing=!0),1);else if("S"===e.key)l.scrollCurrentIntoView(e),l.kb=!0;else if("a"===e.key||"A"===e.key)l.modifySelected((t=>{let i=l.children(l.root,!1),s=i.length;for(let e of i){let t=e.getAttribute("data-selected-children-count");null!==t&&(s+=parseInt(t))}let o=l.children(l.root,!0),n=o.reduce(((e,t)=>e+(q.isElementVisible(t)?1:0)),0);for(let i of o)n>s&&q.isElementVisible(i)?t(i,e,"selecting",!0):t(i,e,"unselecting",!0)}));else if("d"===e.key||"D"===e.key)l.manualFilter(void 0,"manual-filter"),d.value="",d.onInput(d.value),d.root.blur();else if("f"===e.key||"F"===e.key){let e=l.getSelected();l.manualFilter((t=>0===e.length?q.isElementVisible(t):!t.hasAttribute("data-tab-id")||e.includes(t)),"manual-filter")}else"i"!==e.key&&"I"!==e.key||l.modifySelected((t=>{for(let i of l.children(l.root,!0)){let s=i.classList.contains("-tui-list-selected")?"unselecting":"selecting";q.isElementVisible(i)?t(i,e,s,!0):t(i,e,"unselecting",!0)}}))})(e)})),document.addEventListener("drag",(e=>{e.altKey?t():i()})),document.addEventListener("keyup",(e=>{"Alt"===e.key&&i()})),window.t_altReleasedEarly=i,window.onblur=()=>{},window.onfocus=()=>{document.body.style.opacity=""};let o=await k.read_from_current();o.enableBrowserHooks();let n=new I,r=new Y(o,n),a=q.makeRoot(r,void 0),l=new F(a,o,r);l.root.setAttribute("data-live","true"),l.manualFilter("recall","manual-filter");let d=new z(o,l),c=document.getElementById("_access_settings");c.parentElement.insertBefore(d.root,c),browser.runtime.onMessage.addListener((e=>{"search"===e._&&l.filter(d.value,e.results)})),browser.runtime.onMessage.addListener((e=>{"batonPass"===e._&&window.close()}));let h=await browser.runtime.sendMessage({_:"initialFocus"});!0===h.search||void 0===h.search&&!window.__TUI_SIDEBAR?(d.editing=!0,d.editing=!0,d.editing=!0,d.editing=!0,d.editing=!0):(l.scrollCurrentIntoView(void 0),l.kb=!0),document.getElementById("_access_settings").addEventListener("click",(e=>{browser.runtime.openOptionsPage(),window.close()}));let u=document.getElementById("save-for-later");m.fulfill("option:separate-save",(e=>{u.title=e?"Click to save locally\nRight click to save to sync storage":"Save websites for later"}),W("option:separate-save")),u.addEventListener("click",(e=>{m.fulfillOnce("option:separate-save",(t=>{p(e,!0,!t)}),W("option:separate-save"))})),u.addEventListener("contextmenu",(e=>{e.preventDefault(),m.fulfillOnce("option:separate-save",(t=>{t&&p(e,!1,!0)}),W("option:separate-save"))}));let p=async(e,t=!0,i=!0)=>{u.setAttribute("data-disabled","");let s=()=>{u.removeAttribute("data-disabled"),u.setAttribute("data-done",""),setTimeout((()=>{u.removeAttribute("data-done")}),3e3)},n=await o.toSerializable();n.mozContextualIdentities=await o.mozContextualIdentities;let r=(new Date).getTime();n.mozContextualIdentities=$().compressToUTF16(JSON.stringify(n.mozContextualIdentities)),n.rel=JSON.stringify(n.rel),n.tabs=$().compressToUTF16(JSON.stringify(n.tabs)),t&&(await m.set("sflv1_timestamp",r),await m.set("sflv1_mozContextualIdentities",n.mozContextualIdentities),await m.set("sflv1_rel",n.rel),await m.storeLarge("sflv1_tabs",n.tabs));try{i&&(await f.set("sflv1_timestamp",r),await f.set("sflv1_mozContextualIdentities",n.mozContextualIdentities),await f.set("sflv1_rel",n.rel),await f.storeLarge("sflv1_tabs",n.tabs)),s()}catch(t){let i;await f.unset("sflv1_timestamp","sflv1_mozContextualIdentities","sflv1_rel"),console.log("couldn't save to sync storage! error: "+t),D(e,new O(i=new P("The session was too large to be stored on the browser's sync storage. It's still saved locally though","../icons/cancel.svg","scale(0.8) translateY(1.5%) translateX(-7%)")).callback((e=>{}),(e=>{s()})).make())}},w={local:void 0,sync:void 0},_=document.getElementById("restore-now"),g=()=>{let e="";w.local&&(e+=`Click for the (local) save on ${new Date(w.local).toLocaleString()}\n`),w.sync&&(e+=`Right click for the (sync) save on ${new Date(w.sync).toLocaleString()}\n`),w.local&&w.local===w.sync&&(e=`Click for the save on ${new Date(w.local).toLocaleString()}\n`),""===e?(e+="Restore websites that have been saved for later",_.setAttribute("data-greyed-out","")):_.removeAttribute("data-greyed-out"),_.title=e};m.fulfill("sflv1_timestamp",(e=>{w.local=e,g()})),f.fulfill("sflv1_timestamp",(e=>{w.sync=e,g()}));let b=e=>{let t={};for(let i of e)t[i.cookieStoreId]=i;return t},v=(e,t)=>{let i;for(let s of e){let e=0;s.iconUrl===t.iconUrl&&(e+=2),s.colorCode===t.colorCode&&e++,i?e>i[1]&&(i=[s,e]):i=[s,e]}return i},y=async e=>{if(void 0===e)return{"firefox-default":"firefox-default","firefox-private":"firefox-private"};let t=await browser.contextualIdentities.query({}),i=(e=>{let t={};for(let i of e)t.hasOwnProperty(i.name)||(t[i.name]=[]),t[i.name].push(i);return t})(t),s=b(e),o=(b(t),{});for(let t of e)if(i.hasOwnProperty(t.name)&&i[t.name].length>0){let[e,s]=v(i[t.name],t);o[t.cookieStoreId]=e.cookieStoreId}else o[t.cookieStoreId]=void 0;let n,r,a,l,d,c=_.getBoundingClientRect(),h=[],u=[],p=[],m=function(e){for(let i=0;i<t.length;i++)if(e===t[i].cookieStoreId)return i;return-1};return Object.values(o).every((e=>void 0!==e))?Promise.resolve(o):new Promise(((e,i)=>{D({clientX:c.left,clientY:c.top+c.height},new O(l=new P("These containers were unable to be located: "),d=new N,new C(...Object.entries(o).filter((([e,t])=>void 0===t)).map((([e,i])=>new S(new P(s[e].name,s[e].iconUrl,void 0,void 0,{colorCode:s[e].colorCode}).pushInto(h),new M(((e,t)=>{for(let e of t)T.colorIcon(e.icon,e.data.colorCode)}),((t,i)=>{o[e]=t.data.cookieStoreId,T.colorIcon(i.icon,t.data.colorCode),Object.values(o).every((e=>void 0!==e))&&(r.enabled=!0)}),function(){let e=[];for(let i of t)e.push(new T(i.name,i.iconUrl,void 0,void 0,{colorCode:i.colorCode,cookieStoreId:i.cookieStoreId}));return e}(),!0,"Select...","",void 0,void 0,{initialSelection:i?m(i):-1}).pushInto(u)).pushInto(p)))),n=new S(a=new T("Cancel",""),r=new T("Ok"))).callback(((e,t)=>{document.removeEventListener("mousedown",t.__documentMouseDown);let i=e=>{e.style.display="flex",e.style.flexDirection="column",e.style.justifyContent="center"};l.icon.style.display="none",d.root.style.marginBottom="5px",i(l.root),a.icon.style.display="none",r.icon.style.display="none",n.root.style.flexDirection="row",n.root.style.justifyContent="space-between";let s=e=>{e.style.fontSize="12px"};s(r.root),i(r.root),s(a.root),i(a.root),r.enabled=Object.values(o).every((e=>void 0!==e));for(let e of p)e.root.style.flexDirection="row",e.root.style.justifyContent="space-between";for(let e of h)T.colorIcon(e.icon,e.data.colorCode);for(let e of u)-1!==e.data.initialSelection&&(e.selection=e.options[e.data.initialSelection])}),(t=>{t.target===r?e(o):i("cancelled")})).make())}))};_.addEventListener("click",(async e=>{if(w.local||w.sync){let e=await m.getOne("sflv1_mozContextualIdentities");e=$().decompressFromUTF16(e),e=JSON.parse(e);let t=await y(e);browser.runtime.sendMessage({_:"sflv1_openSession",store:"local",mozContextualIdentityMap:t})}})),_.addEventListener("contextmenu",(async e=>{e.preventDefault(),e.stopPropagation();let t=await f.getOne("sflv1_mozContextualIdentities");t=$().decompressFromUTF16(t),t=JSON.parse(t);let i=await y(t);browser.runtime.sendMessage({_:"sflv1_openSession",store:"sync",mozContextualIdentityMap:i})})),browser.permissions.contains({origins:["<all_urls>"]}).then((e=>Promise.all([m.getOne("option:show-tab-info"),Promise.resolve(e)]))).then((([e,t])=>{3!==e||t||D({clientX:0,clientY:0},new O(new P("**Permission:** 'Access your data for all websites'",void 0,void 0,!0),new P("Tabby shows a preview of each tab, requiring access to this permission in order to do so. Manifest v3 and browser updates have made this permission request more explicit, and extensions must directly ask the user for this permission.",void 0,void 0,!0),new P("In the following screen you will be asked if you want to give Tabby that permission. If you do, click yes. If not, you can always visit the Firefox addons settings page ('about:addons' in the URL bar) to edit the permissions given if you change your mind.",void 0,void 0,!0),new P("Only the tab preview feature will be affected.",void 0,void 0,!0),new P("**NOTE: Restart Firefox afterwards to let the permissions take effect**",void 0,void 0,!0),new N,new T("Continue...")).callback(((e,t)=>{e.style.width="100%"}),(()=>{browser.permissions.request({origins:["<all_urls>"]}).then((e=>{e||m.modify("option:show-tab-info",(e=>{if(3===e)return 2}),!0)}))})).make())}))})(),document.addEventListener("keydown",(e=>{"Escape"===e.key&&R()}))})()})();