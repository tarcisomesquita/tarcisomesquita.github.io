<!DOCTYPE html>
<html dir="ltr" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style>body {transition: opacity ease-in 0.2s; } 
body[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } 
</style>
    <meta name="google-signin-client-id" content="721724668570-nbkv1cfusk7kk4eni4pjvepaus73b13t.apps.googleusercontent.com">
    <meta name="google-signin-scope" content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="Google Developers">
    <meta property="og:type" content="website"><meta name="theme-color" content="#1e8e3e"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="https://developers.google.com/_pwa/developers/manifest.json" crossorigin="use-credentials">
    <link rel="preconnect" href="https://www.gstatic.com/" crossorigin="">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin="">
    <link rel="preconnect" href="https://apis.google.com/" crossorigin="">
    <link rel="preconnect" href="https://www.google-analytics.com/" crossorigin=""><link rel="stylesheet" href="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/css.css">
      <link rel="stylesheet" href="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/css_002.css"><link rel="stylesheet" href="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/app.css">
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/developers/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/developers/images/touchicon-180.png"><link rel="canonical" href="https://developers.google.com/speed/webp/docs/webp_lossless_bitstream_specification"><link rel="search" type="application/opensearchdescription+xml" title="Google Developers" href="https://developers.google.com/s/opensearch.xml">
      

<title>WebP Lossless Bitstream Specification &nbsp;|&nbsp; Google Developers</title>

<meta property="og:title" content="WebP Lossless Bitstream Specification &nbsp;|&nbsp; Google Developers"><meta property="og:url" content="https://developers.google.com/speed/webp/docs/webp_lossless_bitstream_specification"><meta property="og:image" content="https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/developers/images/opengraph/google-green.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="675"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary_large_image"><script type="text/javascript" async="" src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/linkid.js" nonce=""></script><script async="" src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/app_loader.js"></script><script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "WebP",
      "item": "https://developers.google.com/speed/webp"
    },{
      "@type": "ListItem",
      "position": 2,
      "name": "WebP Lossless Bitstream Specification",
      "item": "https://developers.google.com/speed/webp/docs/webp_lossless_bitstream_specification"
    }]
  }
  </script>
  

  

  


    <script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webcomponents-lite.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_app_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_a11y_announce_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_analytics_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_badger_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_book_nav_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_bookmark_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_code_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_content_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_panel_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_expandable_nav_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_footer_linkboxes_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_footer_promos_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_footer_utility_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_header_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_heading_link_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_language_selector_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_progress_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_recommendations_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_recommendations_dropdown_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_recommendations_sidebar_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_search_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_select_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_sitemask_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_snackbar_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_tabs_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_thumb_rating_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_toc_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_tooltip_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_user_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/analytics.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_badge_awarded_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_dialog_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_spinner_module.js" nonce=""></script><script src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/devsite_devsite_feedback_module.js" nonce=""></script><style type="text/css"></style></head>
  <body class="" template="page" theme="google-green" type="article" layout="docs" style="--devsite-js-header-top-row-height: 48px; --devsite-js-header-lower-section-height: 48px; --devsite-js-header-lower-tabs-height: 48px; --devsite-js-header-height: 96px; --devsite-js-header-lower-tabs-offset: 48px; --devsite-js-sidebar-max-height: 839px; --devsite-js-sidebar-max-width: 446px; --devsite-js-sidebar-offset: -48px; --devsite-js-book-nav-scrollbar-width: 0px; --devsite-js-book-nav-y-offset: -48px;" ready="">
    <devsite-progress id="app-progress"></devsite-progress>
  
    <section class="devsite-wrapper"><devsite-header top-row--height="48" bottom-row--height="48" bottom-tabs--height="48" fixed="" offset="48" bottom-row--hidden="">
  
    


























<div class="devsite-header--inner nocontent">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu" class="devsite-header-icon-button button-flat material-icons gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Navigation menu button" aria-label="Open menu">
        </button>
        <div class="devsite-product-name-wrapper">

  
    
  
  <a href="https://developers.google.com/speed/webp">
    
  <div class="devsite-product-logo-container" size="medium">
  
    <img class="devsite-product-logo" alt="WebP" src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon.png" srcset="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_36.png 36w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_48.png 48w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_72.png 72w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_96.png 96w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_480.png 480w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_720.png 720w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_856.png 856w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_960.png 960w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_1440.png 1440w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_1920.png 1920w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_2880.png 2880w" sizes="64px" loading="lazy">
  
  </div>
  
  </a>
  

  



  
  
  <span class="devsite-product-name">
    <ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
        
  <a href="https://developers.google.com/speed/webp" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Upper Header" data-value="1" track-type="globalNav" track-name="breadcrumb" track-metadata-position="1" track-metadata-eventdetail="WebP">
    
          WebP
        
  </a>
  
      
    
  </li>
  
</ul>
  </span>

</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
           </div>
          
<devsite-search aria-expanded="false" aria-haspopup="listbox" enable-signin="" enable-search="" enable-suggestions="" enable-query-completion="" project-name="WebP" tenant-name="Google Developers" project-scope="/speed/webp" url-scoped="https://developers.google.com/s/results/speed/webp" role="combobox">
  <form class="devsite-search-form" action="https://developers.google.com/s/results" method="GET">
    <div class="devsite-search-container">
      <div class="devsite-searchbox">
        <input aria-activedescendant="" aria-autocomplete="list" aria-label="Search" aria-haspopup="false" aria-multiline="false" autocomplete="off" class="devsite-search-field devsite-search-query" name="q" placeholder="Search" role="searchbox" type="text" aria-controls="devsite-search-popout-container-id-1">
        <div class="devsite-search-image material-icons" aria-hidden="true"></div>
      </div>
      <button type="button" search-open="" class="devsite-search-button devsite-header-icon-button button-flat material-icons" aria-label="Open search"></button>
    </div>
  <div class="devsite-popout" id="devsite-search-popout-container-id-1"><div class="devsite-popout-result devsite-suggest-results-container" devsite-hide=""></div></div></form>
  <button type="button" search-close="" class="devsite-search-button devsite-header-icon-button button-flat material-icons" aria-label="Close search"></button>
</devsite-search>

        <div class="devsite-search-background" style="opacity: 1;"></div></div>

        

        

        
<devsite-language-selector>
  <devsite-select class="devsite-language-selector-menu">
    
    <select aria-label="Select your language preference." class="devsite-language-selector-select" name="language" track-name="click" track-type="languageSelector">
    
    
      <option value="en" selected="selected" lang="en">
        English
      </option>
    
      <option value="id" lang="id">
        Bahasa Indonesia
      </option>
    
      <option value="de" lang="de">
        Deutsch
      </option>
    
      <option value="es" lang="es">
        Español
      </option>
    
      <option value="fr" lang="fr">
        Français
      </option>
    
      <option value="pt_br" lang="pt_br">
        Português – Brasil
      </option>
    
      <option value="ru" lang="ru">
        Русский
      </option>
    
      <option value="zh_cn" lang="zh_cn">
        中文 – 简体
      </option>
    
      <option value="ja" lang="ja">
        日本語
      </option>
    
      <option value="ko" lang="ko">
        한국어
      </option>
    
    </select>
  <div class="devsite-select"><label id="devsite-select-10659349935975565-label" style="display:none;" aria-label="Select your language preference.">Select an option</label><button type="button" class="devsite-select-toggle" id="devsite-select-10659349935975565-button" aria-haspopup="true" aria-labelledby="devsite-select-10659349935975565-label devsite-select-10659349935975565-button" aria-controls="devsite-select-10659349935975565-popup"><span class="devsite-select-toggle-label">English</span><span class="devsite-icon devsite-icon-arrow-drop-down devsite-select-toggle-icon" aria-hidden="true"></span></button><ul class="devsite-select-list" id="devsite-select-10659349935975565-popup" tabindex="-1" role="listbox" scrollbars="" aria-labelledby="devsite-select-10659349935975565-button"><li role="option" id="devsite-select-10659349935975565-0" class="devsite-select-item" data-index="0" data-selected="" aria-selected="true" aria-label="English, selected" value="en" lang="en">English</li><li role="option" id="devsite-select-10659349935975565-1" class="devsite-select-item" data-index="1" aria-selected="false" aria-label="Bahasa Indonesia" value="id" lang="id">Bahasa Indonesia</li><li role="option" id="devsite-select-10659349935975565-2" class="devsite-select-item" data-index="2" aria-selected="false" aria-label="Deutsch" value="de" lang="de">Deutsch</li><li role="option" id="devsite-select-10659349935975565-3" class="devsite-select-item" data-index="3" aria-selected="false" aria-label="Español" value="es" lang="es">Español</li><li role="option" id="devsite-select-10659349935975565-4" class="devsite-select-item" data-index="4" aria-selected="false" aria-label="Français" value="fr" lang="fr">Français</li><li role="option" id="devsite-select-10659349935975565-5" class="devsite-select-item" data-index="5" aria-selected="false" aria-label="Português – Brasil" value="pt_br" lang="pt_br">Português – Brasil</li><li role="option" id="devsite-select-10659349935975565-6" class="devsite-select-item" data-index="6" aria-selected="false" aria-label="Русский" value="ru" lang="ru">Русский</li><li role="option" id="devsite-select-10659349935975565-7" class="devsite-select-item" data-index="7" aria-selected="false" aria-label="中文 – 简体" value="zh_cn" lang="zh_cn">中文 – 简体</li><li role="option" id="devsite-select-10659349935975565-8" class="devsite-select-item" data-index="8" aria-selected="false" aria-label="日本語" value="ja" lang="ja">日本語</li><li role="option" id="devsite-select-10659349935975565-9" class="devsite-select-item" data-index="9" aria-selected="false" aria-label="한국어" value="ko" lang="ko">한국어</li></ul></div></devsite-select>
</devsite-language-selector>


        

        
          
          
          <devsite-user enable-profiles="" fp-auth="" id="devsite-user" sign-in-url="https://developers.google.com/_d/signin?continue=https%3A%2F%2Fdevelopers.google.com%2Fspeed%2Fwebp%2Fdocs%2Fwebp_lossless_bitstream_specification&amp;prompt=select_account" sign-out-url="https://developers.google.com/_d/signout?continue=https%3A%2F%2Fdevelopers.google.com%2Fspeed%2Fwebp%2Fdocs%2Fwebp_lossless_bitstream_specification" url="https://developers.google.com/_d/signout?continue=https%3A%2F%2Fdevelopers.google.com%2Fspeed%2Fwebp%2Fdocs%2Fwebp_lossless_bitstream_specification"><div class="ogb-wrapper ogb-si"><a href="https://developers.google.com/_d/signin?continue=https%3A%2F%2Fdevelopers.google.com%2Fspeed%2Fwebp%2Fdocs%2Fwebp_lossless_bitstream_specification&amp;prompt=select_account" class="devsite-user-signin button devsite-top-button" track-type="globalNav" track-name="signIn" track-metadata-eventdetail="nav" track-metadata-position="nav">
  Sign in
</a></div></devsite-user>
           
        
      </div>
    </div>
  </div>



  <div class="devsite-collapsible-section
    " style="transform: translate3d(0px, -48px, 0px);">
    <div class="devsite-header-background">
      
        
      
      
        <div class="devsite-doc-set-nav-row">
          
          
            
            
  <devsite-tabs class="lower-tabs" connected="">

    

  <nav class="devsite-tabs-wrapper" aria-label="Lower tabs">
      
        
          <tab>
            <a href="https://developers.google.com/speed/webp" class="gc-analytics-event " track-type="nav" track-name="home" track-metadata-eventdetail="https://developers.google.com/speed/webp" track-metadata-position="nav - home" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Home">
  Home
</a>

          </tab>
        
      
        
          <tab>
            <a href="https://developers.google.com/speed/webp/docs/using" class="gc-analytics-event " track-type="nav" track-name="guides" track-metadata-eventdetail="https://developers.google.com/speed/webp/docs/using" track-metadata-position="nav - guides" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Guides">
  Guides
</a>

          </tab>
        
      
        
          <tab active="">
            <a href="https://developers.google.com/speed/webp/faq" class="gc-analytics-event " track-type="nav" track-name="reference" track-metadata-eventdetail="https://developers.google.com/speed/webp/faq" track-metadata-position="nav - reference" track-metadata-module="primary nav" aria-label="Reference, selected" data-category="Site-Wide Custom Events" data-label="Tab: Reference">
  Reference
</a>

          </tab>
        
      
        
          <tab>
            <a href="https://developers.google.com/speed/webp/gallery" class="gc-analytics-event " track-type="nav" track-name="samples" track-metadata-eventdetail="https://developers.google.com/speed/webp/gallery" track-metadata-position="nav - samples" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Samples">
  Samples
</a>

          </tab>
        
      
        
          <tab>
            <a href="https://developers.google.com/speed/webp/community" class="gc-analytics-event " track-type="nav" track-name="support" track-metadata-eventdetail="https://developers.google.com/speed/webp/community" track-metadata-position="nav - support" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Support">
  Support
</a>

          </tab>
        
      
    <tab overflow-tab="" hidden=""><a href="#" class="devsite-icon devsite-icon-arrow-drop-down">More</a><div class="devsite-tabs-overflow-menu" scrollbars="" hidden=""></div></tab></nav></devsite-tabs>

          
          
        </div>
      
    </div>
  </div>

</div>



  
</devsite-header>
      <div class="devsite-book-nav-bg" fixed=""></div><devsite-book-nav scrollbars="" role="menu" fixed="" style="top: 96px; max-height: 887px;">
        
          


























<nav class="devsite-book-nav devsite-nav nocontent" aria-label="Side menu">
  <div class="devsite-mobile-header">
    <button type="button" id="devsite-close-nav" class="devsite-header-icon-button button-flat material-icons gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Close navigation" aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">

  
    
  
  <a href="https://developers.google.com/speed/webp">
    
  <div class="devsite-product-logo-container" size="medium">
  
    <img class="devsite-product-logo" alt="WebP" src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon.png" srcset="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_36.png 36w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_48.png 48w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_72.png 72w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_96.png 96w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_480.png 480w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_720.png 720w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_856.png 856w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_960.png 960w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_1440.png 1440w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_1920.png 1920w, WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/webp-devsite-icon_2880.png 2880w" sizes="64px" loading="lazy">
  
  </div>
  
  </a>
  

  


  
      <span class="devsite-product-name">
        
        
        <ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
        
  <a href="https://developers.google.com/speed/webp" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Upper Header" data-value="1" track-type="globalNav" track-name="breadcrumb" track-metadata-position="1" track-metadata-eventdetail="WebP">
    
          WebP
        
  </a>
  
      
    
  </li>
  
</ul>
      </span>
    

</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
            
<li class="devsite-nav-item">

  
  <a href="https://developers.google.com/speed/webp" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Home" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav" track-name="home">
  
    <span class="devsite-nav-text" tooltip="">
      Home
   </span>
    
  
  </a>
  

</li>

          
            
<li class="devsite-nav-item">

  
  <a href="https://developers.google.com/speed/webp/docs/using" class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Guides" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav" track-name="guides">
  
    <span class="devsite-nav-text" tooltip="">
      Guides
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward">
    </span>
    
  
  </a>
  

</li>

          
            
<li class="devsite-nav-item">

  
  <a href="https://developers.google.com/speed/webp/faq" class="devsite-nav-title gc-analytics-event devsite-nav-has-children" data-category="Site-Wide Custom Events" data-label="Responsive Tab: Reference" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav" track-name="reference">
  
    <span class="devsite-nav-text" tooltip="">
      Reference
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward">
    </span>
    
  
  </a>
  

</li>

          
            
<li class="devsite-nav-item">

  
  <a href="https://developers.google.com/speed/webp/gallery" class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Samples" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav" track-name="samples">
  
    <span class="devsite-nav-text" tooltip="">
      Samples
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward">
    </span>
    
  
  </a>
  

</li>

          
            
<li class="devsite-nav-item">

  
  <a href="https://developers.google.com/speed/webp/community" class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Support" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav" track-name="support">
  
    <span class="devsite-nav-text" tooltip="">
      Support
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward">
    </span>
    
  
  </a>
  

</li>

          
          
          
        </ul>
      
    </div>
    
      <div class="devsite-mobile-nav-bottom" role="navigation">
        
          
          <ul class="devsite-nav-list" menu="_book">
            <li class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/faq" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">FAQ</span></a></li>

  <li class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/compression" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Compression Techniques</span></a></li>

  <li class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/riff_container" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Container Specification</span></a></li>

  <li class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/webp_lossless_bitstream_specification" class="devsite-nav-title devsite-nav-active"><span class="devsite-nav-text" tooltip="">Lossless Bitstream Specification</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-expandable"><devsite-expandable-nav collapsed="" connected="" animatable="">
    <a class="devsite-nav-toggle" aria-hidden="true"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0" role="button" aria-expanded="false"><span class="devsite-nav-text" tooltip="">Studies</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">WebP Lossless and Alpha Study</span></a></li><li class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/webp_study" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">WebP Lossy Study</span></a></li></ul></devsite-expandable-nav></li>
          </ul>
        
        
        
          
    
  
    
  
    
  
    
  
    
  
        
      </div>
    
  </div>
</nav>
        
      </devsite-book-nav><div class="devsite-book-nav-blur" fixed=""></div><button class="devsite-book-nav-toggle" aria-haspopup="menu" fixed="" aria-label="Hide side navigation" data-title="Hide side navigation" aria-expanded="true"><span class="material-icons devsite-book-nav-toggle-icon"></span></button>
      <section id="gc-wrapper" style="margin-top: 96px;">
        <main role="main" class="devsite-main-content" has-book-nav="" has-sidebar="">
          
          <div class="devsite-sidebar" fixed="">
            <div class="sidebar-content">
              <devsite-toc class="devsite-nav devsite-toc" role="navigation" aria-label="On this page" depth="2" scrollbars="" visible=""><ul class="devsite-nav-list"><li class="devsite-nav-item devsite-nav-heading devsite-toc-toggle" role="heading" aria-level="2"><span class="devsite-nav-title"><span class="devsite-nav-text">On this page</span></span></li><li class="devsite-nav-item"><a href="#abstract" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="0" track-type="navigation" track-name="rightNav" track-metadata-position="0" track-metadata-link-destination="#abstract"><span class="devsite-nav-text" tooltip="">Abstract</span></a></li><li class="devsite-nav-item"><a href="#nomenclature" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="1" track-type="navigation" track-name="rightNav" track-metadata-position="1" track-metadata-link-destination="#nomenclature"><span class="devsite-nav-text" tooltip="">Nomenclature</span></a></li><li class="devsite-nav-item"><a href="#1_introduction" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="2" track-type="navigation" track-name="rightNav" track-metadata-position="2" track-metadata-link-destination="#1_introduction"><span class="devsite-nav-text" tooltip="">1 Introduction</span></a></li><li class="devsite-nav-item"><a href="#2_riff_header" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="3" track-type="navigation" track-name="rightNav" track-metadata-position="3" track-metadata-link-destination="#2_riff_header"><span class="devsite-nav-text" tooltip="">2 RIFF Header</span></a></li><li class="devsite-nav-item"><a href="#3_transformations" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="4" track-type="navigation" track-name="rightNav" track-metadata-position="4" track-metadata-link-destination="#3_transformations"><span class="devsite-nav-text" tooltip="">3 Transformations</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#predictor_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="4.0" track-type="navigation" track-name="rightNav" track-metadata-position="4.0" track-metadata-link-destination="#predictor_transform"><span class="devsite-nav-text" tooltip="">Predictor Transform</span></a></li><li class="devsite-nav-item"><a href="#color_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="4.1" track-type="navigation" track-name="rightNav" track-metadata-position="4.1" track-metadata-link-destination="#color_transform"><span class="devsite-nav-text" tooltip="">Color Transform</span></a></li><li class="devsite-nav-item"><a href="#subtract_green_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="4.2" track-type="navigation" track-name="rightNav" track-metadata-position="4.2" track-metadata-link-destination="#subtract_green_transform"><span class="devsite-nav-text" tooltip="">Subtract Green Transform</span></a></li><li class="devsite-nav-item"><a href="#color_indexing_transform" class="devsite-nav-title gc-analytics-event devsite-nav-active" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="4.3" track-type="navigation" track-name="rightNav" track-metadata-position="4.3" track-metadata-link-destination="#color_indexing_transform"><span class="devsite-nav-text" tooltip="">Color Indexing Transform</span></a></li></ul></li><li class="devsite-nav-item"><a href="#4_image_data" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="5" track-type="navigation" track-name="rightNav" track-metadata-position="5" track-metadata-link-destination="#4_image_data"><span class="devsite-nav-text" tooltip="">4 Image Data</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#41_roles_of_image_data" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="5.0" track-type="navigation" track-name="rightNav" track-metadata-position="5.0" track-metadata-link-destination="#41_roles_of_image_data"><span class="devsite-nav-text" tooltip="">4.1 Roles of Image Data</span></a></li><li class="devsite-nav-item"><a href="#42_encoding_of_image_data" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="5.1" track-type="navigation" track-name="rightNav" track-metadata-position="5.1" track-metadata-link-destination="#42_encoding_of_image_data"><span class="devsite-nav-text" tooltip="">4.2 Encoding of Image Data</span></a></li></ul></li><li class="devsite-nav-item"><a href="#5_entropy_code" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="6" track-type="navigation" track-name="rightNav" track-metadata-position="6" track-metadata-link-destination="#5_entropy_code"><span class="devsite-nav-text" tooltip="">5 Entropy Code</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#51_overview" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="6.0" track-type="navigation" track-name="rightNav" track-metadata-position="6.0" track-metadata-link-destination="#51_overview"><span class="devsite-nav-text" tooltip="">5.1 Overview</span></a></li><li class="devsite-nav-item"><a href="#52_details" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="6.1" track-type="navigation" track-name="rightNav" track-metadata-position="6.1" track-metadata-link-destination="#52_details"><span class="devsite-nav-text" tooltip="">5.2 Details</span></a></li></ul></li><li class="devsite-nav-item"><a href="#6_overall_structure_of_the_format" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="7" track-type="navigation" track-name="rightNav" track-metadata-position="7" track-metadata-link-destination="#6_overall_structure_of_the_format"><span class="devsite-nav-text" tooltip="">6 Overall Structure of the Format</span></a></li></ul></devsite-toc>
              <devsite-recommendations-sidebar class="nocontent devsite-nav recommendations-rendered"><div class="devsite-recommendations-sidebar-heading" role="heading" aria-level="2"><a href="#recommendations-link" class="devsite-nav-title devsite-recommendations-sidebar-heading-link" data-category="Site-Wide Custom Events" data-label="devsite-recommendation side-nav title" data-action="click" data-tooltip="See content recommendations"><svg class="devsite-recommendations-sidebar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.5,8.5L10,3L7.5,8.5L2,11l5.5,2.5L10,19l2.5-5.5L18,11L12.5,8.5z M18,13l-1.25,2.75L14,17l2.75,1.25L18,21l1.25-2.75 L22,17l-2.75-1.25L18,13z"></path></svg><span class="devsite-nav-text">Recommendations</span></a></div><ul class="devsite-nav-list"><li role="option" class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/riff_container?rec=ClNodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC93ZWJwL2RvY3Mvd2VicF9sb3NzbGVzc19iaXRzdHJlYW1fc3BlY2lmaWNhdGlvbhABGA0gAygDMAY6CDM5MzAwMzEw" class="devsite-nav-title devsite-recommendations-sidebar-title" data-category="Site-Wide Custom Events" data-label="devsite-recommendation side-nav link" data-action="click"><span class="devsite-nav-text" tooltip="">WebP Container Specification</span></a><div class="significatio-card-meta">Updated <span class="significatio-date" date="1629102580">Aug 16, 2021</span></div></li><li role="option" class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/compression?rec=ClNodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC93ZWJwL2RvY3Mvd2VicF9sb3NzbGVzc19iaXRzdHJlYW1fc3BlY2lmaWNhdGlvbhACGA0gAygCMAY6CDM5MzAwMzEw" class="devsite-nav-title devsite-recommendations-sidebar-title" data-category="Site-Wide Custom Events" data-label="devsite-recommendation side-nav link" data-action="click"><span class="devsite-nav-text" tooltip="">Compression Techniques</span></a><div class="significatio-card-meta">Updated <span class="significatio-date" date="1629102580">Aug 16, 2021</span></div></li><li role="option" class="devsite-nav-item"><a href="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study?rec=ClNodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC93ZWJwL2RvY3Mvd2VicF9sb3NzbGVzc19iaXRzdHJlYW1fc3BlY2lmaWNhdGlvbhADGA0gAygGMAY6CDM5MzAwMzEw" class="devsite-nav-title devsite-recommendations-sidebar-title" data-category="Site-Wide Custom Events" data-label="devsite-recommendation side-nav link" data-action="click"><span class="devsite-nav-text" tooltip="">Lossless and Transparency Encoding in WebP</span></a><div class="significatio-card-meta">Updated <span class="significatio-date" date="1629102580">Aug 16, 2021</span></div></li></ul></devsite-recommendations-sidebar>
            </div>
          </div>
          <devsite-content>
            
              

















<article class="devsite-article" has-bookmark="">
  
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list" aria-label="Breadcrumb">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
  <a href="https://developers.google.com/" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="1" track-type="globalNav" track-name="breadcrumb" track-metadata-position="1" track-metadata-eventdetail="">
    
        Home
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://developers.google.com/products" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="2" track-type="globalNav" track-name="breadcrumb" track-metadata-position="2" track-metadata-eventdetail="">
    
        Products
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://developers.google.com/speed" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="3" track-type="globalNav" track-name="breadcrumb" track-metadata-position="3" track-metadata-eventdetail="Make the Web Faster">
    
        Make the Web Faster
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://developers.google.com/speed/webp" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="4" track-type="globalNav" track-name="breadcrumb" track-metadata-position="4" track-metadata-eventdetail="WebP">
    
        WebP
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://developers.google.com/speed/webp/faq" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="5" track-type="globalNav" track-name="breadcrumb" track-metadata-position="5" track-metadata-eventdetail="">
    
        Reference
      
  </a>
  
    
  </li>
  
</ul>
    
      
    <devsite-thumb-rating position="header"><div class="devsite-thumb-rating" role="form" aria-labelledby="devsite-thumb-label-header" tabindex="0"><div class="devsite-thumb-label" id="devsite-thumb-label-header">Was this helpful?</div><div class="devsite-thumbs"><button class="devsite-thumb devsite-thumb-up" data-title="Helpful" aria-label="Helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21,7h-6.31l0.95-4.57l0.03-0.32c0-0.41-0.17-0.79-0.44-1.06L14.17,0c0,0-7.09,6.85-7.17,7H2v13h16 c0.83,0,1.54-0.5,1.84-1.22l3.02-7.05C22.95,11.5,23,11.26,23,11V9C23,7.9,22.1,7,21,7z M7,18H4V9h3V18z M21,11l-3,7H9V8l4.34-4.34 L12,9h9V11z"></path></svg></button><button class="devsite-thumb devsite-thumb-down" data-title="Not helpful" aria-label="Not helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3,17h6.31l-0.95,4.57l-0.03,0.32c0,0.41,0.17,0.79,0.44,1.06L9.83,24c0,0,7.09-6.85,7.17-7h5V4H6 C5.17,4,4.46,4.5,4.16,5.22l-3.02,7.05C1.05,12.5,1,12.74,1,13v2C1,16.1,1.9,17,3,17z M17,6h3v9h-3V6z M3,13l3-7h9v10l-4.34,4.34 L12,15H3V13z"></path></svg></button></div></div></devsite-thumb-rating>
  
    
  </div>
  
  
    <h1 class="devsite-page-title">WebP Lossless Bitstream Specification</h1>
  
  <devsite-bookmark class="show" data-title="Add bookmark"><input type="checkbox" class="bookmark-checkbox" aria-label="Add bookmark"></devsite-bookmark>
  <devsite-toc class="devsite-nav devsite-toc-embedded" depth="2" devsite-toc-embedded="" expandable="" visible=""><ul class="devsite-nav-list"><li class="devsite-nav-item devsite-nav-heading devsite-toc-toggle" role="heading" aria-level="2"><span class="devsite-nav-title"><span class="devsite-nav-text">On this page</span></span><button type="button" title="Expand/collapse contents" class="devsite-nav-show-all button-transparent material-icons"></button></li><li class="devsite-nav-item" visible=""><a href="#abstract" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="0" track-type="navigation" track-name="embeddedNav" track-metadata-position="0" track-metadata-link-destination="#abstract"><span class="devsite-nav-text" tooltip="">Abstract</span></a></li><li class="devsite-nav-item" visible=""><a href="#nomenclature" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="1" track-type="navigation" track-name="embeddedNav" track-metadata-position="1" track-metadata-link-destination="#nomenclature"><span class="devsite-nav-text" tooltip="">Nomenclature</span></a></li><li class="devsite-nav-item" visible=""><a href="#1_introduction" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="2" track-type="navigation" track-name="embeddedNav" track-metadata-position="2" track-metadata-link-destination="#1_introduction"><span class="devsite-nav-text" tooltip="">1 Introduction</span></a></li><li class="devsite-nav-item" visible=""><a href="#2_riff_header" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="3" track-type="navigation" track-name="embeddedNav" track-metadata-position="3" track-metadata-link-destination="#2_riff_header"><span class="devsite-nav-text" tooltip="">2 RIFF Header</span></a></li><li class="devsite-nav-item" visible=""><a href="#3_transformations" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="4" track-type="navigation" track-name="embeddedNav" track-metadata-position="4" track-metadata-link-destination="#3_transformations"><span class="devsite-nav-text" tooltip="">3 Transformations</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#predictor_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="4.0" track-type="navigation" track-name="embeddedNav" track-metadata-position="4.0" track-metadata-link-destination="#predictor_transform"><span class="devsite-nav-text" tooltip="">Predictor Transform</span></a></li><li class="devsite-nav-item"><a href="#color_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="4.1" track-type="navigation" track-name="embeddedNav" track-metadata-position="4.1" track-metadata-link-destination="#color_transform"><span class="devsite-nav-text" tooltip="">Color Transform</span></a></li><li class="devsite-nav-item"><a href="#subtract_green_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="4.2" track-type="navigation" track-name="embeddedNav" track-metadata-position="4.2" track-metadata-link-destination="#subtract_green_transform"><span class="devsite-nav-text" tooltip="">Subtract Green Transform</span></a></li><li class="devsite-nav-item"><a href="#color_indexing_transform" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="4.3" track-type="navigation" track-name="embeddedNav" track-metadata-position="4.3" track-metadata-link-destination="#color_indexing_transform"><span class="devsite-nav-text" tooltip="">Color Indexing Transform</span></a></li></ul></li><li class="devsite-nav-item"><a href="#4_image_data" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="5" track-type="navigation" track-name="embeddedNav" track-metadata-position="5" track-metadata-link-destination="#4_image_data"><span class="devsite-nav-text" tooltip="">4 Image Data</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#41_roles_of_image_data" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="5.0" track-type="navigation" track-name="embeddedNav" track-metadata-position="5.0" track-metadata-link-destination="#41_roles_of_image_data"><span class="devsite-nav-text" tooltip="">4.1 Roles of Image Data</span></a></li><li class="devsite-nav-item"><a href="#42_encoding_of_image_data" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="5.1" track-type="navigation" track-name="embeddedNav" track-metadata-position="5.1" track-metadata-link-destination="#42_encoding_of_image_data"><span class="devsite-nav-text" tooltip="">4.2 Encoding of Image Data</span></a></li></ul></li><li class="devsite-nav-item"><a href="#5_entropy_code" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="6" track-type="navigation" track-name="embeddedNav" track-metadata-position="6" track-metadata-link-destination="#5_entropy_code"><span class="devsite-nav-text" tooltip="">5 Entropy Code</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#51_overview" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="6.0" track-type="navigation" track-name="embeddedNav" track-metadata-position="6.0" track-metadata-link-destination="#51_overview"><span class="devsite-nav-text" tooltip="">5.1 Overview</span></a></li><li class="devsite-nav-item"><a href="#52_details" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="6.1" track-type="navigation" track-name="embeddedNav" track-metadata-position="6.1" track-metadata-link-destination="#52_details"><span class="devsite-nav-text" tooltip="">5.2 Details</span></a></li></ul></li><li class="devsite-nav-item"><a href="#6_overall_structure_of_the_format" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="7" track-type="navigation" track-name="embeddedNav" track-metadata-position="7" track-metadata-link-destination="#6_overall_structure_of_the_format"><span class="devsite-nav-text" tooltip="">6 Overall Structure of the Format</span></a></li><li class="devsite-toc-toggle"><button type="button" class="button-flat devsite-nav-more-items material-icons" track-type="navigation" track-name="embeddedNavExpand" title="Expand/collapse contents"></button></li></ul></devsite-toc>

  
  <devsite-recommendations-dropdown class="nocontent"></devsite-recommendations-dropdown>
  

  <div class="devsite-article-body clearfix
    ">

    
      



















<p><em>Jyrki Alakuijala, Ph.D., Google, Inc., 2012-06-19</em></p>

<p>Paragraphs marked as [AMENDED] were amended on 2014-09-16.</p>

<h2 id="abstract" data-text="Abstract" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Abstract</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Abstract" data-title="Copy link to this section: Abstract" data-id="abstract"></button></h2>

<p>WebP lossless is an image format for lossless compression of ARGB
images. The lossless format stores and restores the pixel values
exactly, including the color values for zero alpha pixels. The
format uses subresolution images, recursively embedded into the format
itself, for storing statistical data about the images, such as the used
entropy codes, spatial predictors, color space conversion, and color
table. LZ77, Huffman coding, and a color cache are used for compression
of the bulk data. Decoding speeds faster than PNG have been
demonstrated, as well as 25% denser compression than can be achieved
using today's PNG format.</p>

<h2 id="nomenclature" data-text="Nomenclature" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Nomenclature</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Nomenclature" data-title="Copy link to this section: Nomenclature" data-id="nomenclature"></button></h2>

<dl>
<dt>ARGB</dt>
<dd>A pixel value consisting of alpha, red, green, and blue values.</dd>
<dt>ARGB image</dt>
<dd>A two-dimensional array containing ARGB pixels.</dd>
<dt>color cache</dt>
<dd>A small hash-addressed array to store recently used colors, to be able
to recall them with shorter codes.</dd>
<dt>color indexing image</dt>
<dd>A one-dimensional image of colors that can be indexed using a small
integer (up to 256 within WebP lossless).</dd>
<dt>color transform image</dt>
<dd>A two-dimensional subresolution image containing data about
correlations of color components.</dd>
<dt>distance mapping</dt>
<dd>Changes LZ77 distances to have the smallest values for pixels in 2D
proximity.</dd>
<dt>entropy image</dt>
<dd>A two-dimensional subresolution image indicating which entropy coding
should be used in a respective square in the image, i.e., each pixel
is a meta Huffman code.</dd>
<dt>Huffman code</dt>
<dd>A classic way to do entropy coding where a smaller number of bits are
used for more frequent codes.</dd>
<dt>LZ77</dt>
<dd>Dictionary-based sliding window compression algorithm that either
emits symbols or describes them as sequences of past symbols.</dd>
<dt>meta Huffman code</dt>
<dd>A small integer (up to 16 bits) that indexes an element in the meta
Huffman table.</dd>
<dt>predictor image</dt>
<dd>A two-dimensional subresolution image indicating which spatial
predictor is used for a particular square in the image.</dd>
<dt>prefix coding</dt>
<dd>A way to entropy code larger integers that codes a few bits of the
integer using an entropy code and codifies the remaining bits raw.
This allows for the descriptions of the entropy codes to remain
relatively small even when the range of symbols is large.</dd>
<dt>scan-line order</dt>
<dd>A processing order of pixels, left-to-right, top-to-bottom, starting
from the left-hand-top pixel, proceeding to the right. Once a row is
completed, continue from the left-hand column of the next row.</dd>
</dl>

<h2 id="1_introduction" data-text="1 Introduction" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">1 Introduction</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: 1 Introduction" data-title="Copy link to this section: 1 Introduction" data-id="1_introduction"></button></h2>

<p>This document describes the compressed data representation of a WebP
lossless image. It is intended as a detailed reference for WebP lossless
encoder and decoder implementation.</p>

<p>In this document, we extensively use C programming language syntax to
describe the bitstream, and assume the existence of a function for
reading bits, <code translate="no" dir="ltr">ReadBits(n)</code>. The bytes are read in the natural order of
the stream containing them, and bits of each byte are read in
least-significant-bit-first order. When multiple bits are read at the
same time, the integer is constructed from the original data in the
original order. The most significant bits of the returned integer are
also the most significant bits of the original data. Thus the statement</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">b </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln"><br></span></code></pre></devsite-code>
<p>is equivalent with the two statements below:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">b </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln"><br>b </span><span class="pun">|=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>We assume that each color component (e.g. alpha, red, blue and green) is
represented using an 8-bit byte. We define the corresponding type as
uint8. A whole ARGB pixel is represented by a type called uint32, an
unsigned integer consisting of 32 bits. In the code showing the behavior
of the transformations, alpha value is codified in bits 31..24, red in
bits 23..16, green in bits 15..8 and blue in bits 7..0, but
implementations of the format are free to use another representation
internally.</p>

<p>Broadly, a WebP lossless image contains header data, transform
information and actual image data. Headers contain width and height of
the image. A WebP lossless image can go through four different types of
transformation before being entropy encoded. The transform information
in the bitstream contains the data required to apply the respective
inverse transforms.</p>

<h2 id="2_riff_header" data-text="2 RIFF Header" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">2 RIFF Header</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: 2 RIFF Header" data-title="Copy link to this section: 2 RIFF Header" data-id="2_riff_header"></button></h2>

<p>The beginning of the header has the RIFF container. This consists of the
following 21 bytes:</p>

<ol>
<li>String "RIFF"</li>
<li>A little-endian 32 bit value of the block length, the whole size
  of the block controlled by the RIFF header. Normally this equals
  the payload size (file size minus 8 bytes: 4 bytes for the 'RIFF'
  identifier and 4 bytes for storing the value itself).</li>
<li>String "WEBP" (RIFF container name).</li>
<li>String "VP8L" (chunk tag for lossless encoded image data).</li>
<li>A little-endian 32-bit value of the number of bytes in the
  lossless stream.</li>
<li>One byte signature 0x2f.</li>
</ol>

<p>The first 28 bits of the bitstream specify the width and height of the
image. Width and height are decoded as 14-bit integers as follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> image_width </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">14</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> image_height </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">14</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The 14-bit dynamics for image size limit the maximum size of a WebP
lossless image to 16384✕16384 pixels.</p>

<p>The alpha_is_used bit is a hint only, and should not impact decoding.
It should be set to 0 when all alpha values are 255 in the picture, and
1 otherwise.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> alpha_is_used </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The version_number is a 3 bit code that must be set to 0. Any other value
should be treated as an error. [AMENDED]</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> version_number </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">3</span><span class="pun">);</span><span class="pln"><br></span></code></pre></devsite-code>
<h2 id="3_transformations" data-text="3 Transformations" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">3 Transformations</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: 3 Transformations" data-title="Copy link to this section: 3 Transformations" data-id="3_transformations"></button></h2>

<p>Transformations are reversible manipulations of the image data that can
reduce the remaining symbolic entropy by modeling spatial and color
correlations. Transformations can make the final compression more dense.</p>

<p>An image can go through four types of transformation. A 1 bit indicates
the presence of a transform. Each transform is allowed to be used only
once. The transformations are used only for the main level ARGB image:
the subresolution images have no transforms, not even the 0 bit
indicating the end-of-transforms.</p>

<p>Typically an encoder would use these transforms to reduce the Shannon
entropy in the residual image. Also, the transform data can be decided
based on entropy minimization.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> &nbsp;</span><span class="com">// Transform present.</span><span class="pln"><br>&nbsp; </span><span class="com">// Decode transform type.</span><span class="pln"><br>&nbsp; </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">TransformType</span><span class="pln"> transform_type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="com">// Decode transform data.</span><span class="pln"><br>&nbsp; </span><span class="pun">...</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br></span><span class="com">// Decode actual image data (Section 4).</span><span class="pln"><br></span></code></pre></devsite-code>
<p>If a transform is present then the next two bits specify the transform
type. There are four types of transforms.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">enum</span><span class="pln"> </span><span class="typ">TransformType</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; PREDICTOR_TRANSFORM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"><br>&nbsp; COLOR_TRANSFORM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"><br>&nbsp; SUBTRACT_GREEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"><br>&nbsp; COLOR_INDEXING_TRANSFORM &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The transform type is followed by the transform data. Transform data
contains the information required to apply the inverse transform and
depends on the transform type. Next we describe the transform data for
different types.</p>

<h3 id="predictor_transform" data-text="Predictor Transform" role="presentation"><span class="devsite-heading" role="heading" aria-level="3">Predictor Transform</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Predictor Transform" data-title="Copy link to this section: Predictor Transform" data-id="predictor_transform"></button></h3>

<p>The predictor transform can be used to reduce entropy by exploiting the
fact that neighboring pixels are often correlated. In the predictor
transform, the current pixel value is predicted from the pixels already
decoded (in scan-line order) and only the residual value (actual -
predicted) is encoded. The <em>prediction mode</em> determines the type of
prediction to use. We divide the image into squares and all the pixels
in a square use same prediction mode.</p>

<p>The first 3 bits of prediction data define the block width and height in
number of bits. The number of block columns, <code translate="no" dir="ltr">block_xsize</code>, is used in
indexing two-dimensionally.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> size_bits </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> block_width </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> size_bits</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> block_height </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> size_bits</span><span class="pun">);</span><span class="pln"><br></span><span class="com">#define</span><span class="pln"> DIV_ROUND_UP</span><span class="pun">(</span><span class="pln">num</span><span class="pun">,</span><span class="pln"> den</span><span class="pun">)</span><span class="pln"> </span><span class="pun">((</span><span class="pln">num</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">den</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">den</span><span class="pun">))</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> block_xsize </span><span class="pun">=</span><span class="pln"> DIV_ROUND_UP</span><span class="pun">(</span><span class="pln">image_width</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> size_bits</span><span class="pun">);</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The transform data contains the prediction mode for each block of the
image. All the <code translate="no" dir="ltr">block_width * block_height</code> pixels of a block use same
prediction mode. The prediction modes are treated as pixels of an image
and encoded using the same techniques described in
<a href="#4_image_data">Chapter 4</a>.</p>

<p>For a pixel <em>x, y</em>, one can compute the respective filter block address
by:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> block_index </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">&gt;&gt;</span><span class="pln"> size_bits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> block_xsize </span><span class="pun">+</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> size_bits</span><span class="pun">);</span><span class="pln"><br></span></code></pre></devsite-code>
<p>There are 14 different prediction modes. In each prediction mode, the
current pixel value is predicted from one or more neighboring pixels
whose values are already known.</p>

<p>We choose the neighboring pixels (TL, T, TR, and L) of the current pixel
(P) as follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O<br>O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O<br>O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;TL &nbsp; T &nbsp; &nbsp;TR &nbsp; O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O<br>O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;O &nbsp; &nbsp;L &nbsp; &nbsp;P &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X<br>X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X<br>X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X &nbsp; &nbsp;X<br></span></code></pre></devsite-code>
<p>where TL means top-left, T top, TR top-right, L left pixel.
At the time of predicting a value for P, all pixels O, TL, T, TR and L
have been already processed, and pixel P and all pixels X are unknown.</p>

<p>Given the above neighboring pixels, the different prediction modes are
defined as follows.</p>

<div class="devsite-table-wrapper"><table>
<thead>
<tr>
<th>Mode</th>
<th>Predicted value of each channel of the current pixel</th>
</tr>
</thead>

<tbody>
<tr>
<td>0</td>
<td>0xff000000 (represents solid black color in ARGB)</td>
</tr>
<tr>
<td>1</td>
<td>L</td>
</tr>
<tr>
<td>2</td>
<td>T</td>
</tr>
<tr>
<td>3</td>
<td>TR</td>
</tr>
<tr>
<td>4</td>
<td>TL</td>
</tr>
<tr>
<td>5</td>
<td>Average2(Average2(L, TR), T)</td>
</tr>
<tr>
<td>6</td>
<td>Average2(L, TL)</td>
</tr>
<tr>
<td>7</td>
<td>Average2(L, T)</td>
</tr>
<tr>
<td>8</td>
<td>Average2(TL, T)</td>
</tr>
<tr>
<td>9</td>
<td>Average2(T, TR)</td>
</tr>
<tr>
<td>10</td>
<td>Average2(Average2(L, TL), Average2(T, TR))</td>
</tr>
<tr>
<td>11</td>
<td>Select(L, T, TL)</td>
</tr>
<tr>
<td>12</td>
<td>ClampAddSubtractFull(L, T, TL)</td>
</tr>
<tr>
<td>13</td>
<td>ClampAddSubtractHalf(Average2(L, T), TL)</td>
</tr>
</tbody>
</table></div>

<p><code translate="no" dir="ltr">Average2</code> is defined as follows for each ARGB component:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">uint8 </span><span class="typ">Average2</span><span class="pun">(</span><span class="pln">uint8 a</span><span class="pun">,</span><span class="pln"> uint8 b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">+</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The Select predictor is defined as follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">uint32 </span><span class="typ">Select</span><span class="pun">(</span><span class="pln">uint32 L</span><span class="pun">,</span><span class="pln"> uint32 T</span><span class="pun">,</span><span class="pln"> uint32 TL</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// L = left pixel, T = top pixel, TL = top left pixel.</span><span class="pln"><br><br>&nbsp; </span><span class="com">// ARGB component estimates for prediction.</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> pAlpha </span><span class="pun">=</span><span class="pln"> ALPHA</span><span class="pun">(</span><span class="pln">L</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> ALPHA</span><span class="pun">(</span><span class="pln">T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> ALPHA</span><span class="pun">(</span><span class="pln">TL</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> pRed </span><span class="pun">=</span><span class="pln"> RED</span><span class="pun">(</span><span class="pln">L</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> RED</span><span class="pun">(</span><span class="pln">T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> RED</span><span class="pun">(</span><span class="pln">TL</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> pGreen </span><span class="pun">=</span><span class="pln"> GREEN</span><span class="pun">(</span><span class="pln">L</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> GREEN</span><span class="pun">(</span><span class="pln">T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> GREEN</span><span class="pun">(</span><span class="pln">TL</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> pBlue </span><span class="pun">=</span><span class="pln"> BLUE</span><span class="pun">(</span><span class="pln">L</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> BLUE</span><span class="pun">(</span><span class="pln">T</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> BLUE</span><span class="pun">(</span><span class="pln">TL</span><span class="pun">);</span><span class="pln"><br><br>&nbsp; </span><span class="com">// Manhattan distances to estimates for left and top pixels.</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> pL </span><span class="pun">=</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">pAlpha </span><span class="pun">-</span><span class="pln"> ALPHA</span><span class="pun">(</span><span class="pln">L</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">pRed </span><span class="pun">-</span><span class="pln"> RED</span><span class="pun">(</span><span class="pln">L</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;abs</span><span class="pun">(</span><span class="pln">pGreen </span><span class="pun">-</span><span class="pln"> GREEN</span><span class="pun">(</span><span class="pln">L</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">pBlue </span><span class="pun">-</span><span class="pln"> BLUE</span><span class="pun">(</span><span class="pln">L</span><span class="pun">));</span><span class="pln"><br>&nbsp; </span><span class="kwd">int</span><span class="pln"> pT </span><span class="pun">=</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">pAlpha </span><span class="pun">-</span><span class="pln"> ALPHA</span><span class="pun">(</span><span class="pln">T</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">pRed </span><span class="pun">-</span><span class="pln"> RED</span><span class="pun">(</span><span class="pln">T</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;abs</span><span class="pun">(</span><span class="pln">pGreen </span><span class="pun">-</span><span class="pln"> GREEN</span><span class="pun">(</span><span class="pln">T</span><span class="pun">))</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">pBlue </span><span class="pun">-</span><span class="pln"> BLUE</span><span class="pun">(</span><span class="pln">T</span><span class="pun">));</span><span class="pln"><br><br>&nbsp; </span><span class="com">// Return either left or top, the one closer to the prediction.</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">pL </span><span class="pun">&lt;</span><span class="pln"> pT</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> &nbsp; &nbsp; </span><span class="com">// [AMENDED]</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> L</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> T</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The functions <code translate="no" dir="ltr">ClampAddSubtractFull</code> and <code translate="no" dir="ltr">ClampAddSubtractHalf</code> are
performed for each ARGB component as follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com">// Clamp the input value between 0 and 255.</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> </span><span class="typ">Clamp</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">255</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> &nbsp;</span><span class="lit">255</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> a</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br></span><span class="kwd">int</span><span class="pln"> </span><span class="typ">ClampAddSubtractFull</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Clamp</span><span class="pun">(</span><span class="pln">a </span><span class="pun">+</span><span class="pln"> b </span><span class="pun">-</span><span class="pln"> c</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br><br></span><span class="kwd">int</span><span class="pln"> </span><span class="typ">ClampAddSubtractHalf</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Clamp</span><span class="pun">(</span><span class="pln">a </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">-</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p>There are special handling rules for some border pixels. If there is a
prediction transform, regardless of the mode [0..13] for these pixels,
the predicted value for the left-topmost pixel of the image is
0xff000000, L-pixel for all pixels on the top row, and T-pixel for all
pixels on the leftmost column.</p>

<p>Addressing the TR-pixel for pixels on the rightmost column is
exceptional. The pixels on the rightmost column are predicted by using
the modes [0..13] just like pixels not on border, but by using the
leftmost pixel on the same row as the current TR-pixel. The TR-pixel
offset in memory is the same for border and non-border pixels.</p>

<h3 id="color_transform" data-text="Color Transform" role="presentation"><span class="devsite-heading" role="heading" aria-level="3">Color Transform</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Color Transform" data-title="Copy link to this section: Color Transform" data-id="color_transform"></button></h3>

<p>The goal of the color transform is to decorrelate the R, G and B values
of each pixel. Color transform keeps the green (G) value as it is,
transforms red (R) based on green and transforms blue (B) based on green
and then based on red.</p>

<p>As is the case for the predictor transform, first the image is divided
into blocks and the same transform mode is used for all the pixels in a
block. For each block there are three types of color transform elements.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">typedef</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; uint8 green_to_red</span><span class="pun">;</span><span class="pln"><br>&nbsp; uint8 green_to_blue</span><span class="pun">;</span><span class="pln"><br>&nbsp; uint8 red_to_blue</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="typ">ColorTransformElement</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The actual color transformation is done by defining a color transform
delta. The color transform delta depends on the <code translate="no" dir="ltr">ColorTransformElement</code>,
which is the same for all the pixels in a particular block. The delta is
added during color transform. The inverse color transform then is just
subtracting those deltas.</p>

<p>The color transform function is defined as follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">void</span><span class="pln"> </span><span class="typ">ColorTransform</span><span class="pun">(</span><span class="pln">uint8 red</span><span class="pun">,</span><span class="pln"> uint8 blue</span><span class="pun">,</span><span class="pln"> uint8 green</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">ColorTransformElement</span><span class="pln"> </span><span class="pun">*</span><span class="pln">trans</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; uint8 </span><span class="pun">*</span><span class="pln">new_red</span><span class="pun">,</span><span class="pln"> uint8 </span><span class="pun">*</span><span class="pln">new_blue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Transformed values of red and blue components</span><span class="pln"><br>&nbsp; uint32 tmp_red </span><span class="pun">=</span><span class="pln"> red</span><span class="pun">;</span><span class="pln"><br>&nbsp; uint32 tmp_blue </span><span class="pun">=</span><span class="pln"> blue</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; </span><span class="com">// Applying transform is just adding the transform deltas</span><span class="pln"><br>&nbsp; tmp_red &nbsp;</span><span class="pun">+=</span><span class="pln"> </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">trans</span><span class="pun">-&gt;</span><span class="pln">green_to_red</span><span class="pun">,</span><span class="pln"> green</span><span class="pun">);</span><span class="pln"><br>&nbsp; tmp_blue </span><span class="pun">+=</span><span class="pln"> </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">trans</span><span class="pun">-&gt;</span><span class="pln">green_to_blue</span><span class="pun">,</span><span class="pln"> green</span><span class="pun">);</span><span class="pln"><br>&nbsp; tmp_blue </span><span class="pun">+=</span><span class="pln"> </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">trans</span><span class="pun">-&gt;</span><span class="pln">red_to_blue</span><span class="pun">,</span><span class="pln"> red</span><span class="pun">);</span><span class="pln"><br><br>&nbsp; </span><span class="pun">*</span><span class="pln">new_red </span><span class="pun">=</span><span class="pln"> tmp_red </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">*</span><span class="pln">new_blue </span><span class="pun">=</span><span class="pln"> tmp_blue </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p><code translate="no" dir="ltr">ColorTransformDelta</code> is computed using a signed 8-bit integer
representing a 3.5-fixed-point number, and a signed 8-bit RGB color
channel (c) [-128..127] and is defined as follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">int8 </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">int8 t</span><span class="pun">,</span><span class="pln"> int8 c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t </span><span class="pun">*</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p>A conversion from the 8-bit unsigned representation (<code translate="no" dir="ltr">uint8</code>) to the 8-bit
signed one (<code translate="no" dir="ltr">int8</code>) is required before calling ColorTransformDelta().
It should be performed using 8-bit two's complement (that is: <code translate="no" dir="ltr">uint8</code> range
[128-255] is mapped to the [-128, -1] range of its converted <code translate="no" dir="ltr">int8</code> value).</p>

<p>The multiplication is to be done using more precision (with at least
16-bit dynamics). The sign extension property of the shift operation
does not matter here: only the lowest 8 bits are used from the result,
and there the sign extension shifting and unsigned shifting are
consistent with each other.</p>

<p>Now we describe the contents of color transform data so that decoding
can apply the inverse color transform and recover the original red and
blue values. The first 3 bits of the color transform data contain the
width and height of the image block in number of bits, just like the
predictor transform:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> size_bits </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> block_width </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> size_bits</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> block_height </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> size_bits</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The remaining part of the color transform data contains
<code translate="no" dir="ltr">ColorTransformElement</code> instances corresponding to each block of the
image. <code translate="no" dir="ltr">ColorTransformElement</code> instances are treated as pixels of an
image and encoded using the methods described in
<a href="#4_image_data">Chapter 4</a>.</p>

<p>During decoding, <code translate="no" dir="ltr">ColorTransformElement</code> instances of the blocks are
decoded and the inverse color transform is applied on the ARGB values of
the pixels. As mentioned earlier, that inverse color transform is just
subtracting <code translate="no" dir="ltr">ColorTransformElement</code> values from the red and blue
channels.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">void</span><span class="pln"> </span><span class="typ">InverseTransform</span><span class="pun">(</span><span class="pln">uint8 red</span><span class="pun">,</span><span class="pln"> uint8 green</span><span class="pun">,</span><span class="pln"> uint8 blue</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">ColorTransformElement</span><span class="pln"> </span><span class="pun">*</span><span class="pln">p</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; uint8 </span><span class="pun">*</span><span class="pln">new_red</span><span class="pun">,</span><span class="pln"> uint8 </span><span class="pun">*</span><span class="pln">new_blue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="com">// Applying inverse transform is just subtracting the</span><span class="pln"><br>&nbsp; </span><span class="com">// color transform deltas</span><span class="pln"><br>&nbsp; red &nbsp;</span><span class="pun">-=</span><span class="pln"> </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">p</span><span class="pun">-&gt;</span><span class="pln">green_to_red_</span><span class="pun">,</span><span class="pln"> &nbsp;green</span><span class="pun">);</span><span class="pln"><br>&nbsp; blue </span><span class="pun">-=</span><span class="pln"> </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">p</span><span class="pun">-&gt;</span><span class="pln">green_to_blue_</span><span class="pun">,</span><span class="pln"> green</span><span class="pun">);</span><span class="pln"><br>&nbsp; blue </span><span class="pun">-=</span><span class="pln"> </span><span class="typ">ColorTransformDelta</span><span class="pun">(</span><span class="pln">p</span><span class="pun">-&gt;</span><span class="pln">red_to_blue_</span><span class="pun">,</span><span class="pln"> red </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">);</span><span class="pln"><br><br>&nbsp; </span><span class="pun">*</span><span class="pln">new_red </span><span class="pun">=</span><span class="pln"> red </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">*</span><span class="pln">new_blue </span><span class="pun">=</span><span class="pln"> blue </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<h3 id="subtract_green_transform" data-text="Subtract Green Transform" role="presentation"><span class="devsite-heading" role="heading" aria-level="3">Subtract Green Transform</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Subtract Green Transform" data-title="Copy link to this section: Subtract Green Transform" data-id="subtract_green_transform"></button></h3>

<p>The subtract green transform subtracts green values from red and blue
values of each pixel. When this transform is present, the decoder needs
to add the green value to both red and blue. There is no data associated
with this transform. The decoder applies the inverse transform as
follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">void</span><span class="pln"> </span><span class="typ">AddGreenToBlueAndRed</span><span class="pun">(</span><span class="pln">uint8 green</span><span class="pun">,</span><span class="pln"> uint8 </span><span class="pun">*</span><span class="pln">red</span><span class="pun">,</span><span class="pln"> uint8 </span><span class="pun">*</span><span class="pln">blue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="pun">*</span><span class="pln">red &nbsp;</span><span class="pun">=</span><span class="pln"> </span><span class="pun">(*</span><span class="pln">red &nbsp;</span><span class="pun">+</span><span class="pln"> green</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"><br>&nbsp; </span><span class="pun">*</span><span class="pln">blue </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(*</span><span class="pln">blue </span><span class="pun">+</span><span class="pln"> green</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xff</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p>This transform is redundant as it can be modeled using the color
transform, but it is still often useful. Since it can extend the
dynamics of the color transform and there is no additional data here,
the subtract green transform can be coded using fewer bits than a
full-blown color transform.</p>

<h3 id="color_indexing_transform" data-text="Color Indexing Transform" role="presentation"><span class="devsite-heading" role="heading" aria-level="3">Color Indexing Transform</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Color Indexing Transform" data-title="Copy link to this section: Color Indexing Transform" data-id="color_indexing_transform"></button></h3>

<p>If there are not many unique pixel values, it may be more efficient to
create a color index array and replace the pixel values by the array's
indices. The color indexing transform achieves this. (In the context of
WebP lossless, we specifically do not call this a palette transform
because a similar but more dynamic concept exists in WebP lossless
encoding: color cache.)</p>

<p>The color indexing transform checks for the number of unique ARGB values
in the image. If that number is below a threshold (256), it creates an
array of those ARGB values, which is then used to replace the pixel
values with the corresponding index: the green channel of the pixels are
replaced with the index; all alpha values are set to 255; all red and
blue values to 0.</p>

<p>The transform data contains color table size and the entries in the
color table. The decoder reads the color indexing transform data as
follows:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com">// 8 bit value for color table size</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> color_table_size </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The color table is stored using the image storage format itself. The
color table can be obtained by reading an image, without the RIFF
header, image size, and transforms, assuming a height of one pixel and
a width of <code translate="no" dir="ltr">color_table_size</code>. The color table is always
subtraction-coded to reduce image entropy. The deltas of palette colors
contain typically much less entropy than the colors themselves, leading
to significant savings for smaller images. In decoding, every final
color in the color table can be obtained by adding the previous color
component values by each ARGB component separately, and storing the
least significant 8 bits of the result.</p>

<p>The inverse transform for the image is simply replacing the pixel values
(which are indices to the color table) with the actual color table
values. The indexing is done based on the green component of the ARGB
color.</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com">// Inverse transform</span><span class="pln"><br>argb </span><span class="pun">=</span><span class="pln"> color_table</span><span class="pun">[</span><span class="pln">GREEN</span><span class="pun">(</span><span class="pln">argb</span><span class="pun">)];</span><span class="pln"><br></span></code></pre></devsite-code>
<p>If the index is equal or larger than color_table_size, the argb color value
should be set to 0x00000000 (transparent black).  [AMENDED]</p>

<p>When the color table is small (equal to or less than 16 colors), several
pixels are bundled into a single pixel. The pixel bundling packs several
(2, 4, or 8) pixels into a single pixel, reducing the image width
respectively. Pixel bundling allows for a more efficient joint
distribution entropy coding of neighboring pixels, and gives some
arithmetic coding-like benefits to the entropy code, but it can only be
used when there are a small number of unique values.</p>

<p><code translate="no" dir="ltr">color_table_size</code> specifies how many pixels are combined together:</p>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> width_bits</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">color_table_size </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; width_bits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">color_table_size </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; width_bits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">color_table_size </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">16</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; width_bits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; width_bits </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p><code translate="no" dir="ltr">width_bits</code> has a value of 0, 1, 2 or 3. A value of 0 indicates no
pixel bundling to be done for the image. A value of 1 indicates that two
pixels are combined together, and each pixel has a range of [0..15]. A
value of 2 indicates that four pixels are combined together, and each
pixel has a range of [0..3]. A value of 3 indicates that eight pixels
are combined together and each pixel has a range of [0..1], i.e., a
binary value.</p>

<p>The values are packed into the green component as follows:</p>

<ul>
<li><code translate="no" dir="ltr">width_bits</code> = 1: for every x value where x ≡ 0 (mod 2), a green
value at x is positioned into the 4 least-significant bits of the
green value at x / 2, a green value at x + 1 is positioned into the
4 most-significant bits of the green value at x / 2.</li>
<li><code translate="no" dir="ltr">width_bits</code> = 2: for every x value where x ≡ 0 (mod 4), a green
value at x is positioned into the 2 least-significant bits of the
green value at x / 4, green values at x + 1 to x + 3 in order to the
more significant bits of the green value at x / 4.</li>
<li><code translate="no" dir="ltr">width_bits</code> = 3: for every x value where x ≡ 0 (mod 8), a green
value at x is positioned into the least-significant bit of the green
value at x / 8, green values at x + 1 to x + 7 in order to the more
significant bits of the green value at x / 8.</li>
</ul>

<h2 id="4_image_data" data-text="4 Image Data" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">4 Image Data</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: 4 Image Data" data-title="Copy link to this section: 4 Image Data" data-id="4_image_data"></button></h2>

<p>Image data is an array of pixel values in scan-line order.</p>

<h3 id="41_roles_of_image_data" data-text="4.1 Roles of Image Data" role="presentation"><span class="devsite-heading" role="heading" aria-level="3">4.<wbr>1 Roles of Image Data</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: 4.1 Roles of Image Data" data-title="Copy link to this section: 4.1 Roles of Image Data" data-id="41_roles_of_image_data"></button></h3>

<p>We use image data in five different roles:</p>

<ol>
<li><p>ARGB image: Stores the actual pixels of the image.</p></li>
<li><p>Entropy image: Stores the
 <a href="#521_decoding_of_meta_huffman_codes">meta Huffman codes</a>. The red and
 green components of a pixel define the meta Huffman code used in a
 particular block of the ARGB image.</p></li>
<li><p>Predictor image: Stores the metadata for
 <a href="#predictor_transform">Predictor Transform</a>. The green component of a
 pixel defines which of the 14 predictors is used within a particular
 block of the ARGB image.</p></li>
<li><p>Color transform image. It is created by <code translate="no" dir="ltr">ColorTransformElement</code> values
 (defined in <a href="#color_transform">Color Transform</a>) for different blocks of
 the image. Each <code translate="no" dir="ltr">ColorTransformElement</code> <code translate="no" dir="ltr">'cte'</code> is treated as a pixel
 whose alpha component is <code translate="no" dir="ltr">255</code>, red component is <code translate="no" dir="ltr">cte.red_to_blue</code>, green
 component is <code translate="no" dir="ltr">cte.green_to_blue</code> and blue component is
 <code translate="no" dir="ltr">cte.green_to_red</code>.</p></li>
<li><p>Color indexing image: An array of of size <code translate="no" dir="ltr">color_table_size</code> (up to 256
 ARGB values) storing the metadata for the
 <a href="#color_indexing_transform">Color Indexing Transform</a>. This is stored as
 an image of width <code translate="no" dir="ltr">color_table_size</code> and height <code translate="no" dir="ltr">1</code>.</p></li>
</ol>

<h3 id="42_encoding_of_image_data" data-text="4.2 Encoding of Image Data">4.<wbr>2 Encoding of Image Data</h3>

<p>The encoding of image data is independent of its role.</p>

<p>The image is first divided into a set of fixed-size blocks (typically 16x16
blocks). Each of these blocks are modeled using their own entropy codes. Also,
several blocks may share the same entropy codes.</p>

<p><strong>Rationale:</strong> Storing an entropy code incurs a cost. This cost can be
minimized if statistically similar blocks share an entropy code, thereby
storing that code only once. For example, an encoder can find similar blocks
by clustering them using their statistical properties, or by repeatedly
joining a pair of randomly selected clusters when it reduces the overall
amount of bits needed to encode the image.</p>

<p>Each pixel is encoded using one of the three possible methods:</p>

<ol>
<li><p>Huffman coded literal: each channel (green, red, blue and alpha) is
 entropy-coded independently;</p></li>
<li><p>LZ77 backward reference: a sequence of pixels are copied from elsewhere
 in the image; or</p></li>
<li><p>Color cache code: using a short multiplicative hash code (color cache
 index) of a recently seen color.</p></li>
</ol>

<p>The following sub-sections describe each of these in detail.</p>

<h4 id="421_huffman_coded_literals" data-text="4.2.1 Huffman Coded Literals">4.<wbr>2.<wbr>1 Huffman Coded Literals</h4>

<p>The pixel is stored as Huffman coded values of green, red, blue and alpha (in
that order). See <a href="#522_decoding_entropy-coded_image_data">this section</a> for
details.</p>

<h4 id="422_lz77_backward_reference" data-text="4.2.2 LZ77 Backward Reference">4.2.2 LZ77 Backward Reference</h4>

<p>Backward references are tuples of <em>length</em> and <em>distance code</em>:</p>

<ul>
<li>Length indicates how many pixels in scan-line order are to be copied.</li>
<li>Distance code is a number indicating the position of a previously seen
pixel, from which the pixels are to be copied. The exact mapping is
described <a href="#distance-mapping">below</a>.</li>
</ul>

<p>The length and distance values are stored using <strong>LZ77 prefix coding</strong>.</p>

<p>LZ77 prefix coding divides large integer values into two parts: the <em>prefix
code</em> and the <em>extra bits</em>: the prefix code is stored using an entropy code,
while the extra bits are stored as they are (without an entropy code).</p>

<p><strong>Rationale</strong>: This approach reduces the storage requirement for the entropy
code. Also, large values are usually rare, and so extra bits would be used for
very few values in the image. Thus, this approach results in a better
compression overall.</p>

<p>The following table denotes the prefix codes and extra bits used for storing
different range of values.</p>
<aside class="note"><strong>Note:</strong><span> The maximum backward reference length is limited to 4096. Hence, only
the first 24 prefix codes (with the respective extra bits) are meaningful for
length values. For distance values, however, all the 40 prefix codes are
valid.</span></aside>
<div class="devsite-table-wrapper"><table>
<thead>
<tr>
<th>Value range</th>
<th>Prefix code</th>
<th>Extra bits</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>5..6</td>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>7..8</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>9..12</td>
<td>6</td>
<td>2</td>
</tr>
<tr>
<td>13..16</td>
<td>7</td>
<td>2</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>3072..4096</td>
<td>23</td>
<td>10</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>524289..786432</td>
<td>38</td>
<td>18</td>
</tr>
<tr>
<td>786433..1048576</td>
<td>39</td>
<td>18</td>
</tr>
</tbody>
</table></div>

<p>The pseudocode to obtain a (length or distance) value from the prefix code is
as follows:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prefix_code </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> prefix_code </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> extra_bits </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prefix_code </span><span class="pun">-</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> offset </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">prefix_code </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> extra_bits</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">return</span><span class="pln"> offset </span><span class="pun">+</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="pln">extra_bits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p id="distance-mapping"><strong>Distance Mapping:</strong>
</p>

<p>As noted previously, distance code is a number indicating the position of a
previously seen pixel, from which the pixels are to be copied. This
sub-section defines the mapping between a distance code and the position of a
previous pixel.</p>

<p>The distance codes larger than 120 denote the pixel-distance in scan-line
order, offset by 120.</p>

<p>The smallest distance codes [1..120] are special, and are reserved for a close
neighborhood of the current pixel. This neighborhood consists of 120 pixels:</p>

<ul>
<li><p>Pixels that are 1 to 7 rows above the current pixel, and are up to 8
columns to the left or up to 7 columns to the right of the current pixel.
[Total such pixels = <code translate="no" dir="ltr">7 * (8 + 1 + 7) = 112</code>].</p></li>
<li><p>Pixels that are in same row as the current pixel, and are up to 8 columns
to the left of the current pixel. [<code translate="no" dir="ltr">8</code> such pixels].</p></li>
</ul>

<p>The mapping between distance code <code translate="no" dir="ltr">i</code> and the neighboring pixel offset
<code translate="no" dir="ltr">(xi, yi)</code> is as follows:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"><br></span><span class="pun">(-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">),</span><span class="pln"> </span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">),</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<p>For example, distance code <code translate="no" dir="ltr">1</code> indicates offset of <code translate="no" dir="ltr">(0, 1)</code> for the
neighboring pixel, that is, the pixel above the current pixel (0-pixel
difference in X-direction and 1 pixel difference in Y-direction). Similarly,
distance code <code translate="no" dir="ltr">3</code> indicates left-top pixel.</p>

<p>The decoder can convert a distances code 'i' to a scan-line order distance
'dist' as follows:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pun">(</span><span class="pln">xi</span><span class="pun">,</span><span class="pln"> yi</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> distance_map</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"><br>dist </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> y </span><span class="pun">*</span><span class="pln"> xsize<br></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">dist </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; dist </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p>where 'distance_map' is the mapping noted above and <code translate="no" dir="ltr">xsize</code> is the width of
the image in pixels.</p>

<h4 id="423_color_cache_coding" data-text="4.2.3 Color Cache Coding">4.2.3 Color Cache Coding</h4>

<p>Color cache stores a set of colors that have been recently used in the image.</p>

<p><strong>Rationale:</strong> This way, the recently used colors can sometimes be referred to
more efficiently than emitting them using other two methods (described in
<a href="#421_huffman_coded_literals">4.2.1</a> and
<a href="#422_lz77_backward_reference">4.2.2</a>).</p>

<p>Color cache codes are stored as follows. First, there is a 1-bit value that
indicates if the color cache is used. If this bit is 0, no color cache codes
exist, and they are not transmitted in the Huffman code that decodes the green
symbols and the length prefix codes. However, if this bit is 1, the color
cache size is read next:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> color_cache_code_bits </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">4</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> color_cache_size </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> color_cache_code_bits</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p><code translate="no" dir="ltr">color_cache_code_bits</code> defines the size of the color_cache by (1 &lt;&lt;
<code translate="no" dir="ltr">color_cache_code_bits</code>). The range of allowed values for
<code translate="no" dir="ltr">color_cache_code_bits</code> is [1..11]. Compliant decoders must indicate a
corrupted bitstream for other values.</p>

<p>A color cache is an array of size <code translate="no" dir="ltr">color_cache_size</code>. Each entry
stores one ARGB color. Colors are looked up by indexing them by
(0x1e35a7bd * <code translate="no" dir="ltr">color</code>) &gt;&gt; (32 - <code translate="no" dir="ltr">color_cache_code_bits</code>). Only one
lookup is done in a color cache; there is no conflict resolution.</p>

<p>In the beginning of decoding or encoding of an image, all entries in all
color cache values are set to zero. The color cache code is converted to
this color at decoding time. The state of the color cache is maintained
by inserting every pixel, be it produced by backward referencing or as
literals, into the cache in the order they appear in the stream.</p>

<h2 id="5_entropy_code" data-text="5 Entropy Code">5 Entropy Code</h2>

<h3 id="51_overview" data-text="5.1 Overview">5.1 Overview</h3>

<p>Most of the data is coded using <a href="http://en.wikipedia.org/wiki/Canonical_Huffman_code">canonical Huffman code</a>.
Hence, the codes are transmitted by sending the <em>Huffman code lengths</em>, as
opposed to the actual <em>Huffman codes</em>.</p>

<p>In particular, the format uses <strong>spatially-variant Huffman coding</strong>. In other
words, different blocks of the image can potentially use different entropy
codes.</p>

<p><strong>Rationale</strong>: Different areas of the image may have different
characteristics. So, allowing them to use different entropy codes provides
more flexibility and potentially a better compression.</p>

<h3 id="52_details" data-text="5.2 Details">5.2 Details</h3>

<p>The encoded image data consists of two parts:</p>

<ol>
<li><p>Meta Huffman codes</p></li>
<li><p>Entropy-coded image data</p></li>
</ol>

<h4 id="521_decoding_of_meta_huffman_codes" data-text="5.2.1 Decoding of Meta Huffman Codes">5.2.1 Decoding of Meta Huffman Codes</h4>

<p>As noted earlier, the format allows the use of different Huffman codes for
different blocks of the image. <em>Meta Huffman codes</em> are indexes identifying
which Huffman codes to use in different parts of the image.</p>

<p>Meta Huffman codes may be used <em>only</em> when the image is being used in the
<a href="#41_roles_of_image_data">role</a> of an <em>ARGB image</em>.</p>

<p>There are two possibilities for the meta Huffman codes, indicated by a 1-bit
value:</p>

<ul>
<li><p>If this bit is zero, there is only one meta Huffman code used everywhere
in the image. No more data is stored.</p></li>
<li><p>If this bit is one, the image uses multiple meta Huffman codes. These meta
Huffman codes are stored as an <em>entropy image</em> (described below).</p></li>
</ul>

<p><strong>Entropy image:</strong></p>

<p>The entropy image defines which Huffman codes are used in different parts of
the image, as described below.</p>

<p>The first 3-bits contain the <code translate="no" dir="ltr">huffman_bits</code> value. The dimensions of the
entropy image are derived from 'huffman_bits'.</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> huffman_bits </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> huffman_xsize </span><span class="pun">=</span><span class="pln"> DIV_ROUND_UP</span><span class="pun">(</span><span class="pln">xsize</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> huffman_bits</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> huffman_ysize </span><span class="pun">=</span><span class="pln"> DIV_ROUND_UP</span><span class="pun">(</span><span class="pln">ysize</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> huffman_bits</span><span class="pun">);</span><span class="pln"><br></span></code></pre></devsite-code>
<p>where <code translate="no" dir="ltr">DIV_ROUND_UP</code> is as defined <a href="#predictor_transform">earlier</a>.</p>

<p>Next bits contain an entropy image of width <code translate="no" dir="ltr">huffman_xsize</code> and height
<code translate="no" dir="ltr">huffman_ysize</code>.</p>

<p><strong>Interpretation of Meta Huffman Codes:</strong></p>

<p>For any given pixel (x, y), there is a set of five Huffman codes associated
with it. These codes are (in bitstream order):</p>

<ul>
<li><p><strong>Huffman code #1</strong>: used for green channel, backward-reference length and
color cache</p></li>
<li><p><strong>Huffman code #2, #3 and #4</strong>: used for red, blue and alpha channels
respectively.</p></li>
<li><p><strong>Huffman code #5</strong>: used for backward-reference distance.</p></li>
</ul>

<p>From here on, we refer to this set as a <strong>Huffman code group</strong>.</p>

<p>The number of Huffman code groups in the ARGB image can be obtained by finding
the <em>largest meta Huffman code</em> from the entropy image:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> num_huff_groups </span><span class="pun">=</span><span class="pln"> max</span><span class="pun">(</span><span class="pln">entropy image</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>where <code translate="no" dir="ltr">max(entropy image)</code> indicates the largest Huffman code stored in the
entropy image.</p>

<p>As each Huffman code groups contains five Huffman codes, the total number of
Huffman codes is:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> num_huff_codes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> num_huff_groups</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>Given a pixel (x, y) in the ARGB image, we can obtain the corresponding
Huffman codes to be used as follows:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> position </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">y </span><span class="pun">&gt;&gt;</span><span class="pln"> huffman_bits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> huffman_xsize </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&gt;&gt;</span><span class="pln"> huffman_bits</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> meta_huff_code </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">entropy_image</span><span class="pun">[</span><span class="pln">pos</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xffff</span><span class="pun">;</span><span class="pln"><br></span><span class="typ">HuffmanCodeGroup</span><span class="pln"> huff_group </span><span class="pun">=</span><span class="pln"> huffman_code_groups</span><span class="pun">[</span><span class="pln">meta_huff_code</span><span class="pun">];</span><span class="pln"><br></span></code></pre></devsite-code>
<p>where, we have assumed the existence of <code translate="no" dir="ltr">HuffmanCodeGroup</code> structure, which
represents a set of five Huffman codes. Also, <code translate="no" dir="ltr">huffman_code_groups</code> is an
array of <code translate="no" dir="ltr">HuffmanCodeGroup</code> (of size <code translate="no" dir="ltr">num_huff_groups</code>).</p>

<p>The decoder then uses Huffman code group <code translate="no" dir="ltr">huff_group</code> to decode the pixel
(x, y) as explained in the
<a href="#522_decoding_entropy-coded_image_data">next section</a>.</p>

<h4 id="522_decoding_entropy-coded_image_data" data-text="5.2.2 Decoding Entropy-coded Image Data">5.2.2 Decoding Entropy-coded Image Data</h4>

<p>For the current position (x, y) in the image, the decoder first identifies the
corresponding Huffman code group (as explained in the last section). Given the
Huffman code group, the pixel is read and decoded as follows:</p>

<p>Read next symbol S from the bitstream using Huffman code #1. [See
<a href="#decoding-the-code-lengths">next section</a> for details on decoding the Huffman
code lengths]. Note that S is any integer in the range <code translate="no" dir="ltr">0</code> to
<code translate="no" dir="ltr">(256 + 24 +</code> <a href="#423_color_cache_coding"><code translate="no" dir="ltr">color_cache_size</code></a><code translate="no" dir="ltr">- 1)</code>.</p>

<p>The interpretation of S depends on its value:</p>

<ol>
<li>if S &lt; 256
<ol>
<li>Use S as the green component</li>
<li>Read red from the bitstream using Huffman code #2</li>
<li>Read blue from the bitstream using Huffman code #3</li>
<li>Read alpha from the bitstream using Huffman code #4</li>
</ol></li>
<li>if S &lt; 256 + 24
<ol>
<li>Use S - 256 as a length prefix code</li>
<li>Read extra bits for length from the bitstream</li>
<li>Determine backward-reference length L from length prefix code and the
extra bits read.</li>
<li>Read distance prefix code from the bitstream using Huffman code #5</li>
<li>Read extra bits for distance from the bitstream</li>
<li>Determine backward-reference distance D from distance prefix code and
the extra bits read.</li>
<li>Copy the L pixels (in scan-line order) from the sequence of pixels
prior to them by D pixels.</li>
</ol></li>
<li>if S &gt;= 256 + 24
<ol>
<li>Use S - (256 + 24) as the index into the color cache.</li>
<li>Get ARGB color from the color cache at that index.</li>
</ol></li>
</ol>

<p id="decoding-the-code-lengths"><strong>Decoding the Code Lengths:</strong>
</p>

<p>This section describes the details about reading a symbol from the bitstream
by decoding the Huffman code length.</p>

<p>The Huffman code lengths can be coded in two ways. The method used is
specified by a 1-bit value.</p>

<ul>
<li><p>If this bit is 1, it is a <em>simple code length code</em>, and</p></li>
<li><p>If this bit is 0, it is a <em>normal code length code</em>.</p></li>
</ul>

<p><strong>(i) Simple Code Length Code:</strong></p>

<p>This variant is used in the special case when only 1 or 2 Huffman code lengths
are non-zero, and are in the range of [0, 255]. All other Huffman code lengths
are implicitly zeros.</p>

<p>The first bit indicates the number of non-zero code lengths:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> num_code_lengths </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br></span></code></pre></devsite-code>
<p>The first code length is stored either using a 1-bit code for values of 0 and
1, or using an 8-bit code for values in range [0, 255]. The second code
length, when present, is coded as an 8-bit code.</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> is_first_8bits </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln"><br>code_lengths</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> is_first_8bits</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">num_code_lengths </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; code_lengths</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">8</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<p><strong>Note:</strong> Another special case is when <em>all</em> Huffman code lengths are <em>zeros</em>
(an empty Huffman code). For example, a Huffman code for distance can be empty
if there are no backward references. Similarly, Huffman codes for alpha, red,
and blue can be empty if all pixels within the same meta Huffman code are
produced using the color cache. However, this case doesn't need a special
handling, as empty Huffman codes can be coded as those containing a single
symbol <code translate="no" dir="ltr">0</code>.</p>

<p><strong>(ii) Normal Code Length Code:</strong></p>

<p>The code lengths of a Huffman code are read as follows: <code translate="no" dir="ltr">num_code_lengths</code>
specifies the number of code lengths; the rest of the code lengths
(according to the order in <code translate="no" dir="ltr">kCodeLengthCodeOrder</code>) are zeros.</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">int</span><span class="pln"> kCodeLengthCodes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">19</span><span class="pun">;</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> kCodeLengthCodeOrder</span><span class="pun">[</span><span class="pln">kCodeLengthCodes</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; </span><span class="lit">17</span><span class="pun">,</span><span class="pln"> </span><span class="lit">18</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">12</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">,</span><span class="pln"> </span><span class="lit">14</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pln"><br></span><span class="pun">};</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> code_lengths</span><span class="pun">[</span><span class="pln">kCodeLengthCodes</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">};</span><span class="pln"> &nbsp;</span><span class="com">// All zeros.</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> num_code_lengths </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">4</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> num_code_lengths</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; code_lengths</span><span class="pun">[</span><span class="pln">kCodeLengthCodeOrder</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadBits</span><span class="pun">(</span><span class="lit">3</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"><br></span></code></pre></devsite-code>
<ul>
<li>Code length code [0..15] indicates literal code lengths.
<ul>
<li>Value 0 means no symbols have been coded.</li>
<li>Values [1..15] indicate the bit length of the respective code.</li>
</ul></li>
<li>Code 16 repeats the previous non-zero value [3..6] times, i.e.,
3 + <code translate="no" dir="ltr">ReadBits(2)</code> times.  If code 16 is used before a non-zero
value has been emitted, a value of 8 is repeated.</li>
<li>Code 17 emits a streak of zeros [3..10], i.e., 3 + <code translate="no" dir="ltr">ReadBits(3)</code>
times.</li>
<li>Code 18 emits a streak of zeros of length [11..138], i.e.,
11 + <code translate="no" dir="ltr">ReadBits(7)</code> times.</li>
</ul>

<h2 id="6_overall_structure_of_the_format" data-text="6 Overall Structure of the Format">6 Overall Structure of the Format</h2>

<p>Below is a view into the format in Backus-Naur form. It does not cover
all details. End-of-image (EOI) is only implicitly coded into the number
of pixels (xsize * ysize).</p>

<h4 id="basic_structure" data-text="Basic Structure">Basic Structure</h4>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="tag">&lt;format&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;RIFF</span><span class="pln"> </span><span class="atn">header</span><span class="tag">&gt;&lt;image</span><span class="pln"> </span><span class="atn">size</span><span class="tag">&gt;&lt;image</span><span class="pln"> </span><span class="atn">stream</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;image</span><span class="pln"> </span><span class="atn">stream</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;optional-transform&gt;&lt;spatially-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span></code></pre></devsite-code>
<h4 id="structure_of_transforms" data-text="Structure of Transforms">Structure of Transforms</h4>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="tag">&lt;optional-transform&gt;</span><span class="pln"> ::= (1-bit value 1; </span><span class="tag">&lt;transform&gt;</span><span class="pln"> </span><span class="tag">&lt;optional-transform&gt;</span><span class="pln">) |<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1-bit value 0<br></span><span class="tag">&lt;transform&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;predictor-tx&gt;</span><span class="pln"> | </span><span class="tag">&lt;color-tx&gt;</span><span class="pln"> | </span><span class="tag">&lt;subtract-green-tx&gt;</span><span class="pln"> |<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;color-indexing-tx&gt;</span><span class="pln"><br></span><span class="tag">&lt;predictor-tx&gt;</span><span class="pln"> ::= 2-bit value 0; </span><span class="tag">&lt;predictor</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;predictor</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= 3-bit sub-pixel code ; </span><span class="tag">&lt;entropy-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;color-tx&gt;</span><span class="pln"> ::= 2-bit value 1; </span><span class="tag">&lt;color</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;color</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= 3-bit sub-pixel code ; </span><span class="tag">&lt;entropy-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;subtract-green-tx&gt;</span><span class="pln"> ::= 2-bit value 2<br></span><span class="tag">&lt;color-indexing-tx&gt;</span><span class="pln"> ::= 2-bit value 3; </span><span class="tag">&lt;color-indexing</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;color-indexing</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= 8-bit color count; </span><span class="tag">&lt;entropy-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span></code></pre></devsite-code>
<h4 id="structure_of_the_image_data" data-text="Structure of the Image Data">Structure of the Image Data</h4>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="tag">&lt;spatially-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">huffman</span><span class="tag">&gt;&lt;entropy-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;entropy-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;color</span><span class="pln"> </span><span class="atn">cache</span><span class="pln"> </span><span class="atn">info</span><span class="tag">&gt;&lt;huffman</span><span class="pln"> </span><span class="atn">codes</span><span class="tag">&gt;&lt;lz77-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">huffman</span><span class="tag">&gt;</span><span class="pln"> ::= 1-bit value 0 |<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(1-bit value 1; </span><span class="tag">&lt;entropy</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln">)<br></span><span class="tag">&lt;entropy</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= 3-bit subsample value; </span><span class="tag">&lt;entropy-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;color</span><span class="pln"> </span><span class="atn">cache</span><span class="pln"> </span><span class="atn">info</span><span class="tag">&gt;</span><span class="pln"> ::= 1 bit value 0 |<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(1-bit value 1; 4-bit value for color cache size)<br></span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">codes</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="pln"> </span><span class="atn">group</span><span class="tag">&gt;</span><span class="pln"> | </span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="pln"> </span><span class="atn">group</span><span class="tag">&gt;&lt;huffman</span><span class="pln"> </span><span class="atn">codes</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="pln"> </span><span class="atn">group</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;See "Interpretation of Meta Huffman codes" to<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;understand what each of these five Huffman codes are<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for.<br></span><span class="tag">&lt;huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;simple</span><span class="pln"> </span><span class="atn">huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"> | </span><span class="tag">&lt;normal</span><span class="pln"> </span><span class="atn">huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;simple</span><span class="pln"> </span><span class="atn">huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"> ::= see "Simple code length code" for details<br></span><span class="tag">&lt;normal</span><span class="pln"> </span><span class="atn">huffman</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"> ::= </span><span class="tag">&lt;code</span><span class="pln"> </span><span class="atn">length</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln">; encoded code lengths<br></span><span class="tag">&lt;code</span><span class="pln"> </span><span class="atn">length</span><span class="pln"> </span><span class="atn">code</span><span class="tag">&gt;</span><span class="pln"> ::= see section "Normal code length code"<br></span><span class="tag">&lt;lz77-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"> ::= ((</span><span class="tag">&lt;argb-pixel&gt;</span><span class="pln"> | </span><span class="tag">&lt;lz77-copy&gt;</span><span class="pln"> | </span><span class="tag">&lt;color-cache-code&gt;</span><span class="pln">)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="tag">&lt;lz77-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln">) | ""<br></span></code></pre></devsite-code>
<p>A possible example sequence:</p>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="tag">&lt;RIFF</span><span class="pln"> </span><span class="atn">header</span><span class="tag">&gt;&lt;image</span><span class="pln"> </span><span class="atn">size</span><span class="tag">&gt;</span><span class="pln">1-bit value 1</span><span class="tag">&lt;subtract-green-tx&gt;</span><span class="pln"><br>1-bit value 1</span><span class="tag">&lt;predictor-tx&gt;</span><span class="pln">1-bit value 0</span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">huffman</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;color</span><span class="pln"> </span><span class="atn">cache</span><span class="pln"> </span><span class="atn">info</span><span class="tag">&gt;&lt;huffman</span><span class="pln"> </span><span class="atn">codes</span><span class="tag">&gt;</span><span class="pln"><br></span><span class="tag">&lt;lz77-coded</span><span class="pln"> </span><span class="atn">image</span><span class="tag">&gt;</span><span class="pln"><br></span></code></pre></devsite-code>

    

    
  </div>

  

  
    
      <devsite-recommendations display="in-page" yield="" hidden="">
      </devsite-recommendations>
    
    
      
    <devsite-thumb-rating position="footer"><div class="devsite-thumb-rating" role="form" aria-labelledby="devsite-thumb-label-footer" tabindex="0"><div class="devsite-thumb-label" id="devsite-thumb-label-footer">Was this helpful?</div><div class="devsite-thumbs"><button class="devsite-thumb devsite-thumb-up" data-title="Helpful" aria-label="Helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21,7h-6.31l0.95-4.57l0.03-0.32c0-0.41-0.17-0.79-0.44-1.06L14.17,0c0,0-7.09,6.85-7.17,7H2v13h16 c0.83,0,1.54-0.5,1.84-1.22l3.02-7.05C22.95,11.5,23,11.26,23,11V9C23,7.9,22.1,7,21,7z M7,18H4V9h3V18z M21,11l-3,7H9V8l4.34-4.34 L12,9h9V11z"></path></svg></button><button class="devsite-thumb devsite-thumb-down" data-title="Not helpful" aria-label="Not helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3,17h6.31l-0.95,4.57l-0.03,0.32c0,0.41,0.17,0.79,0.44,1.06L9.83,24c0,0,7.09-6.85,7.17-7h5V4H6 C5.17,4,4.46,4.5,4.16,5.22l-3.02,7.05C1.05,12.5,1,12.74,1,13v2C1,16.1,1.9,17,3,17z M17,6h3v9h-3V6z M3,13l3-7h9v10l-4.34,4.34 L12,15H3V13z"></path></svg></button></div></div></devsite-thumb-rating>
  
       
    
    
      <devsite-recommendations id="recommendations-link" yield=""><div class="significatio-overview"><h2 class="significatio-heading no-link">Recommended for you</h2><div class="info-container"><button type="button" class="button-flat info-button significatio-info-container" id="significatio-info-button" aria-label="About recommendations" data-title="About recommendations"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="significatio-icon-info"><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg></button></div><div class="significatio-buttons"></div></div><div class="significatio-body"><div class="significatio-recommendations"><div class="significatio-card" show=""><h3 class="significatio-card-heading no-link"><a href="https://developers.google.com/speed/webp/docs/riff_container?rec=ClNodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC93ZWJwL2RvY3Mvd2VicF9sb3NzbGVzc19iaXRzdHJlYW1fc3BlY2lmaWNhdGlvbhABGA0gAygDMAY6CDM5MzAwMzEw" data-category="Site-Wide Custom Events" data-label="devsite-recommendation card link" data-action="click" track-type="recommendations" track-name="cardClick" track-metadata-eventdetail="https://developers.google.com/speed/webp/docs/riff_container">WebP Container Specification</a></h3><p class="significatio-card-description">An image format for the Web.</p><div class="significatio-card-meta">Updated <span class="significatio-date" date="1629102580">Aug 16, 2021</span></div></div><div class="significatio-card" show=""><h3 class="significatio-card-heading no-link"><a href="https://developers.google.com/speed/webp/docs/compression?rec=ClNodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC93ZWJwL2RvY3Mvd2VicF9sb3NzbGVzc19iaXRzdHJlYW1fc3BlY2lmaWNhdGlvbhACGA0gAygCMAY6CDM5MzAwMzEw" data-category="Site-Wide Custom Events" data-label="devsite-recommendation card link" data-action="click" track-type="recommendations" track-name="cardClick" track-metadata-eventdetail="https://developers.google.com/speed/webp/docs/compression">Compression Techniques</a></h3><p class="significatio-card-description">An image format for the Web.</p><div class="significatio-card-meta">Updated <span class="significatio-date" date="1629102580">Aug 16, 2021</span></div></div><div class="significatio-card" show=""><h3 class="significatio-card-heading no-link"><a href="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study?rec=ClNodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC93ZWJwL2RvY3Mvd2VicF9sb3NzbGVzc19iaXRzdHJlYW1fc3BlY2lmaWNhdGlvbhADGA0gAygGMAY6CDM5MzAwMzEw" data-category="Site-Wide Custom Events" data-label="devsite-recommendation card link" data-action="click" track-type="recommendations" track-name="cardClick" track-metadata-eventdetail="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study">Lossless and Transparency Encoding in WebP</a></h3><p class="significatio-card-description">An image format for the Web.</p><div class="significatio-card-meta">Updated <span class="significatio-date" date="1629102580">Aug 16, 2021</span></div></div></div><div class="significatio-loading"><devsite-spinner size="64" style="width: 64px; height: 64px;"><div class="devsite-spinner__layer devsite-spinner__layer-1"><div class="devsite-spinner__circle-clipper devsite-spinner__left"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__gap-patch"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__circle-clipper devsite-spinner__right"><div class="devsite-spinner__circle"></div></div></div><div class="devsite-spinner__layer devsite-spinner__layer-2"><div class="devsite-spinner__circle-clipper devsite-spinner__left"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__gap-patch"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__circle-clipper devsite-spinner__right"><div class="devsite-spinner__circle"></div></div></div><div class="devsite-spinner__layer devsite-spinner__layer-3"><div class="devsite-spinner__circle-clipper devsite-spinner__left"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__gap-patch"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__circle-clipper devsite-spinner__right"><div class="devsite-spinner__circle"></div></div></div><div class="devsite-spinner__layer devsite-spinner__layer-4"><div class="devsite-spinner__circle-clipper devsite-spinner__left"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__gap-patch"><div class="devsite-spinner__circle"></div></div><div class="devsite-spinner__circle-clipper devsite-spinner__right"><div class="devsite-spinner__circle"></div></div></div></devsite-spinner></div></div></devsite-recommendations>
    
  

  
  
</article>


<devsite-content-footer class="nocontent">
  <p>Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/site-policies">Google Developers Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  <p>Last updated 2021-08-16 UTC.</p>
</devsite-content-footer>





  
<div class="devsite-content-data">
  <template class="devsite-thumb-rating-down-categories">
  [{
      "type": "thumb-down",
      "id": "missingTheInformationINeed",
      "label":"Missing the information I need"
    },{
      "type": "thumb-down",
      "id": "tooComplicatedTooManySteps",
      "label":"Too complicated / too many steps"
    },{
      "type": "thumb-down",
      "id": "outOfDate",
      "label":"Out of date"
    },{
      "type": "thumb-down",
      "id": "samplesCodeIssue",
      "label":"Samples / code issue"
    },{
      "type": "thumb-down",
      "id": "otherDown",
      "label":"Other"
    }]
  </template>
  <template class="devsite-thumb-rating-up-categories">
  [{
      "type": "thumb-up",
      "id": "easyToUnderstand",
      "label":"Easy to understand"
    },{
      "type": "thumb-up",
      "id": "solvedMyProblem",
      "label":"Solved my problem"
    },{
      "type": "thumb-up",
      "id": "otherUp",
      "label":"Other"
    }]
  </template>
  
</div>
            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            
          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Learn</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="http://www.webmproject.org/code/#webp-repositories" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
          
            Code Repositories
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="http://www.webmproject.org/code/contribute/submitting-patches/" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
          
            Submitting Patches
          
          </a>
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Connect</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://groups.google.com/a/webmproject.org/group/webp-discuss" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
          
            Mailing List
          
          </a>
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://bugs.chromium.org/p/webp" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
          
            Issue Tracker
          
          </a>
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Downloads</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://developers.google.com/speed/webp/download" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
          
            Source and Binaries
          
          </a>
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  
  
  <nav class="devsite-footer-sites" aria-label="Other Google Developers websites">
    <a href="https://developers.google.com/" class="devsite-footer-sites-logo-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link">
      <img class="devsite-footer-sites-logo" src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/lockup-developers.svg" loading="lazy" alt="Google Developers">
    </a>
    <ul class="devsite-footer-sites-list">
      
      <li class="devsite-footer-sites-item">
        <a href="https://developer.android.com/" class="devsite-footer-sites-link
                  gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Android Link">
          Android
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="https://developer.chrome.com/home" class="devsite-footer-sites-link
                  gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Chrome Link">
          Chrome
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="https://firebase.google.com/" class="devsite-footer-sites-link
                  gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Firebase Link">
          Firebase
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="https://cloud.google.com/" class="devsite-footer-sites-link
                  gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Google Cloud Platform Link">
          Google Cloud Platform
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="https://developers.google.com/products" class="devsite-footer-sites-link
                  gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer All products Link">
          All products
        </a>
      </li>
      
    </ul>
  </nav>
  

  
  <nav class="devsite-footer-utility-links" aria-label="Utility links">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event" href="https://developers.google.com/terms/site-terms" data-category="Site-Wide Custom Events" data-label="Footer Terms link">
          Terms
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event" href="https://policies.google.com/privacy" data-category="Site-Wide Custom Events" data-label="Footer Privacy link">
          Privacy
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">Sign up for the Google Developers newsletter</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event" href="https://services.google.com/fb/forms/googledevelopersnewsletter/?utm_medium=referral&amp;utm_source=google-products&amp;utm_team=googledevs&amp;utm_campaign=201611-newsletter-launch" data-category="Site-Wide Custom Events" data-label="Footer Subscribe link">
          Subscribe
        </a>
        
      </li>
      
    </ul>
    
    
    
<devsite-language-selector>
  <devsite-select class="devsite-language-selector-menu">
    
    <select aria-label="Select your language preference." class="devsite-language-selector-select" name="language" track-name="click" track-type="languageSelector">
    
    
      <option value="en" selected="selected" lang="en">
        English
      </option>
    
      <option value="id" lang="id">
        Bahasa Indonesia
      </option>
    
      <option value="de" lang="de">
        Deutsch
      </option>
    
      <option value="es" lang="es">
        Español
      </option>
    
      <option value="fr" lang="fr">
        Français
      </option>
    
      <option value="pt_br" lang="pt_br">
        Português – Brasil
      </option>
    
      <option value="ru" lang="ru">
        Русский
      </option>
    
      <option value="zh_cn" lang="zh_cn">
        中文 – 简体
      </option>
    
      <option value="ja" lang="ja">
        日本語
      </option>
    
      <option value="ko" lang="ko">
        한국어
      </option>
    
    </select>
  <div class="devsite-select"><label id="devsite-select-21326255754828144-label" style="display:none;" aria-label="Select your language preference.">Select an option</label><button type="button" class="devsite-select-toggle" id="devsite-select-21326255754828144-button" aria-haspopup="true" aria-labelledby="devsite-select-21326255754828144-label devsite-select-21326255754828144-button" aria-controls="devsite-select-21326255754828144-popup"><span class="devsite-select-toggle-label">English</span><span class="devsite-icon devsite-icon-arrow-drop-down devsite-select-toggle-icon" aria-hidden="true"></span></button><ul class="devsite-select-list" id="devsite-select-21326255754828144-popup" tabindex="-1" role="listbox" scrollbars="" aria-labelledby="devsite-select-21326255754828144-button"><li role="option" id="devsite-select-21326255754828144-0" class="devsite-select-item" data-index="0" data-selected="" aria-selected="true" aria-label="English, selected" value="en" lang="en">English</li><li role="option" id="devsite-select-21326255754828144-1" class="devsite-select-item" data-index="1" aria-selected="false" aria-label="Bahasa Indonesia" value="id" lang="id">Bahasa Indonesia</li><li role="option" id="devsite-select-21326255754828144-2" class="devsite-select-item" data-index="2" aria-selected="false" aria-label="Deutsch" value="de" lang="de">Deutsch</li><li role="option" id="devsite-select-21326255754828144-3" class="devsite-select-item" data-index="3" aria-selected="false" aria-label="Español" value="es" lang="es">Español</li><li role="option" id="devsite-select-21326255754828144-4" class="devsite-select-item" data-index="4" aria-selected="false" aria-label="Français" value="fr" lang="fr">Français</li><li role="option" id="devsite-select-21326255754828144-5" class="devsite-select-item" data-index="5" aria-selected="false" aria-label="Português – Brasil" value="pt_br" lang="pt_br">Português – Brasil</li><li role="option" id="devsite-select-21326255754828144-6" class="devsite-select-item" data-index="6" aria-selected="false" aria-label="Русский" value="ru" lang="ru">Русский</li><li role="option" id="devsite-select-21326255754828144-7" class="devsite-select-item" data-index="7" aria-selected="false" aria-label="中文 – 简体" value="zh_cn" lang="zh_cn">中文 – 简体</li><li role="option" id="devsite-select-21326255754828144-8" class="devsite-select-item" data-index="8" aria-selected="false" aria-label="日本語" value="ja" lang="ja">日本語</li><li role="option" id="devsite-select-21326255754828144-9" class="devsite-select-item" data-index="9" aria-selected="false" aria-label="한국어" value="ko" lang="ko">한국어</li></ul></div></devsite-select>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel style="height: auto;"></devsite-panel>
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar style="bottom: 0px;">
</devsite-snackbar>
    <devsite-tooltip></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics enable-analytics-iframe="">
      
        <script type="application/json" analytics="">[{"gaid": "UA-24532603-1", "dimensions": {"dimension5": "en", "dimension6": "en", "dimension3": false, "dimension4": "WebP", "dimension1": "Signed out", "dimension11": false}, "metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}}]</script>
<script type="application/json" gtm="">{"parameters": {"freeTrialEligibleUser": "False", "internalUser": "False", "language": {"machineTranslated": "False", "requested": "en", "served": "en"}, "pageType": "article", "projectName": "WebP", "signedIn": "False", "tenant": "developers", "recommendations": {"sourcePage": "", "sourceType": 0, "sourceRank": 0, "sourceIdenticalDescriptions": 0, "sourceTitleWords": 0, "sourceDescriptionWords": 0, "experiment": ""}}}</script>
      
    <iframe src="WebP%20Lossless%20Bitstream%20Specification%20|%20Google%20Developers_files/analytics-iframe.html"></iframe></devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
    <script nonce="">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/developers/js/app_loader.js', '[1,"en",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7","https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/developers","https://developers-dot-devsite-v2-prod.appspot.com",null,null,["/_pwa/developers/manifest.json","https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/v0a713fec70a4b4c54311265d5142e962747a0e45a24063467564a2765c008ac7/developers/images/favicon.png","https://fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,18,21,25,40,45,50,63,70,75,76,80,87,91,92,93,97,98,100,101,102,103,104,105,107,108,109,110,111,112,113,115,116,117,118,120,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,138,141,142,144,147,148,149,150,151,152,154,157,159,161,165],"AIzaSyAP-jjEJBzmIyKR4F-3XITp8yM9T1gEEI8","AIzaSyB6xiKGDR5O3Ak2okS4rLkauxGUG7XP0hg","developers.google.com"]')
  
</script>
    <devsite-a11y-announce aria-live="assertive" aria-atomic="true"></devsite-a11y-announce>
  
</body></html>