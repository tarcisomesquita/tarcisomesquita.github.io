<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>know</title>
<link rel="icon" type="image/png" sizes="16x16" href="icone.png">

<style>
body {
  height: 100%;
  background-color: #FFFFFF;
  font-family: 'Open Sans',sans-serif;
  color: #000000;
  font-size: 16px;
  line-height: 23px;
  text-align: justify;
  margin: 0px;
  padding: 5mm;
}

a:link    {color:#2160DE; text-decoration:none;}      /* unvisited link  */
a:visited {color:#2160DE; text-decoration:none;}      /* visited link    */
a:hover   {color:#2160DE; text-decoration:underline;} /* mouse over link */
a:active  {color:#2160DE; text-decoration:underline;} /* selected link   */
</style>
</head>

<body onload="carregar('1')">

<div>
<svg xmlns="http://www.w3.org/2000/svg" x="0" y="0" width="60" height="60" onclick="location.reload()" style="//float:left; margin:5px">
  <rect x="1" y="1" rx="10" ry="10" width="58" height="58" style="fill:#ADD8E6;stroke:#000000;stroke-width:1"/>
  <circle r="5" cx="20" cy="30" style="fill:none;stroke:#000000;stroke-width:2" />
  <circle r="5" cx="40" cy="30" style="fill:none;stroke:#000000;stroke-width:2" />
  <path d="M  24,30  36,30 z" style="fill:none;stroke:#000000;stroke-width:2"/>
</svg>
</div>

<p>Explore o que o teclado pode escrever para validar uma sequência de palavras.</p>

<div id="texto" style="height: 70px; background: #CCCCCC; margin: 10px; padding: 5px;"></div>

<style>
.tecla {
  float: left;
  width: 23px;
  height: 23px;
  border: 1px solid #777777;
  border-radius: 3px;
  margin: 3px;
  padding: 5px;
  text-align: center;
  background: #999999;
  color: #eeeeee;
  font-size: 16px;
  font-family: Impact, Charcoal, sans-serif;
  font-weight: bold;
  cursor: pointer;
  
  user-select: none;
  -moz-user-select: none;
}
</style>

<div style="margin:auto; padding: 3px; background: #999999; width: 575px; height: 205px; border: 1px solid #7777FF; border-radius: 5px">
  <div class="tecla" id="Backquote" onmousedown="tDown('Backquote')" onmouseup="tUp('Backquote')">'</div>
  <div class="tecla" id="Digit1" onmousedown="tDown('Digit1')" onmouseup="tUp('Digit1')">1</div>
  <div class="tecla" id="Digit2" onmousedown="tDown('Digit2')" onmouseup="tUp('Digit2')">2</div>
  <div class="tecla" id="Digit3" onmousedown="tDown('Digit3')" onmouseup="tUp('Digit3')">3</div>
  <div class="tecla" id="Digit4" onmousedown="tDown('Digit4')" onmouseup="tUp('Digit4')">4</div>
  <div class="tecla" id="Digit5" onmousedown="tDown('Digit5')" onmouseup="tUp('Digit5')">5</div>
  <div class="tecla" id="Digit6" onmousedown="tDown('Digit6')" onmouseup="tUp('Digit6')">6</div>
  <div class="tecla" id="Digit7" onmousedown="tDown('Digit7')" onmouseup="tUp('Digit7')">7</div>
  <div class="tecla" id="Digit8" onmousedown="tDown('Digit8')" onmouseup="tUp('Digit8')">8</div>
  <div class="tecla" id="Digit9" onmousedown="tDown('Digit9')" onmouseup="tUp('Digit9')">9</div>
  <div class="tecla" id="Digit0" onmousedown="tDown('Digit0')" onmouseup="tUp('Digit0')">0</div>
  <div class="tecla" id="Minus" onmousedown="tDown('Minus')" onmouseup="tUp('Minus')">-</div>
  <div class="tecla" id="Equal" onmousedown="tDown('Equal')" onmouseup="tUp('Equal')">=</div>
  <div class="tecla" id="Delete" onmousedown="tDown('Delete')" onmouseup="tUp('Delete')">&#x2326;</div>
  <div class="tecla" id="Tab" onmousedown="tDown('Tab')" onmouseup="tUp('Tab')" >&#x21E5;</div>
  <div class="tecla" id="KeyQ" onmousedown="tDown('KeyQ')" onmouseup="tUp('KeyQ')">Q</div>
  <div class="tecla" id="KeyW" onmousedown="tDown('KeyW')" onmouseup="tUp('KeyW')">W</div>
  <div class="tecla" id="KeyE" onmousedown="tDown('KeyE')" onmouseup="tUp('KeyE')">E</div>
  <div class="tecla" id="KeyR" onmousedown="tDown('KeyR')" onmouseup="tUp('KeyR')">R</div>
  <div class="tecla" id="KeyT" onmousedown="tDown('KeyT')" onmouseup="tUp('KeyT')">T</div>
  <div class="tecla" id="KeyY" onmousedown="tDown('KeyY')" onmouseup="tUp('KeyY')">Y</div>
  <div class="tecla" id="KeyU" onmousedown="tDown('KeyU')" onmouseup="tUp('KeyU')">U</div>
  <div class="tecla" id="KeyI" onmousedown="tDown('KeyI')" onmouseup="tUp('KeyI')">I</div>
  <div class="tecla" id="KeyO" onmousedown="tDown('KeyO')" onmouseup="tUp('KeyO')">O</div>
  <div class="tecla" id="KeyP" onmousedown="tDown('KeyP')" onmouseup="tUp('KeyP')">P</div>
  <div class="tecla" id="BracketLeft" onmousedown="tDown('BracketLeft')" onmouseup="tUp('BracketLeft')">'</div>
  <div class="tecla" id="BracketRight" onmousedown="tDown('BracketRight')" onmouseup="tUp('BracketRight')">[</div>
  <div class="tecla" id="Backspace" onmousedown="tDown('Backspace')" onmouseup="tUp('Backspace')">&#x232B;</div>
  <div class="tecla" id="CapsLock" onmousedown="tDown('CapsLock')" onmouseup="tUp('CapsLock')">&#x21EA;</div>
  <div class="tecla" id="KeyA" onmousedown="tDown('KeyA')" onmouseup="tUp('KeyA')">A</div>
  <div class="tecla" id="KeyS" onmousedown="tDown('KeyS')" onmouseup="tUp('KeyS')">S</div>
  <div class="tecla" id="KeyD" onmousedown="tDown('KeyD')" onmouseup="tUp('KeyD')">D</div>
  <div class="tecla" id="KeyF" onmousedown="tDown('KeyF')" onmouseup="tUp('KeyF')">F</div>
  <div class="tecla" id="KeyG" onmousedown="tDown('KeyG')" onmouseup="tUp('KeyG')">G</div>
  <div class="tecla" id="KeyH" onmousedown="tDown('KeyH')" onmouseup="tUp('KeyH')">H</div>
  <div class="tecla" id="KeyJ" onmousedown="tDown('KeyJ')" onmouseup="tUp('KeyJ')">J</div>
  <div class="tecla" id="KeyK" onmousedown="tDown('KeyK')" onmouseup="tUp('KeyK')">K</div>
  <div class="tecla" id="KeyL" onmousedown="tDown('KeyL')" onmouseup="tUp('KeyL')">L</div>
  <div class="tecla" id="Semicolon" onmousedown="tDown('Semicolon')" onmouseup="tUp('Semicolon')">Ç</div>
  <div class="tecla" id="Quote" onmousedown="tDown('Quote')" onmouseup="tUp('Quote')">~</div>
  <div class="tecla" id="Backslash" onmousedown="tDown('Backslash')" onmouseup="tUp('Backslash')">]</div>
  <div class="tecla" id="Enter" onmousedown="tDown('Enter')" onmouseup="tUp('Enter')">&#x2386;</div>
  <div class="tecla" id="ShiftLeft" onmousedown="tDown('ShiftLeft')" onmouseup="tUp('ShiftLeft')">&#x21E7;</div>
  <div class="tecla" id="IntlBackslash" onmousedown="tDown('IntlBackslash')" onmouseup="tUp('IntlBackslash')">\</div>
  <div class="tecla" id="KeyZ" onmousedown="tDown('KeyZ')" onmouseup="tUp('KeyZ')">Z</div>
  <div class="tecla" id="KeyX" onmousedown="tDown('KeyX')" onmouseup="tUp('KeyX')">X</div>
  <div class="tecla" id="KeyC" onmousedown="tDown('KeyC')" onmouseup="tUp('KeyC')">C</div>
  <div class="tecla" id="KeyV" onmousedown="tDown('KeyV')" onmouseup="tUp('KeyV')">V</div>
  <div class="tecla" id="KeyB" onmousedown="tDown('KeyB')" onmouseup="tUp('KeyB')">B</div>
  <div class="tecla" id="KeyN" onmousedown="tDown('KeyN')" onmouseup="tUp('KeyN')">N</div>
  <div class="tecla" id="KeyM" onmousedown="tDown('KeyM')" onmouseup="tUp('KeyM')">M</div>
  <div class="tecla" id="Comma" onmousedown="tDown('Comma')" onmouseup="tUp('Comma')">,</div>
  <div class="tecla" id="Period" onmousedown="tDown('Period')" onmouseup="tUp('Period')">.</div>
  <div class="tecla" id="Slash" onmousedown="tDown('Slash')" onmouseup="tUp('Slash')">;</div>
  <div class="tecla" id="IntlRo" onmousedown="tDown('IntlRo')" onmouseup="tUp('IntlRo')">/</div>
  <div class="tecla" id="Fn" onmousedown="tDown('Fn')" onmouseup="tUp('Fn')">Fn</div>
  <div class="tecla" id="ControlLeft" onmousedown="tDown('ControlLeft')" onmouseup="tUp('ControlLeft')">&#x2388;</div>
  <div class="tecla" id="Window" onmousedown="tDown('Window')" onmouseup="tUp('Window')">&#x2756;</div>
  <div class="tecla" id="AltLeft" onmousedown="tDown('AltLeft')" onmouseup="tUp('AltLeft')">&#x2387;</div>
  <div class="tecla" id="Space" onmousedown="tDown('Space')" onmouseup="tUp('Space')" style="width: 228px">&#x2334;</div>
  <div class="tecla" id="ContextMenu" onmousedown="tDown('ContextMenu')" onmouseup="tUp('ContextMenu')">&#x2630;</div>
  <div class="tecla" id="ArrowLeft" onmousedown="tDown('ArrowLeft')" onmouseup="tUp('ArrowLeft')">&#x2190;</div>
  <div class="tecla" id="ArrowUp" onmousedown="tDown('ArrowUp')" onmouseup="tUp('ArrowUp')">&#x2191;</div>
  <div class="tecla" id="ArrowDown" onmousedown="tDown('ArrowDown')" onmouseup="tUp('ArrowDown')">&#x2193;</div>
  <div class="tecla" id="ArrowRight" onmousedown="tDown('ArrowRight')" onmouseup="tUp('ArrowRight')">&#x2192;</div>
</div>

<p>Veja a <a href="https://tarcisomesquita.github.io/know/doc/representacao-de-conhecimento.html">documentação</a>.</p>

<p>Experimente a <a href="https://tarcisomesquita.github.io/know/texto.html">análise de texto</a>.</p>

<script>
var pos_letra = 0;

let code2char = {Backquote:"'", 
                Digit1:'1', Digit2:'2', Digit3:'3', Digit4:'4', Digit5:'5', Digit6:'6', Digit7:'7', Digit8:'8', Digit9:'9', Digit0:'0', Minus:'-', Equal:'=', 
                KeyQ:'q', KeyW:'w', KeyE:'e', KeyR:'r', KeyT:'t', KeyY:'y', KeyU:'u', KeyI:'i', KeyO:'o', KeyP:'p', BracketLeft:'´', BracketRight:'[', 
                KeyA:'a', KeyS:'s', KeyD:'d', KeyF:'f', KeyG:'g', KeyH:'h', KeyJ:'j', KeyK:'k', KeyL:'l', Semicolon:'ç', Quote:'~', Backslash:']', 
                'ShiftLeft':'\u21E7', IntlBackslash:'\\', KeyZ:'z', KeyX:'x', KeyC:'c', KeyV:'v', KeyB:'b', KeyN:'n', KeyM:'m', Comma:',', Period:'.', Slash:';', IntlRo:'/', 
                Space:' '};

let char2code = {"'":'Backquote', 
                 1:'Digit1', 2:'Digit2', 3:'Digit3', 4:'Digit4', 5:'Digit5', 6:'Digit6', 7:'Digit7', 8:'Digit8', 9:'Digit9', 0:'Digit0', '-':'Minus', '=':'Equal', 
                 q:'KeyQ', w:'KeyW', e:'KeyE', r:'KeyR', t:'KeyT', y:'KeyY', u:'KeyU', i:'KeyI', o:'KeyO', p:'KeyP', '´':'BracketLeft', '[':'BracketRight', 
                 a:'KeyA', s:'KeyS', d:'KeyD', f:'KeyF', g:'KeyG', h:'KeyH', j:'KeyJ', k:'KeyK', l:'KeyL', ç:'Semicolon', '~':'Quote', ']':'Backslash', 
                 '\u21E7':'ShiftLeft', '\\':'IntlBackslash', z:'KeyZ', x:'KeyX', c:'KeyC', v:'KeyV', b:'KeyB', n:'KeyN', m:'KeyM', ',':'Comma', '.':'Period', ';':'Slash', '/':'IntlRo', 
                 ' ':'Space'};

// teclas ativas no estado atual
let ativo = [];

// histórico dos estados buscados na base
let response_history = [];

function teclado_agora() {
  for (i = 0; i < ativo.length; i++) document.getElementById(ativo[i]).style.backgroundColor = "#333333";
}

function limpa_teclado() {
  for (i = 0; i < ativo.length; i++) document.getElementById(ativo[i]).style.backgroundColor = "#999999";
}

function tDown(t_code) {
  if (ativo.indexOf(t_code) == -1) return;
  
  let tecla = document.getElementById(t_code);
  tecla.style.backgroundColor = "#eeeeee";
  tecla.style.color = "#333333";
}

let agudo = false;
let shift = false;
function tUp(t_code) {
  if (ativo.indexOf(t_code) == -1) return;
  
  let tecla = document.getElementById(t_code);
  tecla.style.backgroundColor = "#333333";
  tecla.style.color = "#eeeeee";
  
  let texto = document.getElementById("texto");
  if      (t_code === 'BracketLeft') agudo = true;
  else if (t_code === 'ShiftLeft') shift = true;
  else if (agudo && t_code === 'KeyA') {texto.innerHTML += 'á'; agudo = false;}
  else if (agudo && t_code === 'KeyE') {texto.innerHTML += 'é'; agudo = false;}
  else texto.innerHTML += code2char[t_code];
  
  limpa_teclado();
  let tamanho = ativo.length;
  ativo = []; //for (i = 0; i < tamanho; i++) ativo.pop();
  
  let estado = response_history[response_history.length - 1];
  if (estado[code2char[t_code]] === "") return;
  else carregar(estado[code2char[t_code]]);
  // AQUI
}

document.body.addEventListener('keydown', function (e) {
  tDown(e.code);
});

document.body.addEventListener('keyup', function (e) {
  tUp(e.code);
});

function mostrar(estado) {
  response_history.push(estado);
  
  if (Object.keys(estado)[0] === "*" &&  Object.keys(estado)[1] === "#") {
    let texto = document.getElementById("texto");
    texto.innerHTML += estado["*"];
    if (estado["#"] === "") return;
    else carregar(estado["#"]);
    
    return;
  }
  
  for (let key in estado) ativo.push(char2code[key]);
  
  teclado_agora();
}

function carregar(s) {
  fetch(`base-de-estados/${s}.json`)
  .then(response => {
    if (response.status === 200) return response.json();
    else console.log("> " + response.statusText);
  })
  .then(estado => mostrar(estado));
}
</script>

<footer style='font-family:"sans-serif"; font-size:10px;'>
Autor: <a href='https://tarcisomesquita.github.io'>Tarciso Mesquita</a><br/>
<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.pt_BR"><img alt="Licença Creative Commons" style="border-width:0" src="https://tarcisomesquita.github.io/CC-BY.png" /></a><br />Esta obra está licenciada com uma Licença <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.pt_BR">Creative Commons Atribuição 4.0 Internacional</a>
<script src="https://tarcisomesquita.github.io/log.js" onload="logsend()" async defer></script>
<footer>

</body>
</html> 
